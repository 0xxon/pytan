

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.1.8.5. Create sensor from json &mdash; PyTan 1.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="PyTan 1.0.0 documentation" href="../index.html"/>
        <link rel="up" title="6.1.8. pytan API Valid Create Object From JSON Examples" href="valid_create_objects_from_json.html"/>
        <link rel="next" title="6.1.8.6. Create question from json" href="create_question_from_json.html"/>
        <link rel="prev" title="6.1.8.4. Create action from json" href="create_action_from_json.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> PyTan</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../description.html">1. Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../description.html#why-it-was-created">2. Why it was created</a></li>
<li class="toctree-l1"><a class="reference internal" href="../description.html#requirements">3. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../description.html#installation">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../description.html#usage">5. Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../pytan.html">6. pytan package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="pytan_examples.html">6.1. pytan API examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pytan.handler.html">6.2. pytan.handler module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pytan.constants.html">6.3. pytan.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pytan.utils.html">6.4. pytan.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pytan.unittest.html">6.5. pytan Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pytan.functest.html">6.6. pytan Functional Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../taniumpy.html">taniumpy package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../taniumpy.session.html">1. taniumpy.session module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../taniumpy.question_asker.html">2. taniumpy.question_asker module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../taniumpy.object_types.html">3. taniumpy.object_types package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../xmltodict.html">7. xmltodict module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ddt.html">8. ddt module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../threaded_http.html">9. threaded_http module</a><ul class="simple">
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">PyTan</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../pytan.html">6. pytan package</a> &raquo;</li>
      
          <li><a href="pytan_examples.html">6.1. pytan API examples</a> &raquo;</li>
      
          <li><a href="valid_create_objects_from_json.html">6.1.8. pytan API Valid Create Object From JSON Examples</a> &raquo;</li>
      
    <li>6.1.8.5. Create sensor from json</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/examples/create_sensor_from_json.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="create-sensor-from-json">
<h1>6.1.8.5. Create sensor from json<a class="headerlink" href="#create-sensor-from-json" title="Permalink to this headline">¶</a></h1>
<p>Export a sensor object to a JSON file, adding &#8216; API TEST&#8217; to the name of the sensor before exporting the JSON file and deleting any pre-existing sensor with the same (new) name, then create a new sensor object from the exported JSON file</p>
<div class="section" id="example-python-code">
<h2>6.1.8.5.1. Example Python Code<a class="headerlink" href="#example-python-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># Path to lib directory which contains pytan package</span>
<span class="n">PYTAN_LIB_PATH</span> <span class="o">=</span> <span class="s">&#39;../lib&#39;</span>

<span class="c"># connection info for Tanium Server</span>
<span class="n">USERNAME</span> <span class="o">=</span> <span class="s">&quot;Tanium User&quot;</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="s">&quot;T@n!um&quot;</span>
<span class="n">HOST</span> <span class="o">=</span> <span class="s">&quot;172.16.31.128&quot;</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="s">&quot;444&quot;</span>

<span class="c"># Logging conrols</span>
<span class="n">LOGLEVEL</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">DEBUGFORMAT</span> <span class="o">=</span> <span class="bp">False</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">tempfile</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PYTAN_LIB_PATH</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pytan</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">Handler</span><span class="p">(</span>
    <span class="n">username</span><span class="o">=</span><span class="n">USERNAME</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">,</span>
    <span class="n">host</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span>
    <span class="n">port</span><span class="o">=</span><span class="n">PORT</span><span class="p">,</span>
    <span class="n">loglevel</span><span class="o">=</span><span class="n">LOGLEVEL</span><span class="p">,</span>
    <span class="n">debugformat</span><span class="o">=</span><span class="n">DEBUGFORMAT</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">print</span> <span class="n">handler</span>

<span class="c"># set the attribute name and value we want to add to the original object (if any)</span>
<span class="n">attr_name</span> <span class="o">=</span> <span class="s">&quot;name&quot;</span>
<span class="n">attr_add</span> <span class="o">=</span> <span class="s">&quot; API TEST&quot;</span>

<span class="c"># delete object before creating it?</span>
<span class="n">delete</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># setup the arguments for getting an object to export as json file</span>
<span class="n">get_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">get_kwargs</span><span class="p">[</span><span class="s">&quot;objtype&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;sensor&#39;</span>
<span class="n">get_kwargs</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">381</span>


<span class="c"># get objects to use as an export to JSON file</span>
<span class="n">orig_objs</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">**</span><span class="n">get_kwargs</span><span class="p">)</span>

<span class="c"># if attr_name and attr_add exists, modify the orig_objs to add attr_add to the attribute</span>
<span class="c"># attr_name</span>
<span class="k">if</span> <span class="n">attr_name</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">orig_objs</span><span class="p">:</span>
        <span class="n">new_attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
        <span class="n">new_attr</span> <span class="o">+=</span> <span class="n">attr_add</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">new_attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
            <span class="c"># delete the object in case it already exists</span>
            <span class="n">del_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">del_kwargs</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_attr</span>
            <span class="n">del_kwargs</span><span class="p">[</span><span class="s">&#39;objtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">u&#39;sensor&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">handler</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="o">**</span><span class="n">del_kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">e</span>

<span class="c"># export orig_objs to a json file</span>
<span class="n">json_file</span><span class="p">,</span> <span class="n">results</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">export_to_report_file</span><span class="p">(</span>
    <span class="n">obj</span><span class="o">=</span><span class="n">orig_objs</span><span class="p">,</span>
    <span class="n">export_format</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">,</span>
    <span class="n">report_dir</span><span class="o">=</span><span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(),</span>
<span class="p">)</span>

<span class="c"># create the object from the exported JSON file</span>
<span class="n">create_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;objtype&#39;</span><span class="p">:</span> <span class="s">u&#39;sensor&#39;</span><span class="p">,</span> <span class="s">&#39;json_file&#39;</span><span class="p">:</span> <span class="n">json_file</span><span class="p">}</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">create_from_json</span><span class="p">(</span><span class="o">**</span><span class="n">create_kwargs</span><span class="p">)</span>


<span class="k">print</span> <span class="s">&quot;&quot;</span>
<span class="k">print</span> <span class="s">&quot;Type of response: &quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;&quot;</span>
<span class="k">print</span> <span class="s">&quot;print of response:&quot;</span>
<span class="k">print</span> <span class="n">response</span>

<span class="k">print</span> <span class="s">&quot;&quot;</span>
<span class="k">print</span> <span class="s">&quot;print the object returned in JSON format:&quot;</span>
<span class="k">print</span> <span class="n">response</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="output-from-python-code">
<h2>6.1.8.5.2. Output from Python Code<a class="headerlink" href="#output-from-python-code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70</pre></div></td><td class="code"><div class="highlight"><pre>Handler for Session to 172.16.31.128:444, Authenticated: True, Version: 6.2.314.3258
2014-12-07 01:12:11,539 INFO     handler: Deleted &#39;Sensor, id: 831&#39;
2014-12-07 01:12:11,540 INFO     handler: Report file &#39;/var/folders/dk/vjr1r_c53yx6k6gzp2bbt_c40000gn/T/SensorList_2014_12_07-01_12_11-EST.json&#39; written with 15857 bytes
2014-12-07 01:12:11,574 INFO     handler: New Sensor, name: &#39;Folder Name Search with RegEx Match API TEST&#39; (ID: 833) created successfully!

Type of response:  &lt;class &#39;taniumpy.object_types.sensor_list.SensorList&#39;&gt;

print of response:
SensorList, len: 1

print the object returned in JSON format:
{
  &quot;_type&quot;: &quot;sensors&quot;,
  &quot;sensor&quot;: [
    {
      &quot;_type&quot;: &quot;sensor&quot;,
      &quot;category&quot;: &quot;File System&quot;,
      &quot;creation_time&quot;: &quot;2014-12-07T06:12:11&quot;,
      &quot;delimiter&quot;: &quot;,&quot;,
      &quot;description&quot;: &quot;Finds the specified folder and provides the full path if the folder exists on the client machine. Takes regular expression to match.\nExample: C:\\WINDOWS\\System32&quot;,
      &quot;exclude_from_parse_flag&quot;: 1,
      &quot;hash&quot;: 839342978,
      &quot;hidden_flag&quot;: 0,
      &quot;id&quot;: 833,
      &quot;ignore_case_flag&quot;: 1,
      &quot;last_modified_by&quot;: &quot;Tanium User&quot;,
      &quot;max_age_seconds&quot;: 600,
      &quot;metadata&quot;: {
        &quot;_type&quot;: &quot;metadata&quot;,
        &quot;item&quot;: [
          {
            &quot;_type&quot;: &quot;item&quot;,
            &quot;admin_flag&quot;: 0,
            &quot;name&quot;: &quot;defined&quot;,
            &quot;value&quot;: &quot;McAfee&quot;
          }
        ]
      },
      &quot;modification_time&quot;: &quot;2014-12-07T06:12:11&quot;,
      &quot;name&quot;: &quot;Folder Name Search with RegEx Match API TEST&quot;,
      &quot;parameter_definition&quot;: &quot;{\&quot;parameters\&quot;:[{\&quot;restrict\&quot;:null,\&quot;validationExpressions\&quot;:[{\&quot;flags\&quot;:\&quot;\&quot;,\&quot;expression\&quot;:\&quot;\\\\S{3}\&quot;,\&quot;helpString\&quot;:\&quot;Value must be at least 3 characters\&quot;,\&quot;model\&quot;:\&quot;com.tanium.models::ValidationExpression\&quot;,\&quot;parameterType\&quot;:\&quot;com.tanium.models::ValidationExpression\&quot;}],\&quot;helpString\&quot;:\&quot;Enter the folder name to search for\&quot;,\&quot;value\&quot;:\&quot;\&quot;,\&quot;promptText\&quot;:\&quot;e.g Program Files\&quot;,\&quot;defaultValue\&quot;:\&quot;\&quot;,\&quot;label\&quot;:\&quot;Search for Folder Name\&quot;,\&quot;maxChars\&quot;:0,\&quot;key\&quot;:\&quot;dirname\&quot;,\&quot;model\&quot;:\&quot;com.tanium.components.parameters::TextInputParameter\&quot;,\&quot;parameterType\&quot;:\&quot;com.tanium.components.parameters::TextInputParameter\&quot;},{\&quot;restrict\&quot;:null,\&quot;validationExpressions\&quot;:[{\&quot;flags\&quot;:\&quot;\&quot;,\&quot;expression\&quot;:\&quot;\\\\S{3}\&quot;,\&quot;helpString\&quot;:\&quot;Value must be at least 3 characters\&quot;,\&quot;model\&quot;:\&quot;com.tanium.models::ValidationExpression\&quot;,\&quot;parameterType\&quot;:\&quot;com.tanium.models::ValidationExpression\&quot;}],\&quot;helpString\&quot;:\&quot;Enter the regular expression to search for.\&quot;,\&quot;value\&quot;:\&quot;\&quot;,\&quot;promptText\&quot;:\&quot;e.g. test*.exe\&quot;,\&quot;defaultValue\&quot;:\&quot;\&quot;,\&quot;label\&quot;:\&quot;Regular Expression\&quot;,\&quot;maxChars\&quot;:0,\&quot;key\&quot;:\&quot;regexp\&quot;,\&quot;model\&quot;:\&quot;com.tanium.components.parameters::TextInputParameter\&quot;,\&quot;parameterType\&quot;:\&quot;com.tanium.components.parameters::TextInputParameter\&quot;},{\&quot;helpString\&quot;:\&quot;Enter Yes/No for case sensitivity of search.\&quot;,\&quot;value\&quot;:\&quot;\&quot;,\&quot;promptText\&quot;:\&quot;\&quot;,\&quot;defaultValue\&quot;:\&quot;\&quot;,\&quot;requireSelection\&quot;:true,\&quot;label\&quot;:\&quot;Case sensitive?\&quot;,\&quot;key\&quot;:\&quot;casesensitive\&quot;,\&quot;values\&quot;:[\&quot;No\&quot;,\&quot;Yes\&quot;],\&quot;model\&quot;:\&quot;com.tanium.components.parameters::DropDownParameter\&quot;,\&quot;parameterType\&quot;:\&quot;com.tanium.components.parameters::DropDownParameter\&quot;},{\&quot;helpString\&quot;:\&quot;Enter Yes/No whether the search is global.\&quot;,\&quot;value\&quot;:\&quot;\&quot;,\&quot;promptText\&quot;:\&quot;\&quot;,\&quot;defaultValue\&quot;:\&quot;\&quot;,\&quot;requireSelection\&quot;:true,\&quot;label\&quot;:\&quot;Global\&quot;,\&quot;key\&quot;:\&quot;global\&quot;,\&quot;values\&quot;:[\&quot;No\&quot;,\&quot;Yes\&quot;],\&quot;model\&quot;:\&quot;com.tanium.components.parameters::DropDownParameter\&quot;,\&quot;parameterType\&quot;:\&quot;com.tanium.components.parameters::DropDownParameter\&quot;}],\&quot;model\&quot;:\&quot;com.tanium.components.parameters::ParametersArray\&quot;,\&quot;parameterType\&quot;:\&quot;com.tanium.components.parameters::ParametersArray\&quot;}&quot;,
      &quot;queries&quot;: {
        &quot;_type&quot;: &quot;queries&quot;,
        &quot;query&quot;: [
          {
            &quot;_type&quot;: &quot;query&quot;,
            &quot;platform&quot;: &quot;Windows&quot;,
            &quot;script&quot;: &quot;&amp;amp;#039;========================================\n&amp;amp;#039; Folder Name Search with RegEx Match\n&amp;amp;#039;========================================\n&amp;amp;#039;@INCLUDE=utils/SensorRandomization/SensorRandomizationFunctions.vbs\nOption Explicit\n\nSensorRandomize()\n\nDim Pattern,strRegExp,strGlobalArg,strCaseSensitiveArg\nDim bGlobal,bCaseSensitive\n\nPattern = unescape(&amp;amp;quot;||dirname||&amp;amp;quot;)\nstrRegExp = Trim(Unescape(&amp;amp;quot;||regexp||&amp;amp;quot;))\nstrGlobalArg = Trim(Unescape(&amp;amp;quot;||global||&amp;amp;quot;))\nstrCaseSensitiveArg = Trim(Unescape(&amp;amp;quot;||casesensitive||&amp;amp;quot;))\n\nbGlobal = GetTrueFalseArg(&amp;amp;quot;global&amp;amp;quot;,strGlobalArg)\nbCaseSensitive = GetTrueFalseArg(&amp;amp;quot;casesensitive&amp;amp;quot;,strCaseSensitiveArg)\n\nConst SYSTEM_FOLDER = 1, TEMP_FOLDER = 2, FOR_READING = 1\n\nDim FSO, WshShell, Drives, Drive, TextStream, OutputFilename, strLine\n\nSet FSO = CreateObject(&amp;amp;quot;Scripting.FileSystemObject&amp;amp;quot;)\nSet WshShell = CreateObject(&amp;amp;quot;WScript.Shell&amp;amp;quot;)\n\nOutputFilename = TempName() &amp;amp;#039; a temporary file in system&amp;amp;#039;s temp dir\n\n&amp;amp;#039; Go through file system, refresh output file for filename\nIf Not FSO.FileExists(OutputFilename) Then\n\t\n\tIf FSO.FileExists(OutputFilename) Then FSO.DeleteFile OutputFilename\n\n\t&amp;amp;#039; Get the collection of local drives.\n\tSet Drives = FSO.Drives\n\tFor Each Drive in Drives\n\t\tIf Drive.DriveType = 2 Then &amp;amp;#039; 2 = Fixed drive\n\t\t\t&amp;amp;#039; Run the Dir command that looks for the filename pattern.\n\t\t\tRunCommand &amp;amp;quot;dir &amp;amp;quot; &amp;amp;amp;Chr(34)&amp;amp;amp; Drive.DriveLetter &amp;amp;amp; &amp;amp;quot;:\\&amp;amp;quot; &amp;amp;amp; Pattern &amp;amp;amp; Chr(34)&amp;amp;amp;&amp;amp;quot; /a:D /B /S&amp;amp;quot;, OutputFilename, true\n\t\tEnd If\n\tNext\nEnd If\n\n&amp;amp;#039; Open the output file, echo each line, and then close and delete it.\nSet TextStream = FSO.OpenTextFile(OutputFileName, FOR_READING)\nDo While Not TextStream.AtEndOfStream\n\tstrLine = TextStream.ReadLine()\n\tIf RegExpMatch(strRegExp,strLine,bGlobal,bCaseSensitive) Then\n\t\tWScript.Echo strLine\n\tEnd If\nLoop\n\n\nTextStream.Close()\n \nIf FSO.FileExists(OutputFileName) Then\n\tOn Error Resume Next\n\tFSO.DeleteFile OutputFileName, True\n\tOn Error Goto 0\nEnd If\n\nFunction RegExpMatch(strPattern,strToMatch,bGlobal,bIsCaseSensitive)\n\n\tDim re\n\tSet re = New RegExp\n\tWith re\n\t  .Pattern = strPattern\n\t  .Global = bGlobal\n\t  .IgnoreCase = Not bIsCaseSensitive\n\tEnd With\n\t\n\tRegExpMatch = re.Test(strToMatch)\n\nEnd Function &amp;amp;#039;RegExpMatch\n\n\nFunction GetTrueFalseArg(strArgName,strArgValue)\n\t&amp;amp;#039; Checks for valid values, will fail with error message\n\t\n\tDim bArgVal\n\tbArgVal = False\n\tSelect Case LCase(strArgValue)\n\t\tCase &amp;amp;quot;true&amp;amp;quot;\n\t\t\tbArgVal = True\n\t\tCase &amp;amp;quot;yes&amp;amp;quot;\n\t\t\tbArgVal = True\n\t\tCase &amp;amp;quot;false&amp;amp;quot;\n\t\t\tbArgVal = False\n\t\tCase &amp;amp;quot;no&amp;amp;quot;\n\t\t\tbArgVal = False\n\t\tCase Else\n\t\t\tWScript.Echo &amp;amp;quot;Error: Argument &amp;amp;#039;&amp;amp;quot;&amp;amp;amp;strArgName&amp;amp;amp;&amp;amp;quot;&amp;amp;#039; must be True or False, quitting&amp;amp;quot;\n\t\t\tPrintUsage\n\tEnd Select\n\tGetTrueFalseArg = bArgVal\n\nEnd Function &amp;amp;#039;GetTrueFalseArg\n\n\n&amp;amp;#039; Returns the name of a temporary file in the Temp directory.\nFunction TempName()\n\tDim Result\n\tDo\n \t\tResult = FSO.BuildPath(FSO.GetSpecialFolder(TEMP_FOLDER), FSO.GetTempName())\n\t\tWScript.Sleep 200 &amp;amp;#039;avoid potential busy loop\n\tLoop While FSO.FileExists(Result)\n\t\n\tTempName = Result\nEnd Function &amp;amp;#039;TempName\n\n&amp;amp;#039; Runs a command with Cmd.exe and redirects its output to a temporary\n&amp;amp;#039; file. The function returns the name of the temporary file that holds\n&amp;amp;#039; the command&amp;amp;#039;s output.\nFunction RunCommand(Command, OutputFilename, b64BitNecessary)\n\t&amp;amp;#039; 64BitNecessary true when you need to examine the 64-bit areas like system32\n\tDim CommandLine,WshShell,strPRogramFilesx86,strDOSCall,objFSO\n\tSet objFSO = CreateObject(&amp;amp;quot;Scripting.FileSystemObject&amp;amp;quot;)\n\tSet WshShell = CreateObject(&amp;amp;quot;WScript.Shell&amp;amp;quot;)\n\t\n\tstrDOSCall = &amp;amp;quot;%ComSpec% /C &amp;amp;quot;\n\t\n\t&amp;amp;#039; if 64-bit OS *and* we must examine in 64-bit mode to avoid FS Redirection\n\tstrProgramFilesx86=WshShell.ExpandEnvironmentStrings(&amp;amp;quot;%ProgramFiles%&amp;amp;quot;)\n\tIf objFSO.FolderExists(strProgramFilesx86) And b64BitNecessary Then &amp;amp;#039; quick check for x64\n\t\tstrDOSCall = FixFileSystemRedirectionForPath(WshShell.ExpandEnvironmentStrings(strDOSCall))\n\tEnd If\n\t\t\n\tCommandLine = WshShell.ExpandEnvironmentStrings(strDOSCall &amp;amp;amp; Command &amp;amp;amp; &amp;amp;quot; &amp;amp;gt;&amp;amp;gt; &amp;amp;quot;&amp;amp;quot;&amp;amp;quot; &amp;amp;amp; OutputFileName &amp;amp;amp; &amp;amp;quot;&amp;amp;quot;&amp;amp;quot;&amp;amp;quot;)\n\tWshShell.Run CommandLine, 0, True\nEnd Function &amp;amp;#039;RunCommand\n\nFunction FixFileSystemRedirectionForPath(strFilePath)\n&amp;amp;#039; This function will fix a folder location so that\n&amp;amp;#039; a 32-bit program can be passed the windows\\system32 directory\n&amp;amp;#039; as a parameter.\n&amp;amp;#039; Even if the sensor or action runs in 64-bit mode, a 32-bit\n&amp;amp;#039; program called in a 64-bit environment cannot access\n&amp;amp;#039; the system32 directory - it would be redirected to syswow64.\n&amp;amp;#039; you would not want to do this for 64-bit programs.\n\t\n\tDim objFSO, strSystem32Location,objShell\n\tDim strProgramFilesx86,strNewSystem32Location,strRestOfPath\n\tSet objFSO = CreateObject(&amp;amp;quot;Scripting.FileSystemObject&amp;amp;quot;)\n\tSet objShell = CreateObject(&amp;amp;quot;Wscript.Shell&amp;amp;quot;)\n\n\tstrProgramFilesx86=objShell.ExpandEnvironmentStrings(&amp;amp;quot;%ProgramFiles%&amp;amp;quot;)\n\n\tstrFilePath = LCase(strFilePath)\n\tstrSystem32Location = LCase(objFSO.GetSpecialFolder(1))\n\tstrProgramFilesx86=objShell.ExpandEnvironmentStrings(&amp;amp;quot;%ProgramFiles(x86)%&amp;amp;quot;)\n\t\n\tIf objFSO.FolderExists(strProgramFilesx86) Then &amp;amp;#039; quick check for x64\n\t\tIf InStr(strFilePath,strSystem32Location) = 1 Then\n\t\t\tstrRestOfPath = Replace(strFilePath,strSystem32Location,&amp;amp;quot;&amp;amp;quot;)\n\t\t\tstrNewSystem32Location = Replace(strSystem32Location,&amp;amp;quot;system32&amp;amp;quot;,&amp;amp;quot;sysnative&amp;amp;quot;)\n\t\t\tstrFilePath = strNewSystem32Location&amp;amp;amp;strRestOfPath\n\t\tEnd If\n\tEnd If\n\tFixFileSystemRedirectionForPath = strFilePath\n\t\n\t&amp;amp;#039;Cleanup\n\tSet objFSO = Nothing\nEnd Function &amp;amp;#039;FixFileSystemRedirectionForPath\n&amp;amp;#039;------------ INCLUDES after this line. Do not edit past this point -----\n&amp;amp;#039;- Begin file: utils/SensorRandomization/SensorRandomizationFunctions.vbs\n&amp;amp;#039;&amp;amp;#039; -- Begin Random Sleep Functions -- &amp;amp;#039;&amp;amp;#039;\n\nDim bSensorRandomizeDebugOutput : bSensorRandomizeDebugOutput = False\n\nFunction SensorRandomizeLow()\n    Dim intSensorRandomizeWaitLow : intSensorRandomizeWaitLow = 10\n    SensorRandomizeRandomSleep(intSensorRandomizeWaitLow)\nEnd Function &amp;amp;#039; SensorRandomizeLow\n\nFunction SensorRandomize()\n    Dim intSensorRandomizeWaitMed : intSensorRandomizeWaitMed = 20\n    SensorRandomizeRandomSleep(intSensorRandomizeWaitMed)\nEnd Function &amp;amp;#039; SensorRandomize\n\nFunction SensorRandomizeHigh()\n    Dim intSensorRandomizeWaitHigh : intSensorRandomizeWaitHigh = 30\n    SensorRandomizeRandomSleep(intSensorRandomizeWaitHigh)\nEnd Function &amp;amp;#039; SensorRandomize\n\nFunction SensorRandomizeRandomSleep(intSleepTime)\n&amp;amp;#039; sleeps for a random period of time, intSleepTime is in seconds\n&amp;amp;#039; if the sensor randomize flag is on\n&amp;amp;#039; RandomizeScalingFactor is a multiplier on the values hardcoded in the sensor\n&amp;amp;#039; not typically set but can adjust timings per endpoint, optionally\n\tDim intSensorRandomizeWaitTime\n\tDim objShell,intRandomizeFlag,strRandomizeRegPath,intRandomizeScalingPercentage\n\tstrRandomizeRegPath = SensorRandomizeGetTaniumRegistryPath&amp;amp;amp;&amp;amp;quot;\\Sensor Data\\Random Sleep&amp;amp;quot;\n\t\n\tSet objShell = CreateObject(&amp;amp;quot;WScript.Shell&amp;amp;quot;)\n\tOn Error Resume Next\n\tintRandomizeFlag = objShell.RegRead(&amp;amp;quot;HKLM\\&amp;amp;quot;&amp;amp;amp;strRandomizeRegPath&amp;amp;amp;&amp;amp;quot;\\SensorRandomizeFlag&amp;amp;quot;)\n\tintRandomizeScalingPercentage = objShell.RegRead(&amp;amp;quot;HKLM\\&amp;amp;quot;&amp;amp;amp;strRandomizeRegPath&amp;amp;amp;&amp;amp;quot;\\SensorRandomizeScalingPercentage&amp;amp;quot;)\n\tOn Error Goto 0\n\tIf intRandomizeFlag &amp;amp;gt; 0 Then\n\t\tIf intRandomizeScalingPercentage &amp;amp;gt; 0 Then\n\t\t\tintSleepTime = intRandomizeScalingPercentage * .01 * intSleepTime\n\t\t\tSensorRandomizeEcho &amp;amp;quot;Randomize scaling percentage of &amp;amp;quot; _ \n\t\t\t\t&amp;amp;amp; intRandomizeScalingPercentage &amp;amp;amp; &amp;amp;quot; applied, new sleep time is &amp;amp;quot; &amp;amp;amp; intSleepTime\n\t\tEnd If\n\t\tintSensorRandomizeWaitTime = CLng(intSleepTime) * 1000 &amp;amp;#039; convert to milliseconds\n\t\t&amp;amp;#039; wait random interval between 0 and the max\n\t\tRandomize(SensorRandomizeTaniumRandomSeed)\n\t\t&amp;amp;#039; assign random value to wait time max value\n\t\tintSensorRandomizeWaitTime = Int( ( intSensorRandomizeWaitTime + 1 ) * Rnd )\n\t\tSensorRandomizeEcho &amp;amp;quot;Sleeping for &amp;amp;quot; &amp;amp;amp; intSensorRandomizeWaitTime &amp;amp;amp; &amp;amp;quot; milliseconds&amp;amp;quot;\n\t\tWScript.Sleep(intSensorRandomizeWaitTime)\n\t\tSensorRandomizeEcho &amp;amp;quot;Done sleeping, continuing ...&amp;amp;quot;\n\tElse \n\t\tSensorRandomizeEcho &amp;amp;quot;SensorRandomize Not Enabled - No Op&amp;amp;quot;\n\tEnd If\nEnd Function &amp;amp;#039;SensorRandomizeRandomSleep\n\nFunction SensorRandomizeTaniumRandomSeed\n&amp;amp;#039; for randomizing sensor code, the default seed is not random enough\n\tDim timerNum\n\ttimerNum = Timer()\n\tIf timerNum &amp;amp;lt; 1 Then\n\t\tSensorRandomizeTaniumRandomSeed = (SensorRandomizeGetTaniumComputerID / Timer() * 10 )\n\tElse\n\t\tSensorRandomizeTaniumRandomSeed = SensorRandomizeGetTaniumComputerID / Timer\n\tEnd If\nEnd Function &amp;amp;#039;SensorRandomizeTaniumRandomSeed\n\nFunction SensorRandomizeGetTaniumRegistryPath\n&amp;amp;#039;SensorRandomizeGetTaniumRegistryPath works in x64 or x32\n&amp;amp;#039;looks for a valid Path value\n\n\tDim objShell\n\tDim keyNativePath, keyWoWPath, strPath, strFoundTaniumRegistryPath\n\t  \n    Set objShell = CreateObject(&amp;amp;quot;WScript.Shell&amp;amp;quot;)\n    \n\tkeyNativePath = &amp;amp;quot;Software\\Tanium\\Tanium Client&amp;amp;quot;\n\tkeyWoWPath = &amp;amp;quot;Software\\Wow6432Node\\Tanium\\Tanium Client&amp;amp;quot;\n    \n    &amp;amp;#039; first check the Software key (valid for 32-bit machines, or 64-bit machines in 32-bit mode)\n    On Error Resume Next\n    strPath = objShell.RegRead(&amp;amp;quot;HKLM\\&amp;amp;quot;&amp;amp;amp;keyNativePath&amp;amp;amp;&amp;amp;quot;\\Path&amp;amp;quot;)\n    On Error Goto 0\n\tstrFoundTaniumRegistryPath = keyNativePath\n \n  \tIf strPath = &amp;amp;quot;&amp;amp;quot; Then\n  \t\t&amp;amp;#039; Could not find 32-bit mode path, checking Wow6432Node\n  \t\tOn Error Resume Next\n  \t\tstrPath = objShell.RegRead(&amp;amp;quot;HKLM\\&amp;amp;quot;&amp;amp;amp;keyWoWPath&amp;amp;amp;&amp;amp;quot;\\Path&amp;amp;quot;)\n  \t\tOn Error Goto 0\n\t\tstrFoundTaniumRegistryPath = keyWoWPath\n  \tEnd If\n  \t\n  \tIf Not strPath = &amp;amp;quot;&amp;amp;quot; Then\n  \t\tSensorRandomizeGetTaniumRegistryPath = strFoundTaniumRegistryPath\n  \tElse\n  \t\tSensorRandomizeGetTaniumRegistryPath = False\n  \t\tWScript.Echo &amp;amp;quot;Error: Cannot locate Tanium Registry Path&amp;amp;quot;\n  \tEnd If\nEnd Function &amp;amp;#039;SensorRandomizeGetTaniumRegistryPath\n\nFunction SensorRandomizeGetTaniumComputerID\n&amp;amp;#039;&amp;amp;#039; This function gets the Tanium Computer ID\n\tDim objShell\n\tDim intClientID,strID,strKeyPath,strValueName\n\t\n    strKeyPath = SensorRandomizeGetTaniumRegistryPath\n    strValueName = &amp;amp;quot;ComputerID&amp;amp;quot;\n    Set objShell = CreateObject(&amp;amp;quot;WScript.Shell&amp;amp;quot;)\n    On Error Resume Next\n    intClientID = objShell.RegRead(&amp;amp;quot;HKLM\\&amp;amp;quot;&amp;amp;amp;strKeyPath&amp;amp;amp;&amp;amp;quot;\\&amp;amp;quot;&amp;amp;amp;strValueName)\n    If Err.Number &amp;amp;lt;&amp;amp;gt; 0 Then\n    \tSensorRandomizeGetTaniumComputerID = 0\n    Else\n\t\tSensorRandomizeGetTaniumComputerID = SensorRandomizeReinterpretSignedAsUnsigned(intClientID)\n\tEnd If\n\tOn Error Goto 0\nEnd Function &amp;amp;#039;SensorRandomizeGetTaniumComputerID\n\nFunction SensorRandomizeReinterpretSignedAsUnsigned(ByVal x)\n\t  If x &amp;amp;lt; 0 Then x = x + 2^32\n\t  SensorRandomizeReinterpretSignedAsUnsigned = x\nEnd Function &amp;amp;#039;SensorRandomizeReinterpretSignedAsUnsigned\n\nSub SensorRandomizeEcho(str)\n\tIf bSensorRandomizeDebugOutput = true Then WScript.Echo str\nEnd Sub &amp;amp;#039;SensorRandomizeEcho\n&amp;amp;#039; -- End Random Sleep Functions --&amp;amp;#039;\n&amp;amp;#039;- End file: utils/SensorRandomization/SensorRandomizationFunctions.vbs&quot;,
            &quot;script_type&quot;: &quot;VBScript&quot;
          },
          {
            &quot;_type&quot;: &quot;query&quot;,
            &quot;platform&quot;: &quot;Linux&quot;,
            &quot;script&quot;: &quot;#!/bin/bash\n#||dirname||||regexp||||casesensitive||||global||\necho Windows Only\n&quot;,
            &quot;script_type&quot;: &quot;UnixShell&quot;
          },
          {
            &quot;_type&quot;: &quot;query&quot;,
            &quot;platform&quot;: &quot;Mac&quot;,
            &quot;script&quot;: &quot;#!/bin/bash\n#||dirname||||regexp||||casesensitive||||global||\necho Windows Only\n&quot;,
            &quot;script_type&quot;: &quot;UnixShell&quot;
          }
        ]
      },
      &quot;source_id&quot;: 0,
      &quot;string_count&quot;: 0,
      &quot;value_type&quot;: &quot;String&quot;
    }
  ]
}
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="create_question_from_json.html" class="btn btn-neutral float-right" title="6.1.8.6. Create question from json">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="create_action_from_json.html" class="btn btn-neutral" title="6.1.8.4. Create action from json"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Tanium.
      Last updated on Dec 08, 2014.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>