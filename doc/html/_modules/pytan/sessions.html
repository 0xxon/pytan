

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pytan.sessions &mdash; PyTan 2.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="PyTan 2.1.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> PyTan</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">1. PyTan Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#description">1.1. Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#why-it-was-created">1.2. Why it was created</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#requirements">1.3. Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#tanium-versions-validated-against">1.4. Tanium Versions Validated Against</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#installation">1.5. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#usage">1.6. Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#directory-layout">1.7. Directory Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#other-references">1.8. Other References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pytan.html">2. pytan package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.handler.html">2.1. pytan.handler module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.exceptions.html">2.2. pytan.exceptions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.sessions.html">2.3. pytan.sessions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.pollers.html">2.4. pytan.pollers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.constants.html">2.5. pytan.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.utils.html">2.6. pytan.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.xml_clean.html">2.7. pytan.xml_clean module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.unittest.html">2.8. pytan Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.functest.html">2.9. pytan Functional Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/pytan_examples.html">2.10. PyTan API examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../taniumpy.html">3. taniumpy package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../taniumpy.object_types.html">3.1. taniumpy.object_types package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../xmltodict.html">4. xmltodict module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ddt.html">5. ddt module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../threaded_http.html">6. threaded_http module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../requests.html">7. requests package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../requests.html#requests-http-library">7.1. requests HTTP library</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">PyTan</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>pytan.sessions</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for pytan.sessions</h1><div class="highlight"><pre>
<span class="c"># -*- mode: Python; tab-width: 4; indent-tabs-mode: nil; -*-</span>
<span class="c"># ex: set tabstop=4</span>
<span class="c"># Please do not change the two lines above. See PEP 8, PEP 263.</span>
<span class="sd">&quot;&quot;&quot;Session classes for the :mod:`pytan` module.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># disable python from creating .pyc files everywhere</span>
<span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span> <span class="o">=</span> <span class="bp">True</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">xml.etree.cElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ET</span>

<span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">my_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
<span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">my_dir</span><span class="p">)</span>
<span class="n">path_adds</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_dir</span><span class="p">]</span>

<span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">path_adds</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">aa</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pytan</span>
<span class="kn">from</span> <span class="nn">pytan.xml_clean</span> <span class="kn">import</span> <span class="n">xml_cleaner</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">taniumpy</span>
<span class="n">requests</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">urllib3</span><span class="o">.</span><span class="n">disable_warnings</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Session"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session">[docs]</a><span class="k">class</span> <span class="nc">Session</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This session object uses the :mod:`requests` package instead of the built in httplib library.</span>

<span class="sd">    This provides support for keep alive, gzip, cookies, forwarding, and a host of other features</span>
<span class="sd">    automatically.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">REQ_SESSION</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Requests session allows you to persist certain parameters across requests. It also persists cookies across all requests made from the Session instance. Any requests that you make within a session will automatically reuse the appropriate connection</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># disable SSL cert verification for all requests made in this session</span>
    <span class="n">REQ_SESSION</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">XMLNS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;SOAP-ENV&#39;</span><span class="p">:</span> <span class="s">&#39;xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&#39;</span><span class="p">,</span>
        <span class="s">&#39;xsd&#39;</span><span class="p">:</span> <span class="s">&#39;xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&#39;</span><span class="p">,</span>
        <span class="s">&#39;xsi&#39;</span><span class="p">:</span> <span class="s">&#39;xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&#39;</span><span class="p">,</span>
        <span class="s">&#39;typens&#39;</span><span class="p">:</span> <span class="s">&#39;xmlns:typens=&quot;urn:TaniumSOAP&quot;&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;The namespace mappings for use in XML Request bodies&quot;&quot;&quot;</span>

    <span class="n">REQUEST_BODY_BASE</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;SOAP-ENV:Envelope {SOAP-ENV} {xsd} {xsi}&gt;</span>
<span class="s">&lt;SOAP-ENV:Body&gt;</span>
<span class="s">  &lt;typens:tanium_soap_request {typens}&gt;</span>
<span class="s">    &lt;command&gt;$command&lt;/command&gt;</span>
<span class="s">    &lt;object_list&gt;$object_list&lt;/object_list&gt;</span>
<span class="s">    $options</span>
<span class="s">  &lt;/typens:tanium_soap_request&gt;</span>
<span class="s">&lt;/SOAP-ENV:Body&gt;</span>
<span class="s">&lt;/SOAP-ENV:Envelope&gt;&quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">XMLNS</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;The XML template used for all SOAP Requests in string form&quot;&quot;&quot;</span>

    <span class="n">REQUEST_BODY_TEMPLATE</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">Template</span><span class="p">(</span><span class="n">REQUEST_BODY_BASE</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;The XML template used for all SOAP Requests in string.template form&quot;&quot;&quot;</span>

    <span class="n">GET_OBJECT_CMD</span> <span class="o">=</span> <span class="s">&#39;GetObject&#39;</span>
    <span class="sd">&quot;&quot;&quot;The text used in the command element for XML requests to get objects&quot;&quot;&quot;</span>

    <span class="n">UPDATE_OBJECT_CMD</span> <span class="o">=</span> <span class="s">&#39;UpdateObject&#39;</span>
    <span class="sd">&quot;&quot;&quot;The text used in the command element for XML requests to update objects&quot;&quot;&quot;</span>

    <span class="n">ADD_OBJECT_CMD</span> <span class="o">=</span> <span class="s">&#39;AddObject&#39;</span>
    <span class="sd">&quot;&quot;&quot;The text used in the command element for XML requests to add objects&quot;&quot;&quot;</span>

    <span class="n">DELETE_OBJECT_CMD</span> <span class="o">=</span> <span class="s">&#39;DeleteObject&#39;</span>
    <span class="sd">&quot;&quot;&quot;The text used in the command element for XML requests to delete objects&quot;&quot;&quot;</span>

    <span class="n">GET_RESULT_INFO_CMD</span> <span class="o">=</span> <span class="s">&#39;GetResultInfo&#39;</span>
    <span class="sd">&quot;&quot;&quot;The text used in the command element for XML requests to get result info for an object&quot;&quot;&quot;</span>

    <span class="n">GET_RESULT_DATA_CMD</span> <span class="o">=</span> <span class="s">&#39;GetResultData&#39;</span>
    <span class="sd">&quot;&quot;&quot;The text used in the command element for XML requests to get result data for an object&quot;&quot;&quot;</span>

    <span class="n">RUN_PLUGIN_CMD</span> <span class="o">=</span> <span class="s">&#39;RunPlugin&#39;</span>
    <span class="sd">&quot;&quot;&quot;The text used in the command element for XML requests to run a plugin for an object&quot;&quot;&quot;</span>

    <span class="n">AUTH_RES</span> <span class="o">=</span> <span class="s">&#39;auth&#39;</span>
    <span class="sd">&quot;&quot;&quot;The URL to use for authentication requests&quot;&quot;&quot;</span>

    <span class="n">SOAP_RES</span> <span class="o">=</span> <span class="s">&#39;soap&#39;</span>
    <span class="sd">&quot;&quot;&quot;The URL to use for SOAP requests&quot;&quot;&quot;</span>

    <span class="n">INFO_RES</span> <span class="o">=</span> <span class="s">&#39;info.json&#39;</span>
    <span class="sd">&quot;&quot;&quot;The URL to use for server info requests&quot;&quot;&quot;</span>

    <span class="n">AUTH_CONNECT_TIMEOUT_SEC</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="sd">&quot;&quot;&quot;number of seconds before timing out for a connection while authenticating&quot;&quot;&quot;</span>

    <span class="n">AUTH_RESPONSE_TIMEOUT_SEC</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="sd">&quot;&quot;&quot;number of seconds before timing out for a response while authenticating&quot;&quot;&quot;</span>

    <span class="n">INFO_CONNECT_TIMEOUT_SEC</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="sd">&quot;&quot;&quot;number of seconds before timing out for a connection while getting server info&quot;&quot;&quot;</span>

    <span class="n">INFO_RESPONSE_TIMEOUT_SEC</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="sd">&quot;&quot;&quot;number of seconds before timing out for a response while getting server info&quot;&quot;&quot;</span>

    <span class="n">SOAP_CONNECT_TIMEOUT_SEC</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="sd">&quot;&quot;&quot;number of seconds before timing out for a connection while sending a SOAP Request&quot;&quot;&quot;</span>

    <span class="n">SOAP_RESPONSE_TIMEOUT_SEC</span> <span class="o">=</span> <span class="mi">540</span>
    <span class="sd">&quot;&quot;&quot;number of seconds before timing out for a response while sending a SOAP request&quot;&quot;&quot;</span>

    <span class="n">SOAP_REQUEST_HEADERS</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s">&#39;text/xml; charset=utf-8&#39;</span><span class="p">,</span> <span class="s">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s">&#39;gzip&#39;</span><span class="p">}</span>
    <span class="sd">&quot;&quot;&quot;dictionary of headers to add to every HTTP GET/POST&quot;&quot;&quot;</span>

    <span class="n">COMMAND_RE_TXT</span> <span class="o">=</span> <span class="s">r&#39;&lt;command&gt;(.*?)&lt;/command&gt;&#39;</span>
    <span class="sd">&quot;&quot;&quot;text string to search for command element in XML bodies&quot;&quot;&quot;</span>

    <span class="n">COMMAND_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">COMMAND_RE_TXT</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;regex object to search for command element in XML bodies&quot;&quot;&quot;</span>

    <span class="n">SESSION_RE_TXT</span> <span class="o">=</span> <span class="s">r&#39;&lt;session&gt;(.*?)&lt;/session&gt;&#39;</span>
    <span class="sd">&quot;&quot;&quot;text string to search for session element in XML bodies&quot;&quot;&quot;</span>

    <span class="n">SESSION_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">SESSION_RE_TXT</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;regex object to search for session element in XML bodies&quot;&quot;&quot;</span>

    <span class="n">VERSION_RE_TXT</span> <span class="o">=</span> <span class="s">r&#39;&lt;server_version&gt;(.*?)&lt;/server_version&gt;&#39;</span>
    <span class="sd">&quot;&quot;&quot;text string to search for server_version element in XML bodies&quot;&quot;&quot;</span>

    <span class="n">VERSION_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">VERSION_RE_TXT</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;regex object to search for server_version element in XML bodies&quot;&quot;&quot;</span>

    <span class="n">HTTP_DEBUG</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="sd">&quot;&quot;&quot;print requests package debug or not&quot;&quot;&quot;</span>

    <span class="n">HTTP_RETRY_COUNT</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="sd">&quot;&quot;&quot;number of times to retry HTTP GET/POST&#39;s if the connection times out/fails&quot;&quot;&quot;</span>

    <span class="n">HTTP_AUTH_RETRY</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="sd">&quot;&quot;&quot;retry HTTP GET/POST&#39;s with username/password if session_id fails or not&quot;&quot;&quot;</span>

    <span class="n">STATS_LOOP_ENABLED</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="sd">&quot;&quot;&quot;enable the statistics loop thread or not&quot;&quot;&quot;</span>

    <span class="n">STATS_LOOP_SLEEP_SEC</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="sd">&quot;&quot;&quot;number of seconds to sleep in between printing the statistics when stats_loop_enabled is True&quot;&quot;&quot;</span>

    <span class="n">STATS_LOOP_TARGETS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s">&#39;Version&#39;</span><span class="p">:</span> <span class="s">&#39;Settings/Version&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;Active Questions&#39;</span><span class="p">:</span> <span class="s">&#39;Active Question Cache/Active Question Estimate&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;Clients&#39;</span><span class="p">:</span> <span class="s">&#39;Active Question Cache/Active Client Estimate&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;Strings&#39;</span><span class="p">:</span> <span class="s">&#39;String Cache/Total String Count&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;Handles&#39;</span><span class="p">:</span> <span class="s">&#39;System Performance Info/HandleCount&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;Processes&#39;</span><span class="p">:</span> <span class="s">&#39;System Performance Info/ProcessCount&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s">&#39;Memory Available&#39;</span><span class="p">:</span> <span class="s">&#39;percentage(System Performance Info/PhysicalAvailable,System Performance Info/PhysicalTotal)&#39;</span><span class="p">},</span>
    <span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;list of dictionaries with the key being the section of info.json to print info from, and the value being the item with in that section to print the value&quot;&quot;&quot;</span>

    <span class="n">mylog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;api.session&quot;</span><span class="p">)</span>
    <span class="n">authlog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;api.session.auth&quot;</span><span class="p">)</span>
    <span class="n">httplog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;api.session.http&quot;</span><span class="p">)</span>
    <span class="n">bodyhttplog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;api.session.http.body&quot;</span><span class="p">)</span>
    <span class="n">statslog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;stats&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">443</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qualname</span> <span class="o">=</span> <span class="s">&quot;{}.{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qualname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qualname</span> <span class="o">+</span> <span class="s">&quot;.auth&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qualname</span> <span class="o">+</span> <span class="s">&quot;.http&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bodyhttplog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qualname</span> <span class="o">+</span> <span class="s">&quot;.http.body&quot;</span><span class="p">)</span>

        <span class="c"># kwargs overrides for object properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_REQUEST_HEADERS</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;soap_request_headers&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_REQUEST_HEADERS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_DEBUG</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;http_debug&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_AUTH_RETRY</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;http_auth_retry&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_AUTH_RETRY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_RETRY_COUNT</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;http_retry_count&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_RETRY_COUNT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_CONNECT_TIMEOUT_SEC</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;auth_connect_timeout_sec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_CONNECT_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_RESPONSE_TIMEOUT_SEC</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;auth_response_timeout_sec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_RESPONSE_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INFO_CONNECT_TIMEOUT_SEC</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;info_connect_timeout_sec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_CONNECT_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RESPONSE_TIMEOUT_SEC</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;info_response_timeout_sec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RESPONSE_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_CONNECT_TIMEOUT_SEC</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;soap_connect_timeout_sec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_CONNECT_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_RESPONSE_TIMEOUT_SEC</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;soap_response_timeout_sec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_RESPONSE_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_ENABLED</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;stats_loop_enabled&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_ENABLED</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_SLEEP_SEC</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;stats_loop_sleep_sec&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_SLEEP_SEC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_TARGETS</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;stats_loop_targets&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_TARGETS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_start_stats_thread</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">str_tpl</span> <span class="o">=</span> <span class="s">&quot;{} to {}:{}, Authenticated: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">str_tpl</span><span class="p">(</span><span class="n">class_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_auth</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">session_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Property to fetch the session_id for this object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self._session_id : str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span>

    <span class="nd">@session_id.setter</span>
    <span class="k">def</span> <span class="nf">session_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Setter to update the session_id for this object&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Session ID updated to: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Property to determine if there is a valid session_id or username and password stored in this object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            * True: if self._session_id or self._username and _self.password are set</span>
<span class="sd">            * False: if not</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">auth</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span><span class="p">:</span>
            <span class="n">auth</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="n">auth</span>

<div class="viewcode-block" id="Session.logout"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.logout">[docs]</a>    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_session_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Logout a given session_id from Tanium. If not session_id currently set, it will authenticate to get one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        all_session_ids : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: only log out the current session id for the current user</span>
<span class="sd">            * True: log out ALL session id&#39;s associated for the current user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_auth</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">all_session_ids</span><span class="p">:</span>
            <span class="n">logout</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logout</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span>
        <span class="n">headers</span><span class="p">[</span><span class="s">&#39;logout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logout</span>

        <span class="n">req_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_RES</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">http_get</span><span class="p">(</span><span class="n">retry_count</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">req_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;logout exception: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">all_session_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Successfully logged out all session ids for current user&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Successfully logged out current session id for current user&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="Session.authenticate"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.authenticate">[docs]</a>    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Authenticate against a Tanium Server using a username/password or a session ID</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        username : str, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * username to authenticate as</span>
<span class="sd">        password : str, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * password for `username`</span>
<span class="sd">        session_id : str, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * session_id to authenticate with, this will be used in favor of username/password if all 3 are supplied.</span>
<span class="sd">        persistent: bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not request a persistent session (returns a session_id that expires 5 minutes after last use)</span>
<span class="sd">            * True: do request a persistent (returns a session_id that expires 1 week after last use)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Can request a persistent session that will last up to 1 week when authenticating</span>
<span class="sd">        with username and password.</span>

<span class="sd">        New persistent sessions may be handed out by the Tanium server when the session handed</span>
<span class="sd">        by this auth call is used to login with that week. The new session must be used to login,</span>
<span class="sd">        as no matter what persistent sessions will expire 1 week after issuance (or when logout is</span>
<span class="sd">        called with that session, or when logout with all_sessions=True is called for any session</span>
<span class="sd">        for this user)</span>

<span class="sd">        the way sessions get issued:</span>

<span class="sd">         - a GET request to /auth is issued</span>
<span class="sd">         - username/password supplied in headers as base64 encoded, or session is supplied in</span>
<span class="sd">           headers as string</span>
<span class="sd">         - session is returned upon successful auth</span>
<span class="sd">         - if there is a header &quot;persistent=1&quot; in the headers, a session that expires after 1 week</span>
<span class="sd">           will be issued if username/password was used to auth. persistent is ignored if session</span>
<span class="sd">           is used to auth.</span>
<span class="sd">         - if there is not a header &quot;persistent=1&quot; in the headers, a session that expires after 5</span>
<span class="sd">           minutes will be issued</span>
<span class="sd">         - if session is used before it expires, it&#39;s expiry will be extended by 5 minutes or 1</span>
<span class="sd">           week, depending on the type of persistence</span>
<span class="sd">         - while using the SOAP api, new session ID&#39;s may be returned as part of the response.</span>
<span class="sd">           these new session ID&#39;s should be used in lieu of the old session ID</span>

<span class="sd">        /auth URL</span>
<span class="sd">        This url is used for validating a server user&#39;s credentials. It supports a few different</span>
<span class="sd">        ways to authenticate and returns a SOAP session ID on success.  These sessions expire</span>
<span class="sd">        after 5 minutes by default if they aren&#39;t used in SOAP requests.  This expiration is</span>
<span class="sd">        configured with the server setting &#39;session_expiration_seconds&#39;.</span>

<span class="sd">        Supported Authentication Methods:</span>
<span class="sd">         - HTTP Basic Auth (Clear Text/BASE64)</span>
<span class="sd">         - Username/Password/Domain Headers (Clear Text)</span>
<span class="sd">         - Negotiate (NTLM Only)</span>

<span class="sd">        NTLM is enabled by default in 6.3 or greater and requires a persistent connection until a</span>
<span class="sd">        session is generated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">persistent</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;persistent&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">auth_type</span> <span class="o">=</span> <span class="s">&#39;unknown&#39;</span>

        <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
            <span class="n">auth_type</span> <span class="o">=</span> <span class="s">&#39;session ID&#39;</span>
            <span class="k">if</span> <span class="n">persistent</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;Unable to establish a persistent session when authenticating with a session!&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="n">m</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="n">session_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">auth_type</span> <span class="o">=</span> <span class="s">&#39;username/password&#39;</span>
            <span class="k">if</span> <span class="n">username</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="n">username</span>
            <span class="k">if</span> <span class="n">password</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_password</span> <span class="o">=</span> <span class="n">password</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">session_id</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="s">&quot;Must supply username&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="s">&quot;Must supply password&quot;</span><span class="p">)</span>

        <span class="n">auth_headers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">persistent</span><span class="p">:</span>
            <span class="n">auth_headers</span><span class="p">[</span><span class="s">&#39;persistent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">req_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_RES</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth_headers</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;retry_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_CONNECT_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;response_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;response_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AUTH_RESPONSE_TIMEOUT_SEC</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_get</span><span class="p">(</span><span class="o">**</span><span class="n">req_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Error while trying to authenticate: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">body</span>
        <span class="k">if</span> <span class="n">persistent</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Successfully authenticated and received a persistent (up to 1 week)&quot;</span>
                <span class="s">&quot;session id using {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">auth_type</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Successfully authenticated and received a non-persistent (up to 5 minutes) &quot;</span>
                <span class="s">&quot;session id using {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">auth_type</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Session.find"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and sends a GetObject XML Request body from `object_type` and parses the response into an appropriate :mod:`taniumpy` object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to find</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * found objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_get_object_body</span><span class="p">(</span><span class="n">object_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_body</span> <span class="o">=</span> <span class="n">request_body</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_body</span> <span class="o">=</span> <span class="n">response_body</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">BaseType</span><span class="o">.</span><span class="n">fromSOAPBody</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Session.save"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and sends a UpdateObject XML Request body from `obj` and parses the response into an appropriate :mod:`taniumpy` object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to save</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * saved object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_update_object_body</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_body</span> <span class="o">=</span> <span class="n">request_body</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_body</span> <span class="o">=</span> <span class="n">response_body</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">BaseType</span><span class="o">.</span><span class="n">fromSOAPBody</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Session.add"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and sends a AddObject XML Request body from `obj` and parses the response into an appropriate :mod:`taniumpy` object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to add</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * added object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_add_object_body</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_body</span> <span class="o">=</span> <span class="n">request_body</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_body</span> <span class="o">=</span> <span class="n">response_body</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">BaseType</span><span class="o">.</span><span class="n">fromSOAPBody</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Session.delete"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and sends a DeleteObject XML Request body from `obj` and parses the response into an appropriate :mod:`taniumpy` object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to delete</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * deleted object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_delete_object_body</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_body</span> <span class="o">=</span> <span class="n">request_body</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_body</span> <span class="o">=</span> <span class="n">response_body</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">BaseType</span><span class="o">.</span><span class="n">fromSOAPBody</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Session.run_plugin"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.run_plugin">[docs]</a>    <span class="k">def</span> <span class="nf">run_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and sends a RunPlugin XML Request body from `obj` and parses the response into an appropriate :mod:`taniumpy` object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to run</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * results from running object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_run_plugin_object_body</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_body</span> <span class="o">=</span> <span class="n">request_body</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_body</span> <span class="o">=</span> <span class="n">response_body</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">BaseType</span><span class="o">.</span><span class="n">fromSOAPBody</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Session.get_result_info"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.get_result_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_result_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and sends a GetResultInfo XML Request body from `obj` and parses the response into an appropriate :mod:`taniumpy` object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to get result info for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.result_info.ResultInfo`</span>
<span class="sd">            * ResultInfo for `obj`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_get_result_info_body</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_body</span> <span class="o">=</span> <span class="n">request_body</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_body</span> <span class="o">=</span> <span class="n">response_body</span>
        <span class="n">cdata_el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_cdata_el</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">is_str</span><span class="p">(</span><span class="n">cdata_el</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cdata_el</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">ResultInfo</span><span class="o">.</span><span class="n">fromSOAPElement</span><span class="p">(</span><span class="n">cdata_el</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Session.get_result_data"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.get_result_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_result_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and sends a GetResultData XML Request body from `obj` and parses the response into an appropriate :mod:`taniumpy` object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to get result set for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.result_set.ResultSet` or str</span>
<span class="sd">            * if export_id element found in `obj`, element text value is extracted and returned as str</span>
<span class="sd">            * otherwise, `obj` will be the ResultSet for `obj`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">request_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_get_result_data_body</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_body</span> <span class="o">=</span> <span class="n">request_body</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response</span><span class="p">(</span><span class="n">request_body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_body</span> <span class="o">=</span> <span class="n">response_body</span>
        <span class="n">cdata_el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_cdata_el</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">is_str</span><span class="p">(</span><span class="n">cdata_el</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">cdata_el</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">ResultSet</span><span class="o">.</span><span class="n">fromSOAPElement</span><span class="p">(</span><span class="n">cdata_el</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Session.get_server_info"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.get_server_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fallback_port</span><span class="o">=</span><span class="mi">444</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the /info.json</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        port : int, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * port to attempt getting /info.json from, if not specified will use self.port</span>
<span class="sd">        fallback_port : int, optional</span>
<span class="sd">            * default: 444</span>
<span class="sd">            * fallback port to attempt getting /info.json from if `port` fails</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        info_dict : dict</span>
<span class="sd">            * raw json response converted into python dict</span>
<span class="sd">            * &#39;diags_flat&#39;: info.json flattened out into an easier to use structure for python handling</span>
<span class="sd">            * &#39;server_info_pass_msgs&#39;: messages about successfully retrieving info.json</span>
<span class="sd">            * &#39;server_info_fail_msgs&#39;: messages about failing to retrieve info.json</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`pytan.sessions.Session._flatten_server_info` : method to flatten the dictionary received from info.json into a python friendly format</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            * 6.2 /info.json is only available on soap port (default port: 444)</span>
<span class="sd">            * 6.5 /info.json is only available on server port (default port: 443)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_auth</span><span class="p">()</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RES</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>

        <span class="n">req_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">port</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;retry_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_CONNECT_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;response_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;response_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RESPONSE_TIMEOUT_SEC</span>
        <span class="p">)</span>

        <span class="n">info_body</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">server_info_pass_msgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">server_info_fail_msgs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ok_m</span> <span class="o">=</span> <span class="s">&quot;Successfully retrieved server info from {}:{}/{}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">bad_m</span> <span class="o">=</span> <span class="s">&quot;Failed to retrieve server info from {}:{}/{}, {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">json_fail_m</span> <span class="o">=</span> <span class="s">&quot;Failed to parse server info from json, error: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">diags_flat_fail_m</span> <span class="o">=</span> <span class="s">&quot;Failed to flatten server info from json, error: {}&quot;</span><span class="o">.</span><span class="n">format</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">info_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_get</span><span class="p">(</span><span class="o">**</span><span class="n">req_args</span><span class="p">)</span>
            <span class="n">server_info_pass_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ok_m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RES</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">bad_m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RES</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="n">server_info_fail_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bad_m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RES</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">info_body</span><span class="p">:</span>
            <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fallback_port</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">info_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_post</span><span class="p">(</span><span class="o">**</span><span class="n">req_args</span><span class="p">)</span>
                <span class="n">server_info_pass_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ok_m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RES</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">bad_m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RES</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="n">server_info_fail_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bad_m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INFO_RES</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">info_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">info_body</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">info_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;info_body_failed_json&#39;</span><span class="p">:</span> <span class="n">info_body</span><span class="p">}</span>
            <span class="n">server_info_fail_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json_fail_m</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">diagnostics</span> <span class="o">=</span> <span class="n">info_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Diagnostics&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">info_dict</span><span class="p">[</span><span class="s">&#39;diags_flat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_server_info</span><span class="p">(</span><span class="n">diagnostics</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">info_dict</span><span class="p">[</span><span class="s">&#39;diags_flat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">server_info_fail_msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">diags_flat_fail_m</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="n">info_dict</span><span class="p">[</span><span class="s">&#39;server_info_pass_msgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server_info_pass_msgs</span>
        <span class="n">info_dict</span><span class="p">[</span><span class="s">&#39;server_info_fail_msgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">server_info_fail_msgs</span>
        <span class="k">return</span> <span class="n">info_dict</span>
</div>
<div class="viewcode-block" id="Session.get_server_version"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.get_server_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tries to parse the server version from /info.json</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            * str containing server version from /info.json</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;server_version&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span>

        <span class="n">server_version</span> <span class="o">=</span> <span class="s">&quot;Unable to determine&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;server_info&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_server_info</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;server_info&#39;</span><span class="p">,</span> <span class="p">{}):</span>
            <span class="k">return</span> <span class="n">server_version</span>

        <span class="n">version</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_info</span><span class="p">[</span><span class="s">&#39;diags_flat&#39;</span><span class="p">][</span><span class="s">&#39;Settings&#39;</span><span class="p">][</span><span class="s">&#39;Version&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Unable to find Version key in Settings: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_info</span><span class="p">[</span><span class="s">&#39;diags_flat&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">version</span><span class="p">:</span>
            <span class="n">server_version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Unable to find Version key in Settings: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_info</span><span class="p">[</span><span class="s">&#39;diags_flat&#39;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">server_version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="n">server_version</span>

        <span class="k">return</span> <span class="n">server_version</span>
</div>
<div class="viewcode-block" id="Session.get_server_stats"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.get_server_stats">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a str containing a number of stats gathered from /info.json</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            * str containing stats from /info.json</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.sessions.Session.STATS_LOOP_TARGETS` : list of dict containing stat keys to pull from /info.json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_auth</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;Not yet authenticated!&quot;</span>

        <span class="n">si</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_server_info</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">diags</span> <span class="o">=</span> <span class="n">si</span><span class="p">[</span><span class="s">&#39;diags_flat&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">stats_resolved</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_find_stat_target</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">diags</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_TARGETS</span><span class="p">]</span>
        <span class="n">stats_text</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;{}: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stats_resolved</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">stats_text</span>
</div>
<div class="viewcode-block" id="Session.enable_stats_loop"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.enable_stats_loop">[docs]</a>    <span class="k">def</span> <span class="nf">enable_stats_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enables the stats loop thread, which will print out the results of :func:`pytan.sessions.Session.get_server_stats` every :data:`pytan.sessions.Session.STATS_LOOP_SLEEP_SEC`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sleep : int, optional</span>
<span class="sd">            * when enabling the stats loop, update :data:`pytan.sessions.Session.STATS_LOOP_SLEEP_SEC` with `sleep`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`pytan.sessions.Session._stats_loop` : method started as a thread which checks self.STATS_LOOP_ENABLED before running :func:`pytan.sessions.Session.get_server_stats`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_ENABLED</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sleep</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_SLEEP_SEC</span> <span class="o">=</span> <span class="n">sleep</span>
</div>
<div class="viewcode-block" id="Session.disable_stats_loop"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.disable_stats_loop">[docs]</a>    <span class="k">def</span> <span class="nf">disable_stats_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sleep</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disables the stats loop thread, which will print out the results of :func:`pytan.sessions.Session.get_server_stats` every :data:`pytan.sessions.Session.STATS_LOOP_SLEEP_SEC`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sleep : int, optional</span>
<span class="sd">            * when disabling the stats loop, update :data:`pytan.sessions.Session.STATS_LOOP_SLEEP_SEC` with `sleep`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`pytan.sessions.Session._stats_loop` : method started as a thread which checks self.STATS_LOOP_ENABLED before running :func:`pytan.sessions.Session.get_server_stats`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_ENABLED</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sleep</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_SLEEP_SEC</span> <span class="o">=</span> <span class="n">sleep</span>
</div>
<div class="viewcode-block" id="Session.http_get"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.http_get">[docs]</a>    <span class="k">def</span> <span class="nf">http_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is an authenticated HTTP GET method. It will always forcibly use the authentication credentials that are stored in the current object when performing an HTTP GET.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        url : str</span>
<span class="sd">            * url to fetch on the server</span>
<span class="sd">        host: str, optional</span>
<span class="sd">            * default: self.server</span>
<span class="sd">            * host to connect to</span>
<span class="sd">        port: int, optional</span>
<span class="sd">            * default: self.port</span>
<span class="sd">            * port to connect to</span>
<span class="sd">        headers: dict, optional</span>
<span class="sd">            * default: {}</span>
<span class="sd">            * headers to supply as part of GET request</span>
<span class="sd">        connect_timeout: int, optional</span>
<span class="sd">            * default: self.SOAP_CONNECT_TIMEOUT_SEC</span>
<span class="sd">            * timeout in seconds for connection to host</span>
<span class="sd">        response_timeout: int, optional</span>
<span class="sd">            * default: self.SOAP_RESPONSE_TIMEOUT_SEC</span>
<span class="sd">            * timeout in seconds for response from host</span>
<span class="sd">        debug: bool, optional</span>
<span class="sd">            * default: self.HTTP_DEBUG</span>
<span class="sd">            * False: do not print requests debug messages</span>
<span class="sd">            * True: print requests debug messages</span>
<span class="sd">        auth_retry: bool, optional</span>
<span class="sd">            * default: self.HTTP_AUTH_RETRY</span>
<span class="sd">            * True: retry authentication with username/password if session_id fails</span>
<span class="sd">            * False: throw exception if session_id fails</span>
<span class="sd">        retry_count: int, optional</span>
<span class="sd">            * default: self.HTTP_RETRY_COUNT</span>
<span class="sd">            * number of times to retry the GET request if the server fails to respond properly or in time</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : str</span>
<span class="sd">            * str containing body of response from server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`pytan.sessions.Session._http_get` : private method used to perform the actual HTTP GET</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_auth</span><span class="p">()</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace_auth</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

        <span class="n">req_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;server&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">url</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_CONNECT_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;response_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;response_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_RESPONSE_TIMEOUT_SEC</span>
        <span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_DEBUG</span><span class="p">)</span>

        <span class="n">auth_retry</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;auth_retry&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_AUTH_RETRY</span><span class="p">)</span>
        <span class="n">retry_count</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retry_count&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_RETRY_COUNT</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">retry_count</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">retry_count</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">current_try</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_get</span><span class="p">(</span><span class="o">**</span><span class="n">req_args</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="ow">and</span> <span class="n">auth_retry</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>
                    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_get</span><span class="p">(</span><span class="n">auth_retry</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">retry_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;http_get failed on attempt {} out of {}: {}&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">current_try</span><span class="p">,</span> <span class="n">retry_count</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_try</span> <span class="o">==</span> <span class="n">retry_count</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">current_try</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">body</span>
</div>
<div class="viewcode-block" id="Session.http_post"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session.http_post">[docs]</a>    <span class="k">def</span> <span class="nf">http_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is an authenticated HTTP POST method. It will always forcibly use the authentication credentials that are stored in the current object when performing an HTTP POST.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        url : str, optional</span>
<span class="sd">            * default: self.SOAP_RES</span>
<span class="sd">            * url to fetch on the server</span>
<span class="sd">        host: str, optional</span>
<span class="sd">            * default: self.server</span>
<span class="sd">            * host to connect to</span>
<span class="sd">        port: int, optional</span>
<span class="sd">            * default: self.port</span>
<span class="sd">            * port to connect to</span>
<span class="sd">        headers: dict, optional</span>
<span class="sd">            * default: {}</span>
<span class="sd">            * headers to supply as part of POST request</span>
<span class="sd">        body: str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * body to send as part of the POST request</span>
<span class="sd">        connect_timeout: int, optional</span>
<span class="sd">            * default: self.SOAP_CONNECT_TIMEOUT_SEC</span>
<span class="sd">            * timeout in seconds for connection to host</span>
<span class="sd">        response_timeout: int, optional</span>
<span class="sd">            * default: self.SOAP_RESPONSE_TIMEOUT_SEC</span>
<span class="sd">            * timeout in seconds for response from host</span>
<span class="sd">        debug: bool, optional</span>
<span class="sd">            * default: self.HTTP_DEBUG</span>
<span class="sd">            * False: do not print requests debug messages</span>
<span class="sd">            * True: print requests debug messages</span>
<span class="sd">        auth_retry: bool, optional</span>
<span class="sd">            * default: self.HTTP_AUTH_RETRY</span>
<span class="sd">            * True: retry authentication with username/password if session_id fails</span>
<span class="sd">            * False: throw exception if session_id fails</span>
<span class="sd">        retry_count: int, optional</span>
<span class="sd">            * default: self.HTTP_RETRY_COUNT</span>
<span class="sd">            * number of times to retry the POST request if the server fails to respond properly or in time</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : str</span>
<span class="sd">            * str containing body of response from server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`pytan.sessions.Session._http_post` : private method used to perform the actual HTTP POST</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_auth</span><span class="p">()</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace_auth</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

        <span class="n">req_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;host&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;server&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_RES</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_CONNECT_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;response_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;response_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_RESPONSE_TIMEOUT_SEC</span>
        <span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;debug&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_DEBUG</span><span class="p">)</span>

        <span class="n">auth_retry</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;auth_retry&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_AUTH_RETRY</span><span class="p">)</span>
        <span class="n">retry_count</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retry_count&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HTTP_RETRY_COUNT</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">retry_count</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">retry_count</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">current_try</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_post</span><span class="p">(</span><span class="o">**</span><span class="n">req_args</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="ow">and</span> <span class="n">auth_retry</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>
                    <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_post</span><span class="p">(</span><span class="n">auth_retry</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">retry_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;http_post failed on attempt {} out of {}: {}&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">current_try</span><span class="p">,</span> <span class="n">retry_count</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">current_try</span> <span class="o">==</span> <span class="n">retry_count</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">current_try</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">body</span>
</div>
<div class="viewcode-block" id="Session._http_get"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._http_get">[docs]</a>    <span class="k">def</span> <span class="nf">_http_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                  <span class="n">response_timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is an HTTP GET method that utilizes the :mod:`requests` package.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        host: str</span>
<span class="sd">            * host to connect to</span>
<span class="sd">        port: int</span>
<span class="sd">            * port to connect to</span>
<span class="sd">        url : str</span>
<span class="sd">            * url to fetch on the server</span>
<span class="sd">        headers: dict, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * headers to supply as part of POST request</span>
<span class="sd">        connect_timeout: int, optional</span>
<span class="sd">            * default: 15</span>
<span class="sd">            * timeout in seconds for connection to host</span>
<span class="sd">        response_timeout: int, optional</span>
<span class="sd">            * default: 180</span>
<span class="sd">            * timeout in seconds for response from host</span>
<span class="sd">        debug: bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print requests debug messages</span>
<span class="sd">            * True: print requests debug messages</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : str</span>
<span class="sd">            * str containing body of response from server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_url</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP request: GET to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">full_url</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP request: headers: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clean_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)))</span>

        <span class="n">req_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">connect_timeout</span><span class="p">,</span> <span class="n">response_timeout</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REQ_SESSION</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="o">**</span><span class="n">req_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: GET request to {!r} failed: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HttpError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">REQ_RESPONSE</span> <span class="o">=</span> <span class="n">response</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
        <span class="n">response_headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: from {!r} len:{}, status:{} {}, body type: {}&quot;</span><span class="o">.</span><span class="n">format</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span>
            <span class="n">full_url</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">response_body</span><span class="p">),</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">response_body</span><span class="p">),</span>
        <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP response: headers: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response_headers</span><span class="p">))</span>

        <span class="n">auth_fail_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">401</span><span class="p">,</span> <span class="mi">403</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="n">auth_fail_codes</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: GET request to {!r} returned code: {}, body: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span>
                <span class="n">full_url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: GET request to {!r} returned code: {}, body: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HttpError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bodyhttplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP response: body:</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response_body</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">response_body</span>
</div>
<div class="viewcode-block" id="Session._http_post"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._http_post">[docs]</a>    <span class="k">def</span> <span class="nf">_http_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                   <span class="n">response_timeout</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is an HTTP POST method that utilizes the :mod:`requests` package.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        host: str</span>
<span class="sd">            * host to connect to</span>
<span class="sd">        port: int</span>
<span class="sd">            * port to connect to</span>
<span class="sd">        url : str</span>
<span class="sd">            * url to fetch on the server</span>
<span class="sd">        body: str, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * body to send as part of the POST request</span>
<span class="sd">        headers: dict, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * headers to supply as part of POST request</span>
<span class="sd">        connect_timeout: int, optional</span>
<span class="sd">            * default: 15</span>
<span class="sd">            * timeout in seconds for connection to host</span>
<span class="sd">        response_timeout: int, optional</span>
<span class="sd">            * default: 180</span>
<span class="sd">            * timeout in seconds for response from host</span>
<span class="sd">        debug: bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print requests debug messages</span>
<span class="sd">            * True: print requests debug messages</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : str</span>
<span class="sd">            * str containing body of response from server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`pytan.xml_clean.xml_cleaner` : function to remove invalid/bad characters from XML responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_url</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP request: POST to {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">full_url</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP request: headers: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_clean_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">)))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">body</span><span class="p">:</span>
            <span class="n">print_body</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">print_body</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bodyhttplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP request: body:{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">print_body</span><span class="p">))</span>

        <span class="n">req_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">connect_timeout</span><span class="p">,</span> <span class="n">response_timeout</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REQ_SESSION</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="o">**</span><span class="n">req_args</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: POST request to {!r} failed: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HttpError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">REQ_RESPONSE</span> <span class="o">=</span> <span class="n">response</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="n">xml_cleaner</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">response_headers</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: from {!r} len:{}, status:{} {}, body type: {}&quot;</span><span class="o">.</span><span class="n">format</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span>
            <span class="n">full_url</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">response_body</span><span class="p">),</span>
            <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="p">,</span>
            <span class="nb">type</span><span class="p">(</span><span class="n">response_body</span><span class="p">),</span>
        <span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">httplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP response: headers: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response_headers</span><span class="p">))</span>

        <span class="n">auth_fail_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">401</span><span class="p">,</span> <span class="mi">403</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="n">auth_fail_codes</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: POST request to {!r} returned code: {}, body: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span>
                <span class="n">full_url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response_body</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: POST request to {!r} returned empty body&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HttpError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">full_url</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;HTTP response: POST request to {!r} returned code: {}, body: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HttpError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response_body</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bodyhttplog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;HTTP response: body:</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">response_body</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">response_body</span>
</div>
<div class="viewcode-block" id="Session._replace_auth"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._replace_auth">[docs]</a>    <span class="k">def</span> <span class="nf">_replace_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for removing username, password, and/or session from supplied headers and replacing them with the current objects session or username and password</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        headers : dict</span>
<span class="sd">            * dict of key/value pairs for a set of headers for a given request</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        headers : dict</span>
<span class="sd">            * dict of key/value pairs for a set of headers for a given request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">headers</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">,</span> <span class="s">&#39;session&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Removing header {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                <span class="n">headers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">&#39;session&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Using session ID for authentication headers&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_password</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">)</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_password</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Using Username/Password for authentication headers&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span>
</div>
<div class="viewcode-block" id="Session._full_url"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._full_url">[docs]</a>    <span class="k">def</span> <span class="nf">_full_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for constructing a full url</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        url : str</span>
<span class="sd">            * url to use in string</span>
<span class="sd">        host : str, optional</span>
<span class="sd">            * default: self.server</span>
<span class="sd">            * hostname/IP address to use in string</span>
<span class="sd">        port : str, optional</span>
<span class="sd">            * default: self.port</span>
<span class="sd">            * port to use in string</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        full_url : str</span>
<span class="sd">            * full url in the form of https://$host:$port/$url</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;host&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;port&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="n">full_url</span> <span class="o">=</span> <span class="s">&quot;https://{0}:{1}/{2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">full_url</span>
</div>
<div class="viewcode-block" id="Session._clean_headers"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._clean_headers">[docs]</a>    <span class="k">def</span> <span class="nf">_clean_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for getting the headers for the current request, combining them with the session headers used for every request, and obfuscating the value of any &#39;password&#39; header.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        headers : dict</span>
<span class="sd">            * dict of key/value pairs for a set of headers for a given request</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        headers : dict</span>
<span class="sd">            * dict of key/value pairs for a set of cleaned headers for a given request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_headers</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">headers</span> <span class="ow">or</span> <span class="p">{})</span>
        <span class="n">return_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">return_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">REQ_SESSION</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">return_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">clean_headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">return_headers</span><span class="p">:</span>
            <span class="n">return_headers</span><span class="p">[</span><span class="s">&#39;password&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;**PASSWORD**&#39;</span>

        <span class="k">return</span> <span class="n">return_headers</span>
</div>
<div class="viewcode-block" id="Session._start_stats_thread"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._start_stats_thread">[docs]</a>    <span class="k">def</span> <span class="nf">_start_stats_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method starting the :func:`pytan.sessions.Session._stats_loop` method in a threaded daemon&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_stats_loop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Session._stats_loop"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._stats_loop">[docs]</a>    <span class="k">def</span> <span class="nf">_stats_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for logging server stats via :func:`pytan.sessions.Session.get_server_stats` every self.STATS_LOOP_SLEEP_SEC&quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_ENABLED</span><span class="p">:</span>
                <span class="n">server_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_server_stats</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">statslog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">server_stats</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STATS_LOOP_SLEEP_SEC</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Session._flatten_server_info"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._flatten_server_info">[docs]</a>    <span class="k">def</span> <span class="nf">_flatten_server_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">structure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for flattening the JSON structure for info.json into a more python usable format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        structure</span>
<span class="sd">            * dict/tuple/list to flatten</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        flattened</span>
<span class="sd">            * the dict/tuple/list flattened out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flattened</span> <span class="o">=</span> <span class="n">structure</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">flattened</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">flattened</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_server_info</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">]):</span>
                <span class="n">flattened</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="p">[</span><span class="n">flattened</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flatten_server_info</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">structure</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">flattened</span>
</div>
<div class="viewcode-block" id="Session._get_percentage"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._get_percentage">[docs]</a>    <span class="k">def</span> <span class="nf">_get_percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="n">whole</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for getting percentage of part out of whole</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        part: int, float</span>
<span class="sd">        whole: int, float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str : the percentage of part out of whole in 2 decimal places</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">whole</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;{0:.2f}%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Session._find_stat_target"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._find_stat_target">[docs]</a>    <span class="k">def</span> <span class="nf">_find_stat_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">diags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for finding a target in info.json and returning the value, optionally performing a percentage calculation on two values if the target[0] starts with percentage(</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : list</span>
<span class="sd">            * index0 : label : human friendly name to refer to search_path</span>
<span class="sd">            * index1 : search_path : / seperated search path to find a given value from info.json</span>
<span class="sd">        diags : dict</span>
<span class="sd">            * flattened dictionary of info.json diagnostics</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            * label : same as provided in `target` index0 (label)</span>
<span class="sd">            * result : value resolved from :func:`pytan.sessions.Session._resolve_stat_target` for `target` index1 (search_path)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span><span class="p">,</span> <span class="n">search_path</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Parse Failure&quot;</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;Unable to parse stat target: {}, exception: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">search_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;percentage(&#39;</span><span class="p">):</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">search_path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;percentage(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_resolve_stat_target</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">diags</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">points</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_percentage</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_stat_target</span><span class="p">(</span><span class="n">search_path</span><span class="p">,</span> <span class="n">diags</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="Session._resolve_stat_target"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._resolve_stat_target">[docs]</a>    <span class="k">def</span> <span class="nf">_resolve_stat_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_path</span><span class="p">,</span> <span class="n">diags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for resolving the value of search_path in info.json and returning the value</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        search_path : str</span>
<span class="sd">            * / seperated search path to find a given value from info.json</span>
<span class="sd">        diags : dict</span>
<span class="sd">            * flattened dictionary of info.json diagnostics</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            * value resolved from `diags` for `search_path`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">search_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span>
                <span class="n">diags</span> <span class="o">=</span> <span class="n">diags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;Unable to find diagnostic: {}, exception: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_path</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">diags</span>
</div>
<div class="viewcode-block" id="Session._build_body"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._build_body">[docs]</a>    <span class="k">def</span> <span class="nf">_build_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for building an XML Request Body</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        command : str</span>
<span class="sd">            * text to use in command node when building template</span>
<span class="sd">        object_list : str</span>
<span class="sd">            * XML string to use in object list node when building template</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            * any number of attributes that can be set via :class:`taniumpy.object_types.options.Options` that control the servers response.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : str</span>
<span class="sd">            * The XML request body created from the string.template self.REQUEST_BODY_TEMPLATE</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">options_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">Options</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">options_obj</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">options_obj</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Ignoring argument {!r} for options list, not a valid attribute&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

        <span class="n">options</span> <span class="o">=</span> <span class="n">options_obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="n">minimal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">REQUEST_BODY_TEMPLATE</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span>
            <span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">,</span>
            <span class="n">object_list</span><span class="o">=</span><span class="n">object_list</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">body</span>
</div>
<div class="viewcode-block" id="Session._create_run_plugin_object_body"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._create_run_plugin_object_body">[docs]</a>    <span class="k">def</span> <span class="nf">_create_run_plugin_object_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for building an XML Request Body to run a plugin</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to convert into XML</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            * any number of attributes that can be set via :class:`taniumpy.object_types.options.Options` that control the servers response.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_body : str</span>
<span class="sd">            * The XML request body created from :func:`pytan.sessions.Session._build_body`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="n">minimal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">obj_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_body</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RUN_PLUGIN_CMD</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_body</span>
</div>
<div class="viewcode-block" id="Session._create_add_object_body"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._create_add_object_body">[docs]</a>    <span class="k">def</span> <span class="nf">_create_add_object_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for building an XML Request Body to add an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to convert into XML</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            * any number of attributes that can be set via :class:`taniumpy.object_types.options.Options` that control the servers response.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_body : str</span>
<span class="sd">            * The XML request body created from :func:`pytan.sessions.Session._build_body`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="n">minimal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">obj_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_body</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ADD_OBJECT_CMD</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_body</span>
</div>
<div class="viewcode-block" id="Session._create_delete_object_body"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._create_delete_object_body">[docs]</a>    <span class="k">def</span> <span class="nf">_create_delete_object_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for building an XML Request Body to delete an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to convert into XML</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            * any number of attributes that can be set via :class:`taniumpy.object_types.options.Options` that control the servers response.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_body : str</span>
<span class="sd">            * The XML request body created from :func:`pytan.sessions.Session._build_body`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="n">minimal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">obj_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_body</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DELETE_OBJECT_CMD</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_body</span>
</div>
<div class="viewcode-block" id="Session._create_get_result_info_body"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._create_get_result_info_body">[docs]</a>    <span class="k">def</span> <span class="nf">_create_get_result_info_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for building an XML Request Body to get result info for an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to convert into XML</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            * any number of attributes that can be set via :class:`taniumpy.object_types.options.Options` that control the servers response.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_body : str</span>
<span class="sd">            * The XML request body created from :func:`pytan.sessions.Session._build_body`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="n">minimal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">obj_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_body</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GET_RESULT_INFO_CMD</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_body</span>
</div>
<div class="viewcode-block" id="Session._create_get_result_data_body"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._create_get_result_data_body">[docs]</a>    <span class="k">def</span> <span class="nf">_create_get_result_data_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for building an XML Request Body to get result data for an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to convert into XML</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            * any number of attributes that can be set via :class:`taniumpy.object_types.options.Options` that control the servers response.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_body : str</span>
<span class="sd">            * The XML request body created from :func:`pytan.sessions.Session._build_body`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="n">minimal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">obj_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_body</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GET_RESULT_DATA_CMD</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_body</span>
</div>
<div class="viewcode-block" id="Session._create_get_object_body"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._create_get_object_body">[docs]</a>    <span class="k">def</span> <span class="nf">_create_get_object_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_or_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for building an XML Request Body to get an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to convert into XML</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            * any number of attributes that can be set via :class:`taniumpy.object_types.options.Options` that control the servers response.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_body : str</span>
<span class="sd">            * The XML request body created from :func:`pytan.sessions.Session._build_body`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">object_or_type</span><span class="p">,</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">BaseType</span><span class="p">):</span>
            <span class="n">object_list</span> <span class="o">=</span> <span class="n">object_or_type</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="n">minimal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">object_list</span> <span class="o">=</span> <span class="s">&#39;&lt;{}/&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">object_or_type</span><span class="o">.</span><span class="n">_soap_tag</span><span class="p">)</span>

        <span class="n">obj_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_body</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GET_OBJECT_CMD</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_body</span>
</div>
<div class="viewcode-block" id="Session._create_update_object_body"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._create_update_object_body">[docs]</a>    <span class="k">def</span> <span class="nf">_create_update_object_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method for building an XML Request Body to update an object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to convert into XML</span>
<span class="sd">        kwargs : dict, optional</span>
<span class="sd">            * any number of attributes that can be set via :class:`taniumpy.object_types.options.Options` that control the servers response.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_body : str</span>
<span class="sd">            * The XML request body created from :func:`pytan.sessions.Session._build_body`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">object_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="n">minimal</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">obj_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_body</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UPDATE_OBJECT_CMD</span><span class="p">,</span> <span class="n">object_list</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj_body</span>
</div>
<div class="viewcode-block" id="Session._check_auth"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._check_auth">[docs]</a>    <span class="k">def</span> <span class="nf">_check_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method to check if authentication has been done yet, and throw an exception if not &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_auth</span><span class="p">:</span>
            <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;Not yet authenticated, use {}.authenticate()!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">class_name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Session._parse_response_for_regex"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._parse_response_for_regex">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_response_for_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">regex</span><span class="p">,</span> <span class="n">fail</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method to use a regex to get an element from an XML body</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        body : str</span>
<span class="sd">            * XML to search</span>
<span class="sd">        regex : re object</span>
<span class="sd">            * regex object to search for in body</span>
<span class="sd">        fail : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: throw exception if unable to find any matches for `regex` in `body`</span>
<span class="sd">            * False do not throw exception if unable to find any matches for `regex` in `body`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : str</span>
<span class="sd">            * The first value that matches `regex`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            * Using regex is WAY faster than ElementTree chewing the body in and out, this matters a LOT on LARGE return bodies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span> <span class="ow">and</span> <span class="n">fail</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Unable to find {} in body: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">body</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">ret</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Session._extract_export_id"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._extract_export_id">[docs]</a>    <span class="k">def</span> <span class="nf">_extract_export_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">el</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method to get the &#39;export_id&#39; element from an ElementTree object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        el : ElementTree object</span>
<span class="sd">            * ElementTree object to search for &#39;export_id&#39; in</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : str</span>
<span class="sd">            * The text value contained in the &#39;export_id&#39; element, if found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># if there is an export_id in the response_body, return just results of that</span>
        <span class="n">export_id_el</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.//export_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">export_id_el</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">export_id_el</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">export_id_el</span><span class="o">.</span><span class="n">text</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Session._extract_cdata_el"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._extract_cdata_el">[docs]</a>    <span class="k">def</span> <span class="nf">_extract_cdata_el</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response_body</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Utility method to get the &#39;ResultXML&#39; element from an XML body</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        response_body : str</span>
<span class="sd">            * XML body to search for the &#39;ResultXML&#39; element in</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : str or ElementTree object</span>
<span class="sd">            * str if &#39;export_id&#39; element found in XML</span>
<span class="sd">            * ElementTree object of ResultXML element otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">response_body</span><span class="p">)</span>

        <span class="c"># find the ResultXML node</span>
        <span class="n">resultxml_el</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;.//ResultXML&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">resultxml_el</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># if there is an export_id node, return the contents of that</span>
            <span class="n">export_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_export_id</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">export_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">export_id</span>

            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Unable to find ResultXML element in XML response: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">response_body</span><span class="p">))</span>

        <span class="n">resultxml_text</span> <span class="o">=</span> <span class="n">resultxml_el</span><span class="o">.</span><span class="n">text</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">resultxml_text</span><span class="p">:</span>
            <span class="c"># if there is an export_id node, return the contents of that</span>
            <span class="n">export_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_export_id</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">export_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">export_id</span>

            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Empty ResultXML element in XML response: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">response_body</span><span class="p">))</span>

        <span class="c"># parse the ResultXML node into it&#39;s own element</span>
        <span class="n">cdata_el</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">resultxml_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cdata_el</span>
</div>
<div class="viewcode-block" id="Session._get_response"><a class="viewcode-back" href="../../pytan.sessions.html#pytan.sessions.Session._get_response">[docs]</a>    <span class="k">def</span> <span class="nf">_get_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_body</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a wrapper around :func:`pytan.sessions.Session.http_post` for SOAP XML requests and responses.</span>

<span class="sd">        This method will update self.session_id if the response contains a different session_id than what is currently in this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        request_body : str</span>
<span class="sd">            * the XML request body to send to the server</span>
<span class="sd">        connect_timeout: int, optional</span>
<span class="sd">            * default: self.SOAP_CONNECT_TIMEOUT_SEC</span>
<span class="sd">            * timeout in seconds for connection to host</span>
<span class="sd">        response_timeout: int, optional</span>
<span class="sd">            * default: self.SOAP_RESPONSE_TIMEOUT_SEC</span>
<span class="sd">            * timeout in seconds for response from host</span>
<span class="sd">        retry_auth: bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: retry authentication with username/password if session_id fails</span>
<span class="sd">            * False: throw exception if session_id fails</span>
<span class="sd">        retry_count: int, optional</span>
<span class="sd">            * number of times to retry the request if the server fails to respond properly or in time</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        body : str</span>
<span class="sd">            * str containing body of response from server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`pytan.sessions.Session.http_post` : wrapper method used to perform the HTTP POST</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retry_auth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;retry_auth&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_auth</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">request_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response_for_regex</span><span class="p">(</span><span class="n">request_body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMAND_RE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;request_command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_command</span>

        <span class="n">req_args</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;body&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_body</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SOAP_REQUEST_HEADERS</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;connect_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_CONNECT_TIMEOUT_SEC</span><span class="p">)</span>
        <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;response_timeout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s">&#39;response_timeout&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SOAP_RESPONSE_TIMEOUT_SEC</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;retry_count&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">req_args</span><span class="p">[</span><span class="s">&#39;retry_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;retry_count&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;request_args&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">req_args</span>

        <span class="n">sent</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;sent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sent</span>

        <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">http_post</span><span class="p">(</span><span class="o">**</span><span class="n">req_args</span><span class="p">)</span>

        <span class="n">received</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;received&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">received</span>

        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">received</span> <span class="o">-</span> <span class="n">sent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;elapsed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elapsed</span>

        <span class="c"># m = &quot;HTTP Response: Timing info -- SENT: {}, RECEIVED: {}, ELAPSED: {}&quot;.format</span>
        <span class="c"># self.mylog.debug(m(sent, received, elapsed))</span>

        <span class="n">response_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response_for_regex</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">COMMAND_RE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last</span><span class="p">[</span><span class="s">&#39;response_command&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_command</span>

        <span class="k">if</span> <span class="s">&#39;forbidden&#39;</span> <span class="ow">in</span> <span class="n">response_command</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">retry_auth</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Last request was denied, re-authenticating with user/pass&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">authlog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">())</span>
                <span class="c"># we may have hit the 5 minute expiration for session_id, empty out session ID,</span>
                <span class="c"># re-authenticate, then retry request</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span>

                <span class="c"># re-issue the request</span>
                <span class="n">response_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_response</span><span class="p">(</span><span class="n">request_body</span><span class="p">,</span> <span class="n">retry_auth</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Access denied after re-authenticating! Server response: {}&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">AuthorizationError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">response_command</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">response_command</span> <span class="o">!=</span> <span class="n">request_command</span><span class="p">:</span>
            <span class="n">response_prunes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="s">&#39;XML Parse Error: &#39;</span><span class="p">,</span>
                <span class="s">&#39;SOAPProcessing Exception: class &#39;</span><span class="p">,</span>
                <span class="s">&#39;ERROR: 400 Bad Request&#39;</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">response_prunes</span><span class="p">:</span>
                <span class="n">response_command</span> <span class="o">=</span> <span class="n">response_command</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Response command {} does not match request command {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">BadResponseError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">response_command</span><span class="p">,</span> <span class="n">request_command</span><span class="p">))</span>

        <span class="c"># update session_id, in case new one issued</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response_for_regex</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SESSION_RE</span><span class="p">)</span>

        <span class="c"># check to see if server_version set in response (6.5+ only)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">:</span>
            <span class="n">server_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_response_for_regex</span><span class="p">(</span><span class="n">response_body</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VERSION_RE</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">server_version</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">!=</span> <span class="n">server_version</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="n">server_version</span>

        <span class="k">return</span> <span class="n">response_body</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Tanium.
      Last updated on Aug 27, 2015.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>