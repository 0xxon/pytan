

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pytan.handler &mdash; PyTan v2.1.0 2.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="PyTan v2.1.0 2.1.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> PyTan v2.1.0</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">1. PyTan Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#description">1.1. Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#why-it-was-created">1.2. Why it was created</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#requirements">1.3. Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#tanium-versions-validated-against">1.4. Tanium Versions Validated Against</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#installation">1.5. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#usage">1.6. Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#directory-layout">1.7. Directory Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html#other-references">1.8. Other References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pytan.html">2. pytan package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.handler.html">2.1. pytan.handler module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.exceptions.html">2.2. pytan.exceptions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.sessions.html">2.3. pytan.sessions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.pollers.html">2.4. pytan.pollers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.constants.html">2.5. pytan.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.utils.html">2.6. pytan.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.binsupport.html">2.7. pytan.binsupport module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.xml_clean.html">2.8. pytan.xml_clean module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.unittest.html">2.9. pytan Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.functest.html">2.10. pytan Functional Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/pytan_examples.html">2.11. PyTan API examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../taniumpy.html">3. taniumpy package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xmltodict.html">4. xmltodict module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ddt.html">5. ddt module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../threaded_http.html">6. threaded_http module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../requests.html">7. requests package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../requests.html#requests-http-library">7.1. requests HTTP library</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">PyTan v2.1.0</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>pytan.handler</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for pytan.handler</h1><div class="highlight"><pre>
<span class="c"># -*- mode: Python; tab-width: 4; indent-tabs-mode: nil; -*-</span>
<span class="c"># ex: set tabstop=4</span>
<span class="c"># Please do not change the two lines above. See PEP 8, PEP 263.</span>
<span class="sd">&quot;&quot;&quot;The main :mod:`pytan` module that provides first level entities for programmatic use.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># disable python from creating .pyc files everywhere</span>
<span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span> <span class="o">=</span> <span class="bp">True</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">my_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
<span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">my_dir</span><span class="p">)</span>
<span class="n">path_adds</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_dir</span><span class="p">]</span>
<span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span> <span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">path_adds</span> <span class="k">if</span> <span class="n">aa</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">taniumpy</span>
<span class="kn">import</span> <span class="nn">pytan</span>


<div class="viewcode-block" id="Handler"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler">[docs]</a><span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a connection to a Tanium SOAP Server on host:port</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    username : str</span>
<span class="sd">        * default: None</span>
<span class="sd">        * `username` to connect to `host` with</span>
<span class="sd">    password : str</span>
<span class="sd">        * default: None</span>
<span class="sd">        * `password` to connect to `host` with</span>
<span class="sd">    host : str</span>
<span class="sd">        * default: None</span>
<span class="sd">        * hostname or ip of Tanium SOAP Server</span>
<span class="sd">    port : int, optional</span>
<span class="sd">        * default: 443</span>
<span class="sd">        * port of Tanium SOAP Server on `host`</span>
<span class="sd">    loglevel : int, optional</span>
<span class="sd">        * default: 0</span>
<span class="sd">        * 0 do not print anything except warnings/errors</span>
<span class="sd">        * 1 and higher will print more</span>
<span class="sd">    debugformat : bool, optional</span>
<span class="sd">        * default: False</span>
<span class="sd">        * False: use one line logformat</span>
<span class="sd">        * True: use two lines</span>
<span class="sd">    gmt_log : bool, optional</span>
<span class="sd">        * default: True</span>
<span class="sd">        * True: use GMT timezone for log output</span>
<span class="sd">        * False: use local time for log output</span>
<span class="sd">    session_id : str, optional</span>
<span class="sd">        * default: None</span>
<span class="sd">        * session_id to use while authenticating instead of username/password</span>

<span class="sd">    Other Parameters</span>
<span class="sd">    ----------------</span>
<span class="sd">    http_debug : bool, optional</span>
<span class="sd">        * default: False</span>
<span class="sd">        * False: do not print requests package debug</span>
<span class="sd">        * True: do print requests package debug</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    http_auth_retry: bool, optional</span>
<span class="sd">        * default: True</span>
<span class="sd">        * True: retry HTTP GET/POST&#39;s</span>
<span class="sd">        * False: do not retry HTTP GET/POST&#39;s</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    http_retry_count: int, optional</span>
<span class="sd">        * default: 5</span>
<span class="sd">        * number of times to retry HTTP GET/POST&#39;s if the connection times out/fails</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    soap_request_headers : dict, optional</span>
<span class="sd">        * default: {&#39;Content-Type&#39;: &#39;text/xml; charset=utf-8&#39;, &#39;Accept-Encoding&#39;: &#39;gzip&#39;}</span>
<span class="sd">        * dictionary of headers to add to every HTTP GET/POST</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    auth_connect_timeout_sec : int, optional</span>
<span class="sd">        * default: 5</span>
<span class="sd">        * number of seconds before timing out for a connection while authenticating</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    auth_response_timeout_sec : int, optional</span>
<span class="sd">        * default: 15</span>
<span class="sd">        * number of seconds before timing out for a response while authenticating</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    info_connect_timeout_sec : int, optional</span>
<span class="sd">        * default: 5</span>
<span class="sd">        * number of seconds before timing out for a connection while getting /info.json</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    info_response_timeout_sec : int, optional</span>
<span class="sd">        * default: 15</span>
<span class="sd">        * number of seconds before timing out for a response while getting /info.json</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    soap_connect_timeout_sec : int, optional</span>
<span class="sd">        * default: 15</span>
<span class="sd">        * number of seconds before timing out for a connection for a SOAP request</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    soap_response_timeout_sec : int, optional</span>
<span class="sd">        * default: 540</span>
<span class="sd">        * number of seconds before timing out for a response for a SOAP request</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    stats_loop_enabled : bool, optional</span>
<span class="sd">        * default: False</span>
<span class="sd">        * False: do not enable the statistics loop thread</span>
<span class="sd">        * True: enable the statistics loop thread</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    stats_loop_sleep_sec : int, optional</span>
<span class="sd">        * default: 5</span>
<span class="sd">        * number of seconds to sleep in between printing the statistics when stats_loop_enabled is True</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    record_all_requests: bool, optional</span>
<span class="sd">        * default: False</span>
<span class="sd">        * False: do not add each requests response object to session.ALL_REQUESTS_RESPONSES</span>
<span class="sd">        * True: add each requests response object to session.ALL_REQUESTS_RESPONSES</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    stats_loop_targets : list of dict, optional</span>
<span class="sd">        * default: [{&#39;Version&#39;: &#39;Settings/Version&#39;}, {&#39;Active Questions&#39;: &#39;Active Question Cache/Active Question Estimate&#39;}, {&#39;Clients&#39;: &#39;Active Question Cache/Active Client Estimate&#39;}, {&#39;Strings&#39;: &#39;String Cache/Total String Count&#39;}, {&#39;Handles&#39;: &#39;System Performance Info/HandleCount&#39;}, {&#39;Processes&#39;: &#39;System Performance Info/ProcessCount&#39;}, {&#39;Memory Available&#39;: &#39;percentage(System Performance Info/PhysicalAvailable,System Performance Info/PhysicalTotal)&#39;}]</span>
<span class="sd">        * list of dictionaries with the key being the section of info.json to print info from, and the value being the item with in that section to print the value</span>
<span class="sd">        * This is passed through to :class:`pytan.sessions.Session`</span>
<span class="sd">    persistent: bool, optional</span>
<span class="sd">        * default: False</span>
<span class="sd">        * False: do not request a persistent session</span>
<span class="sd">        * True: do request a persistent</span>
<span class="sd">        * This is passed through to :func:`pytan.sessions.Session.authenticate`</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">      * for 6.2: port 444 is the default SOAP port, port 443 forwards /soap/ URLs to the SOAP port,</span>
<span class="sd">        Use port 444 if you have direct access to it. However, port 444 is the only port that</span>
<span class="sd">        exposes the /info page in 6.2</span>
<span class="sd">      * for 6.5: port 443 is the default SOAP port, there is no port 444</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :data:`pytan.constants.LOG_LEVEL_MAPS` : maps a given `loglevel` to respective logger names and their logger levels</span>
<span class="sd">    :data:`pytan.constants.INFO_FORMAT` : debugformat=False</span>
<span class="sd">    :data:`pytan.constants.DEBUG_FORMAT` : debugformat=True</span>
<span class="sd">    :class:`taniumpy.session.Session` : Session object used by Handler</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Setup a Handler() object::</span>

<span class="sd">        &gt;&gt;&gt; import sys</span>
<span class="sd">        &gt;&gt;&gt; sys.path.append(&#39;/path/to/pytan/&#39;)</span>
<span class="sd">        &gt;&gt;&gt; import pytan</span>
<span class="sd">        &gt;&gt;&gt; handler = pytan.Handler(&#39;username&#39;, &#39;password&#39;, &#39;host&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">443</span><span class="p">,</span>
                 <span class="n">loglevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">debugformat</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">gmt_log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Handler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;pytan.handler&quot;</span><span class="p">)</span>

        <span class="c"># setup the console logging handler</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">setup_console_logging</span><span class="p">(</span><span class="n">gmt_log</span><span class="p">)</span>
        <span class="c"># create all the loggers and set their levels based on loglevel</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">set_log_levels</span><span class="p">(</span><span class="n">loglevel</span><span class="p">)</span>
        <span class="c"># change the format of console logging handler if need be</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">change_console_format</span><span class="p">(</span><span class="n">debugformat</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">=</span> <span class="n">loglevel</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">session_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;Must supply username!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">session_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;Must supply password!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;Must supply host!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">port</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;Must supply port!&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;port must be an integer!&quot;</span><span class="p">)</span>

        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">test_app_port</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>

        <span class="c"># establish our Session class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">sessions</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># authenticate using the Session class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session_id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="c"># set the object&#39;s server_version to Not yet determined for now, this will be updated</span>
        <span class="c"># by self.get_server_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="s">&quot;Not yet determined&quot;</span>

        <span class="c"># start up a background thread to get the server version</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_server_version</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">())</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_tpl</span> <span class="o">=</span> <span class="s">&quot;Handler for {}, Version: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">server_version</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;server_version&#39;</span><span class="p">,</span> <span class="s">&#39;Version Unavailable&#39;</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">str_tpl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">server_version</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

<div class="viewcode-block" id="Handler.get_server_version"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_server_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uses :func:`taniumpy.session.Session.get_server_version` to get the version of the Tanium Server</span>

<span class="sd">        Updates self.server_version with the return, and updates self.server_version_dict with a parsed version of self.server_version into major, minor, revision, and build.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self.server_version: str</span>
<span class="sd">            * Version of Tanium Server in string format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_server_version</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_version_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_versioning</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span>

    <span class="c"># Questions</span></div>
<div class="viewcode-block" id="Handler.ask"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.ask">[docs]</a>    <span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a type of question and get the results back</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qtype : str, optional</span>
<span class="sd">            * default: &#39;manual&#39;</span>
<span class="sd">            * type of question to ask: {&#39;saved&#39;, &#39;manual&#39;, &#39;_manual&#39;}</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : dict, containing:</span>
<span class="sd">            * `question_object` : one of the following depending on `qtype`: :class:`taniumpy.object_types.question.Question` or :class:`taniumpy.object_types.saved_question.SavedQuestion`</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.Q_OBJ_MAP` : maps qtype to a method in Handler()</span>
<span class="sd">        :func:`pytan.handler.Handler.ask_saved` : method used when qtype == &#39;saved&#39;</span>
<span class="sd">        :func:`pytan.handler.Handler.ask_manual` : method used when qtype == &#39;manual&#39;</span>
<span class="sd">        :func:`pytan.handler.Handler._ask_manual` : method used when qtype == &#39;_manual&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qtype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;qtype&#39;</span><span class="p">,</span> <span class="s">&#39;manual&#39;</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;qtype&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">q_obj_map</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_q_obj_map</span><span class="p">(</span><span class="n">qtype</span><span class="o">=</span><span class="n">qtype</span><span class="p">)</span>

        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q_obj_map</span><span class="p">[</span><span class="s">&#39;handler&#39;</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler.ask_saved"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.ask_saved">[docs]</a>    <span class="k">def</span> <span class="nf">ask_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">refresh_data</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a saved question and get the results back</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int, list of int, optional</span>
<span class="sd">            * id of saved question to ask</span>
<span class="sd">        name : str, list of str</span>
<span class="sd">            * name of saved question</span>
<span class="sd">        refresh_data: bool, optional</span>
<span class="sd">            * default False</span>
<span class="sd">            * False: do not perform a getResultInfo before issuing a getResultData</span>
<span class="sd">            * True: perform a getResultInfo before issuing a getResultData</span>
<span class="sd">        sse : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: perform a server side export when getting result data</span>
<span class="sd">            * False: perform a normal get result data (default for 6.2)</span>
<span class="sd">        sse_format : str, optional</span>
<span class="sd">            * default: &#39;xml_obj&#39;</span>
<span class="sd">            * format to have server side export report in, one of: {&#39;csv&#39;, &#39;xml&#39;, &#39;xml_obj&#39;, &#39;cef&#39;, 0, 1, 2}</span>
<span class="sd">        leading : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * used for sse_format &#39;cef&#39; only, the string to prepend to each row</span>
<span class="sd">        trailing : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * used for sse_format &#39;cef&#39; only, the string to append to each row</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing</span>
<span class="sd">            * `question_object` : :class:`taniumpy.object_types.saved_question.SavedQuestion`, the saved question object</span>
<span class="sd">            * `question_object` : :class:`taniumpy.object_types.question.Question`, the question asked by `saved_question_object`</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`, the results for `question_object`</span>
<span class="sd">            * `poller_object` : None if `refresh_data` == False, elsewise :class:`pytan.pollers.QuestionPoller`, poller object used to wait until all results are in before getting `question_results`,</span>
<span class="sd">            * `poller_success` : None if `refresh_data` == False, elsewise True or False</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        id or name must be supplied</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sse&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">clean_kwargs</span><span class="p">[</span><span class="s">&#39;sse_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sse_format&#39;</span><span class="p">,</span> <span class="s">&#39;xml_obj&#39;</span><span class="p">)</span>

        <span class="c"># get the saved_question object the user passed in</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find saved question objects&quot;</span>
        <span class="n">sq_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;saved_question&#39;</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sq_objs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Multiple saved questions returned, can only ask one &quot;</span>
                <span class="s">&quot;saved question!</span><span class="se">\n</span><span class="s">Args: {}</span><span class="se">\n</span><span class="s">Returned saved questions:</span><span class="se">\n\t</span><span class="s">{}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="n">sq_obj_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sq_objs</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">sq_obj_str</span><span class="p">))</span>

        <span class="n">sq_obj</span> <span class="o">=</span> <span class="n">sq_objs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Issue a GetObject to get the full object of the last question asked by a saved &quot;</span>
            <span class="s">&quot;question&quot;</span>
        <span class="p">)</span>
        <span class="n">q_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">sq_obj</span><span class="o">.</span><span class="n">question</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">poller</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">poller_success</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">refresh_data</span><span class="p">:</span>
            <span class="c"># if GetResultInfo is issued on a saved question, Tanium will issue a new question</span>
            <span class="c"># to fetch new/updated results</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Issue a GetResultInfo for a saved question in order to issue a new question, &quot;</span>
                <span class="s">&quot;which refreshes the data for that saved question&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_result_info</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">sq_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="c"># re-fetch the saved question object to get the newly asked question info</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Issue a GetObject for the saved question in order get the ID of the newly &quot;</span>
                <span class="s">&quot;asked question&quot;</span>
            <span class="p">)</span>
            <span class="n">shrunk_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">shrink_obj</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">sq_obj</span><span class="p">)</span>
            <span class="n">sq_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">shrunk_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Issue a GetObject to get the full object of the last question asked by a saved &quot;</span>
                <span class="s">&quot;question&quot;</span>
            <span class="p">)</span>
            <span class="n">q_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">sq_obj</span><span class="o">.</span><span class="n">question</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Question Added, ID: {}, query text: {!r}, expires: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">q_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">q_obj</span><span class="o">.</span><span class="n">query_text</span><span class="p">,</span> <span class="n">q_obj</span><span class="o">.</span><span class="n">expiration</span><span class="p">))</span>

            <span class="c"># poll the new question for this saved question to wait for results</span>
            <span class="n">poller</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">pollers</span><span class="o">.</span><span class="n">QuestionPoller</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">q_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
            <span class="n">poller_success</span> <span class="o">=</span> <span class="n">poller</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="c"># get the results</span>
        <span class="k">if</span> <span class="n">sse</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_is_6_2</span><span class="p">():</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Issue a GetResultData for a server side export to get the answers for the last &quot;</span>
                <span class="s">&quot;asked question of this saved question&quot;</span>
            <span class="p">)</span>

            <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data_sse</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">q_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Issue a GetResultData to get the answers for the last asked question of &quot;</span>
                <span class="s">&quot;this saved question&quot;</span>
            <span class="p">)</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">q_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">result_set</span><span class="o">.</span><span class="n">ResultSet</span><span class="p">):</span>
            <span class="c"># add the sensors from this question to the ResultSet object for reporting</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">sensor</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">q_obj</span><span class="o">.</span><span class="n">selects</span><span class="p">]</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;saved_question_object&#39;</span><span class="p">:</span> <span class="n">sq_obj</span><span class="p">,</span>
            <span class="s">&#39;poller_object&#39;</span><span class="p">:</span> <span class="n">poller</span><span class="p">,</span>
            <span class="s">&#39;poller_success&#39;</span><span class="p">:</span> <span class="n">poller_success</span><span class="p">,</span>
            <span class="s">&#39;question_object&#39;</span><span class="p">:</span> <span class="n">q_obj</span><span class="p">,</span>
            <span class="s">&#39;question_results&#39;</span><span class="p">:</span> <span class="n">rd</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler.ask_manual"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.ask_manual">[docs]</a>    <span class="k">def</span> <span class="nf">ask_manual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a manual question using human strings and get the results back</span>

<span class="sd">        This method takes a string or list of strings and parses them into</span>
<span class="sd">        their corresponding definitions needed by :func:`_ask_manual`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sensors : str, list of str</span>
<span class="sd">            * default: []</span>
<span class="sd">            * sensors (columns) to include in question</span>
<span class="sd">        question_filters : str, list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * filters that apply to the whole question</span>
<span class="sd">        question_options : str, list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * options that apply to the whole question</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: wait for result completion after asking question</span>
<span class="sd">            * False: just ask the question and return it in result</span>
<span class="sd">        sensors_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for sensors</span>
<span class="sd">            * True: print the help string for sensors and exit</span>
<span class="sd">        filters_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for filters</span>
<span class="sd">            * True: print the help string for filters and exit</span>
<span class="sd">        options_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for options</span>
<span class="sd">            * True: print the help string for options and exit</span>
<span class="sd">        polling_secs : int, optional</span>
<span class="sd">            * default: 5</span>
<span class="sd">            * Number of seconds to wait in between GetResultInfo loops</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        complete_pct : int/float, optional</span>
<span class="sd">            * default: 99</span>
<span class="sd">            * Percentage of mr_tested out of estimated_total to consider the question &quot;done&quot;</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        override_timeout_secs : int, optional</span>
<span class="sd">            * default: 0</span>
<span class="sd">            * If supplied and not 0, timeout in seconds instead of when object expires</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        callbacks : dict, optional</span>
<span class="sd">            * default: {}</span>
<span class="sd">            * can be a dict of functions to be run with the key names being the various state changes: &#39;ProgressChanged&#39;, &#39;AnswersChanged&#39;, &#39;AnswersComplete&#39;</span>
<span class="sd">            * This is passed through to :func:`pytan.pollers.QuestionPoller.run`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : dict, containing:</span>
<span class="sd">            * `question_object` : :class:`taniumpy.object_types.question.Question`, the actual question created and added by PyTan</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`, the Result Set for `question_object` if `get_results` == True</span>
<span class="sd">            * `poller_object` : :class:`pytan.pollers.QuestionPoller`, poller object used to wait until all results are in before getting `question_results`</span>
<span class="sd">            * `poller_success` : None if `get_results` == True, elsewise True or False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # example of str for `sensors`</span>
<span class="sd">        &gt;&gt;&gt; sensors = &#39;Sensor1&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `sensors` with params</span>
<span class="sd">        &gt;&gt;&gt; sensors = &#39;Sensor1{key:value}&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `sensors` with params and filter</span>
<span class="sd">        &gt;&gt;&gt; sensors = &#39;Sensor1{key:value}, that contains:example text&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `sensors` with params and filter and options</span>
<span class="sd">        &gt;&gt;&gt; sensors = (</span>
<span class="sd">        ...     &#39;Sensor1{key:value}, that contains:example text,&#39;</span>
<span class="sd">        ...     &#39;opt:ignore_case, opt:max_data_age:60&#39;</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; # example of str for question_filters</span>
<span class="sd">        &gt;&gt;&gt; question_filters = &#39;Sensor2, that contains:example test&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of list of str for question_options</span>
<span class="sd">        &gt;&gt;&gt; question_options = [&#39;max_data_age:3600&#39;, &#39;and&#39;]</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        When asking a question from the Tanium console, you construct a question like:</span>

<span class="sd">            Get Computer Name and IP Route Details from all machines with Is Windows containing &quot;True&quot;</span>

<span class="sd">        Asking the same question in PyTan has some similarities:</span>

<span class="sd">            &gt;&gt;&gt; r = handler.ask_manual(sensors=[&#39;Computer Name&#39;, &#39;IP Route Details&#39;], question_filters=[&#39;Is Windows, that contains:True&#39;])</span>

<span class="sd">        There are two sensors in this question, after the &quot;Get&quot; and before the &quot;from all machines&quot;: &quot;Computer Name&quot; and &quot;IP Route Details&quot;. The sensors after the &quot;Get&quot; and before the &quot;from all machines&quot; can be referred to as any number of things:</span>

<span class="sd">            * sensors</span>
<span class="sd">            * left hand side</span>
<span class="sd">            * column selects</span>

<span class="sd">        The sensors that are defined after the &quot;Get&quot; and before the &quot;from all machines&quot; are best described as a column selection, and control what columns you want to show up in your results. These sensor names are the same ones that would need to be passed into ask_question() for the sensors arguments.</span>

<span class="sd">        You can filter your column selections by using a filter in the console like so:</span>

<span class="sd">            Get Computer Name starting with &quot;finance&quot; and IP Route Details from all machines with Is Windows containing &quot;True&quot;</span>

<span class="sd">        And in PyTan:</span>

<span class="sd">             &gt;&gt;&gt; r = handler.ask_manual(sensors=[&#39;Computer Name, that starts with:finance&#39;, &#39;IP Route Details&#39;], question_filters=[&#39;Is Windows, that contains:True&#39;])</span>

<span class="sd">        This will cause the results to have the same number of columns, but for any machine that returns results that do not match the filter specified for a given sensor, the row for that column will contain &quot;[no results]&quot;.</span>

<span class="sd">        There is also a sensor specified after the &quot;from all machines with&quot;: &quot;Is Windows&quot;. This sensor can be referred to as any number of things:</span>

<span class="sd">            * question filters</span>
<span class="sd">            * sensors (also)</span>
<span class="sd">            * right hand side</span>
<span class="sd">            * row selects</span>

<span class="sd">        Any system that does not match the conditions in the question filters will return no results at all.  These question filters are really just sensors all over again, but instead of controlling what columns are output in the results, they control what rows are output in the results.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filter dictionaries for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid option dictionaries for options</span>
<span class="sd">        :func:`pytan.handler.Handler._ask_manual` : private method with the actual workflow used to create and add the question object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">check_for_help</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">sensors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sensors&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">q_filters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;question_filters&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">q_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;question_options&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">sensor_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_sensors</span><span class="p">(</span><span class="n">sensors</span><span class="o">=</span><span class="n">sensors</span><span class="p">)</span>
        <span class="n">q_filter_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_filters</span><span class="p">(</span><span class="n">question_filters</span><span class="o">=</span><span class="n">q_filters</span><span class="p">)</span>
        <span class="n">q_option_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_options</span><span class="p">(</span><span class="n">question_options</span><span class="o">=</span><span class="n">q_options</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;sensor_defs&#39;</span><span class="p">,</span> <span class="s">&#39;question_filter_defs&#39;</span><span class="p">,</span> <span class="s">&#39;question_option_defs&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask_manual</span><span class="p">(</span>
            <span class="n">sensor_defs</span><span class="o">=</span><span class="n">sensor_defs</span><span class="p">,</span>
            <span class="n">question_filter_defs</span><span class="o">=</span><span class="n">q_filter_defs</span><span class="p">,</span>
            <span class="n">question_option_defs</span><span class="o">=</span><span class="n">q_option_defs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler.parse_query"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.parse_query">[docs]</a>    <span class="k">def</span> <span class="nf">parse_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question_text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a parsed question as `question_text` and get a list of parsed results back</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        question_text : str</span>
<span class="sd">            * The question text you want the server to parse into a list of parsed results</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        parse_job_results : :class:`taniumpy.object_types.parse_result_group.ParseResultGroup`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_is_6_2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;ParseJob not supported in version: {} / {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_dict</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">UnsupportedVersionError</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="n">parse_job</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">ParseJob</span><span class="p">()</span>
        <span class="n">parse_job</span><span class="o">.</span><span class="n">question_text</span> <span class="o">=</span> <span class="n">question_text</span>
        <span class="n">parse_job</span><span class="o">.</span><span class="n">parser_version</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">parse_job_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">parse_job</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parse_job_results</span>
</div>
<div class="viewcode-block" id="Handler.ask_parsed"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.ask_parsed">[docs]</a>    <span class="k">def</span> <span class="nf">ask_parsed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question_text</span><span class="p">,</span> <span class="n">picker</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">get_results</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a parsed question as `question_text` and use the index of the parsed results from `picker`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        question_text : str</span>
<span class="sd">            * The question text you want the server to parse into a list of parsed results</span>
<span class="sd">        picker : int</span>
<span class="sd">            * default: None</span>
<span class="sd">            * The index number of the parsed results that correlates to the actual question you wish to run</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: wait for result completion after asking question</span>
<span class="sd">            * False: just ask the question and return it in `ret`</span>
<span class="sd">        sse : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: perform a server side export when getting result data</span>
<span class="sd">            * False: perform a normal get result data (default for 6.2)</span>
<span class="sd">        sse_format : str, optional</span>
<span class="sd">            * default: &#39;xml_obj&#39;</span>
<span class="sd">            * format to have server side export report in, one of: {&#39;csv&#39;, &#39;xml&#39;, &#39;xml_obj&#39;, &#39;cef&#39;, 0, 1, 2}</span>
<span class="sd">        leading : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * used for sse_format &#39;cef&#39; only, the string to prepend to each row</span>
<span class="sd">        trailing : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * used for sse_format &#39;cef&#39; only, the string to append to each row</span>
<span class="sd">        polling_secs : int, optional</span>
<span class="sd">            * default: 5</span>
<span class="sd">            * Number of seconds to wait in between GetResultInfo loops</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        complete_pct : int/float, optional</span>
<span class="sd">            * default: 99</span>
<span class="sd">            * Percentage of mr_tested out of estimated_total to consider the question &quot;done&quot;</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        override_timeout_secs : int, optional</span>
<span class="sd">            * default: 0</span>
<span class="sd">            * If supplied and not 0, timeout in seconds instead of when object expires</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        callbacks : dict, optional</span>
<span class="sd">            * default: {}</span>
<span class="sd">            * can be a dict of functions to be run with the key names being the various state changes: &#39;ProgressChanged&#39;, &#39;AnswersChanged&#39;, &#39;AnswersComplete&#39;</span>
<span class="sd">            * This is passed through to :func:`pytan.pollers.QuestionPoller.run`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing:</span>
<span class="sd">            * `question_object` : :class:`taniumpy.object_types.question.Question`, the actual question added by PyTan</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`, the Result Set for `question_object` if `get_results` == True</span>
<span class="sd">            * `poller_object` : :class:`pytan.pollers.QuestionPoller`, poller object used to wait until all results are in before getting `question_results`</span>
<span class="sd">            * `poller_success` : None if `get_results` == True, elsewise True or False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        Ask the server to parse &#39;computer name&#39;, but don&#39;t pick a choice (will print out a list of choices at critical logging level and then throw an exception):</span>
<span class="sd">            &gt;&gt;&gt; v = handler.ask_parsed(&#39;computer name&#39;)</span>

<span class="sd">        Ask the server to parse &#39;computer name&#39; and pick index 1 as the question you want to run:</span>
<span class="sd">            &gt;&gt;&gt; v = handler.ask_parsed(&#39;computer name&#39;, picker=1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_is_6_2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;ParseJob not supported in version: {} / {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_dict</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">UnsupportedVersionError</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;question_text&#39;</span><span class="p">,</span> <span class="s">&#39;handler&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">sse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sse&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">clean_kwargs</span><span class="p">[</span><span class="s">&#39;sse_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sse_format&#39;</span><span class="p">,</span> <span class="s">&#39;xml_obj&#39;</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a ParseJob for question_text and get back ParseResultGroups&quot;</span>
        <span class="n">parse_job_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_query</span><span class="p">(</span>
            <span class="n">question_text</span><span class="o">=</span><span class="n">question_text</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">parse_job_results</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Question Text &#39;{}&#39; was unable to be parsed into a valid query text by the server&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ServerParseError</span><span class="p">(</span><span class="n">m</span><span class="p">())</span>

        <span class="n">pi</span> <span class="o">=</span> <span class="s">&quot;Index {0}, Score: {1.score}, Query: {1.question_text!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">pw</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;You must supply an index as picker=$index to choose one of the parse &quot;</span>
            <span class="s">&quot;responses -- re-run ask_parsed with picker set to one of these indexes!!&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">format</span>

        <span class="k">if</span> <span class="n">picker</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">pw</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parse_job_results</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">pi</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">PickerError</span><span class="p">(</span><span class="n">pw</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">picked_parse_job</span> <span class="o">=</span> <span class="n">parse_job_results</span><span class="p">[</span><span class="n">picker</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">invalid_pw</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;You supplied an invalid picker index {} - {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">invalid_pw</span><span class="p">(</span><span class="n">picker</span><span class="p">,</span> <span class="n">pw</span><span class="p">))</span>

            <span class="n">pi</span> <span class="o">=</span> <span class="s">&quot;Index {0}, Score: {1.score}, Query: {1.question_text!r}&quot;</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parse_job_results</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">pi</span><span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">PickerError</span><span class="p">(</span><span class="n">pw</span><span class="p">())</span>

        <span class="n">add_obj</span> <span class="o">=</span> <span class="n">picked_parse_job</span><span class="o">.</span><span class="n">question</span>

        <span class="c"># add our Question and get a Question ID back</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add the Question object from the chosen ParseResultGroup&quot;</span>
        <span class="n">added_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Question Added, ID: {}, query text: {!r}, expires: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">added_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">added_obj</span><span class="o">.</span><span class="n">query_text</span><span class="p">,</span> <span class="n">added_obj</span><span class="o">.</span><span class="n">expiration</span><span class="p">))</span>

        <span class="n">poller</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">pollers</span><span class="o">.</span><span class="n">QuestionPoller</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;question_object&#39;</span><span class="p">:</span> <span class="n">added_obj</span><span class="p">,</span>
            <span class="s">&#39;poller_object&#39;</span><span class="p">:</span> <span class="n">poller</span><span class="p">,</span>
            <span class="s">&#39;question_results&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;poller_success&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">get_results</span><span class="p">:</span>
            <span class="c"># poll the Question ID returned above to wait for results</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;poller_success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s">&#39;poller_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="c"># get the results</span>
            <span class="k">if</span> <span class="n">sse</span><span class="p">:</span>
                <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data_sse</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">result_set</span><span class="o">.</span><span class="n">ResultSet</span><span class="p">):</span>
                <span class="c"># add the sensors from this question to the ResultSet object for reporting</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">sensors</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">sensor</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">added_obj</span><span class="o">.</span><span class="n">selects</span><span class="p">]</span>

            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;question_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="c"># Actions</span></div>
<div class="viewcode-block" id="Handler.deploy_action"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.deploy_action">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deploy an action and get the results back</span>

<span class="sd">        This method takes a string or list of strings and parses them into</span>
<span class="sd">        their corresponding definitions needed by :func:`_deploy_action`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        package : str</span>
<span class="sd">            * package to deploy with this action</span>
<span class="sd">        action_filters : str, list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * each string must describe a sensor and a filter which limits which computers the action will deploy `package` to</span>
<span class="sd">        action_options : str, list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * options to apply to `action_filters`</span>
<span class="sd">        start_seconds_from_now : int, optional</span>
<span class="sd">            * default: 0</span>
<span class="sd">            * start action N seconds from now</span>
<span class="sd">        expire_seconds : int, optional</span>
<span class="sd">            * default: package.expire_seconds</span>
<span class="sd">            * expire action N seconds from now, will be derived from package if not supplied</span>
<span class="sd">        run : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: just ask the question that pertains to verify action, export the results to CSV, and raise pytan.exceptions.RunFalse -- does not deploy the action</span>
<span class="sd">            * True: actually deploy the action</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: wait for result completion after deploying action</span>
<span class="sd">            * False: just deploy the action and return the object in `ret`</span>
<span class="sd">        package_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for package</span>
<span class="sd">            * True: print the help string for package and exit</span>
<span class="sd">        filters_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for filters</span>
<span class="sd">            * True: print the help string for filters and exit</span>
<span class="sd">        options_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for options</span>
<span class="sd">            * True: print the help string for options and exit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing:</span>
<span class="sd">            * `saved_action_object` : :class:`taniumpy.object_types.saved_action.SavedAction`, the saved_action added for this action (None if 6.2)</span>
<span class="sd">            * `action_object` : :class:`taniumpy.object_types.action.Action`, the action object that tanium created for `saved_action`</span>
<span class="sd">            * `package_object` : :class:`taniumpy.object_types.package_spec.PackageSPec`, the package object used in `saved_action`</span>
<span class="sd">            * `action_info` : :class:`taniumpy.object_types.result_info.ResultInfo`, the initial GetResultInfo call done before getting results</span>
<span class="sd">            * `poller_object` : :class:`pytan.pollers.ActionPoller`, poller object used to wait until all results are in before getting `action_results`</span>
<span class="sd">            * `poller_success` : None if `get_results` == False, elsewise True or False</span>
<span class="sd">            * `action_results` : None if `get_results` == False, elsewise :class:`taniumpy.object_types.result_set.ResultSet`, the results for `action_object`</span>
<span class="sd">            * `action_result_map` : None if `get_results` == False, elsewise progress map for `action_object` in dictionary form</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # example of str for `package`</span>
<span class="sd">        &gt;&gt;&gt; package = &#39;Package1&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `package` with params</span>
<span class="sd">        &gt;&gt;&gt; package = &#39;Package1{key:value}&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `action_filters` with params and filter for sensors</span>
<span class="sd">        &gt;&gt;&gt; action_filters = &#39;Sensor1{key:value}, that contains:example text&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of list of str for `action_options`</span>
<span class="sd">        &gt;&gt;&gt; action_options = [&#39;max_data_age:3600&#39;, &#39;and&#39;]</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filter dictionaries for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid option dictionaries for options</span>
<span class="sd">        :func:`pytan.handler.Handler._deploy_action` : private method with the actual workflow used to create and add the action object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">check_for_help</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># the human string describing the sensors/filter that user wants</span>
        <span class="c"># to deploy the action against</span>
        <span class="n">action_filters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action_filters&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c"># the question options to use on the pre-action question and on the</span>
        <span class="c"># group for the action filters</span>
        <span class="n">action_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action_options&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c"># name of package to deploy with params as {key=value1,key2=value2}</span>
        <span class="n">package</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;package&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="n">action_filter_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_sensors</span><span class="p">(</span><span class="n">action_filters</span><span class="p">,</span> <span class="s">&#39;action_filters&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">action_option_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_options</span><span class="p">(</span><span class="n">action_options</span><span class="p">)</span>
        <span class="n">package_def</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_package</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;package_def&#39;</span><span class="p">,</span> <span class="s">&#39;action_filter_defs&#39;</span><span class="p">,</span> <span class="s">&#39;action_option_defs&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">deploy_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deploy_action</span><span class="p">(</span>
            <span class="n">action_filter_defs</span><span class="o">=</span><span class="n">action_filter_defs</span><span class="p">,</span>
            <span class="n">action_option_defs</span><span class="o">=</span><span class="n">action_option_defs</span><span class="p">,</span>
            <span class="n">package_def</span><span class="o">=</span><span class="n">package_def</span><span class="p">,</span>
            <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">deploy_result</span>
</div>
<div class="viewcode-block" id="Handler.approve_saved_action"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.approve_saved_action">[docs]</a>    <span class="k">def</span> <span class="nf">approve_saved_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Approve a saved action</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            * id of saved action to approve</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        saved_action_approve_obj : :class:`taniumpy.object_types.saved_action_approval.SavedActionApproval`</span>
<span class="sd">            * The object containing the return from SavedActionApproval</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="s">&#39;objtype&#39;</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find saved action objects&quot;</span>
        <span class="n">saved_action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;saved_action&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">add_sap_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">SavedActionApproval</span><span class="p">()</span>
        <span class="n">add_sap_obj</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">saved_action_obj</span><span class="o">.</span><span class="n">id</span>
        <span class="n">add_sap_obj</span><span class="o">.</span><span class="n">approved_flag</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c"># we dont want to re-fetch the object, so use sessions add instead of handlers add</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a SavedActionApproval&quot;</span>
        <span class="n">sap_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_sap_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;Action approved successfully, ID of saved action : {}&#39;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">sap_obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">sap_obj</span>
</div>
<div class="viewcode-block" id="Handler.stop_action"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.stop_action">[docs]</a>    <span class="k">def</span> <span class="nf">stop_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop an action</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            * id of action to stop</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        action_stop_obj : :class:`taniumpy.object_types.action_stop.ActionStop`</span>
<span class="sd">            The object containing the ID of the action stop job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="s">&#39;objtype&#39;</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find the action object we want to stop&quot;</span>
        <span class="n">action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">add_action_stop_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">ActionStop</span><span class="p">()</span>
        <span class="n">add_action_stop_obj</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action_obj</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a StopAction&quot;</span>
        <span class="n">action_stop_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_action_stop_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Re-issue a GetObject to ensure the stopped_flag is 1&quot;</span>
        <span class="n">after_action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">after_action_obj</span><span class="o">.</span><span class="n">stopped_flag</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&#39;Action stopped successfully, ID of action stop: {}&#39;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_stop_obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Action not stopped successfully, json of action after issuing StopAction: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_obj</span><span class="p">(</span><span class="n">after_action_obj</span><span class="p">,</span> <span class="s">&#39;json&#39;</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">action_stop_obj</span>

    <span class="c"># Result Data / Result Info</span></div>
<div class="viewcode-block" id="Handler.get_result_data"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_result_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_result_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the result data for a python API object</span>

<span class="sd">        This method issues a GetResultData command to the SOAP api for `obj`. GetResultData returns the columns and rows that are currently available for `obj`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to get result data for</span>
<span class="sd">        aggregate : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: get all the data</span>
<span class="sd">            * True: get just the aggregate data (row counts of matches)</span>
<span class="sd">        shrink : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: Shrink the object down to just id/name/hash attributes (for smaller request)</span>
<span class="sd">            * False: Use the full object as is</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rd : :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            The return of GetResultData for `obj`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="sd">&quot;&quot;&quot; note #1 from jwk:</span>
<span class="sd">        For Action GetResultData: You have to make a ResultInfo request at least once every 2 minutes. The server gathers the result data by asking a saved question. It won&#39;t re-issue the saved question unless you make a GetResultInfo request. When you make a GetResultInfo request, if there is no question that is less than 2 minutes old, the server will automatically reissue a new question instance to make sure fresh data is available.</span>

<span class="sd">        note #2 from jwk:</span>
<span class="sd">        To get the aggregate data (without computer names), set row_counts_only_flag = 1. To get the computer names, use row_counts_only_flag = 0 (default).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">shrink</span><span class="p">:</span>
            <span class="n">shrunk_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">shrink_obj</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shrunk_obj</span> <span class="o">=</span> <span class="n">obj</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;export_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_kwargs_int</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s">&#39;export_flag&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;export_flag&#39;</span><span class="p">]:</span>
            <span class="n">grd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_result_data_sse</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_result_data</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetResultData to get answers for a question&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;suppress_object_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;suppress_object_list&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c"># do a getresultdata</span>
        <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;row_counts_only_flag&#39;</span><span class="p">]</span>
            <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="n">grd</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">shrunk_obj</span><span class="p">,</span> <span class="n">row_counts_only_flag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
            <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="n">grd</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">shrunk_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rd</span>
</div>
<div class="viewcode-block" id="Handler.get_result_data_sse"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_result_data_sse">[docs]</a>    <span class="k">def</span> <span class="nf">get_result_data_sse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">sse_format</span><span class="o">=</span><span class="s">&#39;csv&#39;</span><span class="p">,</span> <span class="n">leading</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">trailing</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the result data for a python API object using a server side export (sse)</span>

<span class="sd">        This method issues a GetResultData command to the SOAP api for `obj` with the option</span>
<span class="sd">        `export_flag` set to 1. This will cause the server to process all of the data for a given</span>
<span class="sd">        result set and save it as `export_format`. Then the user can use an authenticated GET</span>
<span class="sd">        request to get the status of the file via &quot;/export/${export_id}.status&quot;. Once the status</span>
<span class="sd">        returns &quot;Completed.&quot;, the actual report file can be retrieved by an authenticated GET</span>
<span class="sd">        request to &quot;/export/${export_id}.gz&quot;. This workflow saves a lot of processing time and removes the need to paginate large result sets necessary in normal GetResultData calls.</span>

<span class="sd">        *Version support*</span>
<span class="sd">            * 6.5.314.4231: initial sse support (csv only)</span>
<span class="sd">            * 6.5.314.4300: export_format support (adds xml and cef)</span>
<span class="sd">            * 6.5.314.4300: fix core dump if multiple sse done on empty resultset</span>
<span class="sd">            * 6.5.314.4300: fix no status file if sse done on empty resultset</span>
<span class="sd">            * 6.5.314.4300: fix response if more than two sse done in same second</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to get result data for</span>
<span class="sd">        sse_format : str, optional</span>
<span class="sd">            * default: &#39;csv&#39;</span>
<span class="sd">            * format to have server create report in, one of: {&#39;csv&#39;, &#39;xml&#39;, &#39;xml_obj&#39;, &#39;cef&#39;, 0, 1, 2}</span>
<span class="sd">        leading : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * used for sse_format &#39;cef&#39; only, the string to prepend to each row</span>
<span class="sd">        trailing : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * used for sse_format &#39;cef&#39; only, the string to append to each row</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.SSE_FORMAT_MAP` : maps `sse_format` to an integer for use by the SOAP API</span>
<span class="sd">        :data:`pytan.constants.SSE_RESTRICT_MAP` : maps sse_format integers to supported platform versions</span>
<span class="sd">        :data:`pytan.constants.SSE_CRASH_MAP` : maps platform versions that can cause issues in various scenarios</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        export_data : either `str` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * If sse_format is one of csv, xml, or cef, export_data will be a `str` containing the contents of the ResultSet in said format</span>
<span class="sd">            * If sse_format is xml_obj, export_data will be a :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sse_version</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sse_crash_prevention</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>

        <span class="n">sse_format_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_sse_format</span><span class="p">(</span><span class="n">sse_format</span><span class="o">=</span><span class="n">sse_format</span><span class="p">)</span>

        <span class="c"># add the export_flag = 1 to the kwargs for inclusion in options node</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;export_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c"># add the export_format to the kwargs for inclusion in options node</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;export_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sse_format_int</span>

        <span class="c"># add the export_leading_text to the kwargs for inclusion in options node</span>
        <span class="k">if</span> <span class="n">leading</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;export_leading_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">leading</span>

        <span class="c"># add the export_trailing_text to the kwargs for inclusion in options node</span>
        <span class="k">if</span> <span class="n">trailing</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;export_trailing_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trailing</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="s">&#39;handler&#39;</span><span class="p">,</span> <span class="s">&#39;export_id&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetResultData to start a Server Side Export and get an export_id&quot;</span>
        <span class="n">export_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Server Side Export Started, id: &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">export_id</span><span class="p">))</span>

        <span class="n">poller</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">pollers</span><span class="o">.</span><span class="n">SSEPoller</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_id</span><span class="o">=</span><span class="n">export_id</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="n">poller_success</span> <span class="o">=</span> <span class="n">poller</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">poller_success</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Server Side Export Poller failed while waiting for completion, last status: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="n">sse_status</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">poller</span><span class="p">,</span> <span class="s">&#39;sse_status&#39;</span><span class="p">,</span> <span class="s">&#39;Unknown&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ServerSideExportError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">sse_status</span><span class="p">))</span>

        <span class="n">export_data</span> <span class="o">=</span> <span class="n">poller</span><span class="o">.</span><span class="n">get_sse_data</span><span class="p">(</span><span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sse_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;xml_obj&#39;</span><span class="p">:</span>
            <span class="n">export_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml_to_result_set_obj</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">export_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">export_data</span>
</div>
<div class="viewcode-block" id="Handler.xml_to_result_set_obj"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.xml_to_result_set_obj">[docs]</a>    <span class="k">def</span> <span class="nf">xml_to_result_set_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wraps a Result Set XML from a server side export in the appropriate tags and returns a ResultSet object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : str</span>
<span class="sd">            * str of XML to convert to a ResultSet object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rs : :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * x converted into a ResultSet object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rs_xml</span> <span class="o">=</span> <span class="s">&#39;&lt;result_sets&gt;&lt;result_set&gt;{}&lt;/result_set&gt;&lt;/result_sets&gt;&#39;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">rs_xml</span> <span class="o">=</span> <span class="n">rs_xml</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">rs_tree</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">sessions</span><span class="o">.</span><span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">rs_xml</span><span class="p">)</span>
        <span class="n">rs</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">ResultSet</span><span class="o">.</span><span class="n">fromSOAPElement</span><span class="p">(</span><span class="n">rs_tree</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rs</span>
</div>
<div class="viewcode-block" id="Handler.get_result_info"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_result_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_result_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the result info for a python API object</span>

<span class="sd">        This method issues a GetResultInfo command to the SOAP api for `obj`. GetResultInfo returns information about how many servers have passed the `obj`, total number of servers, and so on.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to get result data for</span>
<span class="sd">        shrink : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: Shrink the object down to just id/name/hash attributes (for smaller request)</span>
<span class="sd">            * False: Use the full object as is</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ri : :class:`taniumpy.object_types.result_info.ResultInfo`</span>
<span class="sd">            * The return of GetResultData for `obj`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">shrink</span><span class="p">:</span>
            <span class="n">shrunk_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">shrink_obj</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shrunk_obj</span> <span class="o">=</span> <span class="n">obj</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetResultData to get answers for a question&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;suppress_object_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;suppress_object_list&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">ri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_result_info</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">shrunk_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ri</span>

    <span class="c"># Objects</span></div>
<div class="viewcode-block" id="Handler.create_from_json"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_from_json">[docs]</a>    <span class="k">def</span> <span class="nf">create_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new object using the SOAP api from a json file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype : str</span>
<span class="sd">            * Type of object described in `json_file`</span>
<span class="sd">        json_file : str</span>
<span class="sd">            * path to JSON file that describes an API object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * TaniumPy object added to Tanium SOAP Server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.GET_OBJ_MAP` : maps objtype to supported &#39;create_json&#39; types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_map</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_obj_map</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="n">objtype</span><span class="p">)</span>

        <span class="n">create_json_ok</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;create_json&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">create_json_ok</span><span class="p">:</span>
            <span class="n">json_createable</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GET_OBJ_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="s">&#39;create_json&#39;</span><span class="p">]</span>
            <span class="p">])</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;{} is not a json createable object! Supported objects: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">json_createable</span><span class="p">))</span>

        <span class="n">add_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">load_taniumpy_from_json</span><span class="p">(</span><span class="n">json_file</span><span class="o">=</span><span class="n">json_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">add_obj</span><span class="p">,</span> <span class="s">&#39;_list_properties&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="n">obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">add_obj</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_obj</span><span class="p">]</span>

        <span class="n">del_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;hash&#39;</span><span class="p">]</span>
        <span class="p">[</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">obj_list</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">del_keys</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">obj_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;allfix&#39;</span><span class="p">):</span>
            <span class="n">all_type</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;allfix&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_type</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">]</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_taniumpy_obj</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">all_type</span><span class="p">)()</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add an object&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">list_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;Failure while importing {}: {}</span><span class="se">\n</span><span class="s">JSON Dump of object: {}&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New {} (ID: {}) created successfully!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">list_obj</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">list_obj</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;Unknown&#39;</span><span class="p">)))</span>

            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler.run_plugin"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.run_plugin">[docs]</a>    <span class="k">def</span> <span class="nf">run_plugin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper around :func:`pytan.session.Session.run_plugin` to run the plugin and zip up the SQL results into a python dictionary</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.plugin.Plugin`</span>
<span class="sd">            * Plugin object to run</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plugin_result, sql_zipped : tuple</span>
<span class="sd">            * plugin_result will be the taniumpy object representation of the SOAP response from Tanium server</span>
<span class="sd">            * sql_zipped will be a dict with the SQL results embedded in the SOAP response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># run the plugin</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a RunPlugin run a plugin and get results back&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">plugin_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">run_plugin</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="c"># zip up the sql results into a list of python dictionaries</span>
        <span class="n">sql_zipped</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plugin_zip</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">plugin_result</span><span class="p">)</span>

        <span class="c"># return the plugin result and the python dictionary of results</span>
        <span class="k">return</span> <span class="n">plugin_result</span><span class="p">,</span> <span class="n">sql_zipped</span>
</div>
<div class="viewcode-block" id="Handler.create_dashboard"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_dashboard">[docs]</a>    <span class="k">def</span> <span class="nf">create_dashboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">public_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls :func:`pytan.handler.Handler.run_plugin` to run the CreateDashboard plugin and parse the response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            * name of dashboard to create</span>
<span class="sd">        text : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * text for this dashboard</span>
<span class="sd">        group : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * group name for this dashboard</span>
<span class="sd">        public_flag : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: make this dashboard public</span>
<span class="sd">            * False: do not make this dashboard public</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plugin_result, sql_zipped : tuple</span>
<span class="sd">            * plugin_result will be the taniumpy object representation of the SOAP response from Tanium server</span>
<span class="sd">            * sql_zipped will be a dict with the SQL results embedded in the SOAP response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># get the ID for the group if a name was passed in</span>
        <span class="k">if</span> <span class="n">group</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find the ID of a group name&quot;</span>
            <span class="n">group_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;group&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">group_id</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">public_flag</span><span class="p">:</span>
            <span class="n">public_flag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">public_flag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># create the plugin parent</span>
        <span class="n">plugin</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">Plugin</span><span class="p">()</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CreateDashboard&#39;</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">bundle</span> <span class="o">=</span> <span class="s">&#39;Dashboards&#39;</span>

        <span class="c"># create the plugin arguments</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PluginArgumentList</span><span class="p">()</span>

        <span class="n">arg1</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PluginArgument</span><span class="p">()</span>
        <span class="n">arg1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;dash_name&#39;</span>
        <span class="n">arg1</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;String&#39;</span>
        <span class="n">arg1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>

        <span class="n">arg2</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PluginArgument</span><span class="p">()</span>
        <span class="n">arg2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;dash_text&#39;</span>
        <span class="n">arg2</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;String&#39;</span>
        <span class="n">arg2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">text</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span>

        <span class="n">arg3</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PluginArgument</span><span class="p">()</span>
        <span class="n">arg3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;group_id&#39;</span>
        <span class="n">arg3</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;Number&#39;</span>
        <span class="n">arg3</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">group_id</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg3</span><span class="p">)</span>

        <span class="n">arg4</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PluginArgument</span><span class="p">()</span>
        <span class="n">arg4</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;public_flag&#39;</span>
        <span class="n">arg4</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;Number&#39;</span>
        <span class="n">arg4</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">public_flag</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg4</span><span class="p">)</span>

        <span class="n">arg5</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PluginArgument</span><span class="p">()</span>
        <span class="n">arg5</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;sqid_xml&#39;</span>
        <span class="n">arg5</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;String&#39;</span>
        <span class="n">arg5</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg5</span><span class="p">)</span>

        <span class="c"># run the plugin</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a RunPlugin for the CreateDashboard plugin to create a dashboard&quot;</span>
        <span class="n">plugin_result</span><span class="p">,</span> <span class="n">sql_zipped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_plugin</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="c"># return the plugin result and the python dictionary of results</span>
        <span class="k">return</span> <span class="n">plugin_result</span><span class="p">,</span> <span class="n">sql_zipped</span>
</div>
<div class="viewcode-block" id="Handler.delete_dashboard"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.delete_dashboard">[docs]</a>    <span class="k">def</span> <span class="nf">delete_dashboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls :func:`pytan.handler.Handler.run_plugin` to run the DeleteDashboards plugin and parse the response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            * name of dashboard to delete</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plugin_result, sql_zipped : tuple</span>
<span class="sd">            * plugin_result will be the taniumpy object representation of the SOAP response from Tanium server</span>
<span class="sd">            * sql_zipped will be a dict with the SQL results embedded in the SOAP response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;pytan_help&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">dashboards_to_del</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dashboards</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># create the plugin parent</span>
        <span class="n">plugin</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">Plugin</span><span class="p">()</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;DeleteDashboards&#39;</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">bundle</span> <span class="o">=</span> <span class="s">&#39;Dashboards&#39;</span>

        <span class="c"># create the plugin arguments</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PluginArgumentList</span><span class="p">()</span>

        <span class="n">arg1</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PluginArgument</span><span class="p">()</span>
        <span class="n">arg1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;dashboard_ids&#39;</span>
        <span class="n">arg1</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;Number_Set&#39;</span>
        <span class="n">arg1</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dashboards_to_del</span><span class="p">])</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>

        <span class="c"># run the plugin</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a RunPlugin for the DeleteDashboards plugin to delete a dashboard&quot;</span>
        <span class="n">plugin_result</span><span class="p">,</span> <span class="n">sql_zipped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_plugin</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="c"># return the plugin result and the python dictionary of results</span>
        <span class="k">return</span> <span class="n">plugin_result</span><span class="p">,</span> <span class="n">sql_zipped</span>
</div>
<div class="viewcode-block" id="Handler.get_dashboards"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_dashboards">[docs]</a>    <span class="k">def</span> <span class="nf">get_dashboards</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calls :func:`pytan.handler.Handler.run_plugin` to run the GetDashboards plugin and parse the response</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * name of dashboard to get, if empty will return all dashboards</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plugin_result, sql_zipped : tuple</span>
<span class="sd">            * plugin_result will be the taniumpy object representation of the SOAP response from Tanium server</span>
<span class="sd">            * sql_zipped will be a dict with the SQL results embedded in the SOAP response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;pytan_help&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="c"># create the plugin parent</span>
        <span class="n">plugin</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">Plugin</span><span class="p">()</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;GetDashboards&#39;</span>
        <span class="n">plugin</span><span class="o">.</span><span class="n">bundle</span> <span class="o">=</span> <span class="s">&#39;Dashboards&#39;</span>

        <span class="c"># run the plugin</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a RunPlugin for the GetDashboards plugin to get all dashboards&quot;</span>
        <span class="n">plugin_result</span><span class="p">,</span> <span class="n">sql_zipped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_plugin</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">plugin</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="c"># if name specified, filter the list of dicts for matching name</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">sql_zipped</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sql_zipped</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">sql_zipped</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;No dashboards found that match name: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NotFoundError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="c"># return the plugin result and the python dictionary of results</span>
        <span class="k">return</span> <span class="n">plugin_result</span><span class="p">,</span> <span class="n">sql_zipped</span>
</div>
<div class="viewcode-block" id="Handler.create_sensor"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">create_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a sensor object</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>
<span class="sd">        Not currently supported, too complicated to add.</span>
<span class="sd">        Use :func:`create_from_json` instead for this object type!</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        pytan.exceptions.HandlerError : :exc:`pytan.utils.pytan.exceptions.HandlerError`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Sensor creation not supported via PyTan as of yet, too complex</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;Use create_sensor_from_json() instead!&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Handler.create_package"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_package">[docs]</a>    <span class="k">def</span> <span class="nf">create_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">display_name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">file_urls</span><span class="o">=</span><span class="p">[],</span>
                       <span class="n">command_timeout_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">expire_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">parameters_json_file</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">verify_filters</span><span class="o">=</span><span class="p">[],</span> <span class="n">verify_filter_options</span><span class="o">=</span><span class="p">[],</span> <span class="n">verify_expire_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
                       <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a package object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            * name of package to create</span>
<span class="sd">        command : str</span>
<span class="sd">            * command to execute</span>
<span class="sd">        display_name : str, optional</span>
<span class="sd">            * display name of package</span>
<span class="sd">        file_urls : list of strings, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * URL of file to add to package</span>
<span class="sd">            * can optionally define download_seconds by using SECONDS::URL</span>
<span class="sd">            * can optionally define file name by using FILENAME||URL</span>
<span class="sd">            * can combine optionals by using SECONDS::FILENAME||URL</span>
<span class="sd">            * FILENAME will be extracted from basename of URL if not provided</span>
<span class="sd">        command_timeout_seconds : int, optional</span>
<span class="sd">            * default: 600</span>
<span class="sd">            * timeout for command execution in seconds</span>
<span class="sd">        parameters_json_file : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * path to json file describing parameters for package</span>
<span class="sd">        expire_seconds : int, optional</span>
<span class="sd">            * default: 600</span>
<span class="sd">            * timeout for action expiry in seconds</span>
<span class="sd">        verify_filters : str or list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * each string must describe a filter to be used to verify the package</span>
<span class="sd">        verify_filter_options : str or list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * each string must describe an option for `verify_filters`</span>
<span class="sd">        verify_expire_seconds : int, optional</span>
<span class="sd">            * default: 600</span>
<span class="sd">            * timeout for verify action expiry in seconds</span>
<span class="sd">        filters_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for filters</span>
<span class="sd">            * True: print the help string for filters and exit</span>
<span class="sd">        options_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for options</span>
<span class="sd">            * True: print the help string for options and exit</span>
<span class="sd">        metadata: list of list of strs, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * each list must be a 2 item list:</span>
<span class="sd">            * list item 1 property name</span>
<span class="sd">            * list item 2 property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        package_obj : :class:`taniumpy.object_types.package_spec.PackageSpec`</span>
<span class="sd">            * TaniumPy object added to Tanium SOAP Server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filters for verify_filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid options for verify_filter_options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">check_for_help</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="s">&#39;defs&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;metadata&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">metadatalist_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_metadatalist_obj</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span>

        <span class="c"># bare minimum arguments for new package: name, command</span>
        <span class="n">add_package_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PackageSpec</span><span class="p">()</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">display_name</span><span class="p">:</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">display_name</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">command_timeout</span> <span class="o">=</span> <span class="n">command_timeout_seconds</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">expire_seconds</span> <span class="o">=</span> <span class="n">expire_seconds</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadatalist_obj</span>

        <span class="c"># VERIFY FILTERS</span>
        <span class="k">if</span> <span class="n">verify_filters</span><span class="p">:</span>
            <span class="n">verify_filter_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_filters</span><span class="p">(</span>
                <span class="n">question_filters</span><span class="o">=</span><span class="n">verify_filters</span>
            <span class="p">)</span>
            <span class="n">verify_option_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_options</span><span class="p">(</span>
                <span class="n">question_options</span><span class="o">=</span><span class="n">verify_filter_options</span>
            <span class="p">)</span>
            <span class="n">verify_filter_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">defs</span><span class="o">=</span><span class="n">verify_filter_defs</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
            <span class="n">add_verify_group</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_group_obj</span><span class="p">(</span>
                <span class="n">q_filter_defs</span><span class="o">=</span><span class="n">verify_filter_defs</span><span class="p">,</span> <span class="n">q_option_defs</span><span class="o">=</span><span class="n">verify_option_defs</span>
            <span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a Group object for this package&quot;</span>
            <span class="n">verify_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_verify_group</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="c"># this didn&#39;t work:</span>
            <span class="c"># add_package_obj.verify_group = verify_group</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">verify_group_id</span> <span class="o">=</span> <span class="n">verify_group</span><span class="o">.</span><span class="n">id</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">verify_expire_seconds</span> <span class="o">=</span> <span class="n">verify_expire_seconds</span>

        <span class="c"># PARAMETERS</span>
        <span class="k">if</span> <span class="n">parameters_json_file</span><span class="p">:</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">parameter_definition</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">load_param_json_file</span><span class="p">(</span>
                <span class="n">parameters_json_file</span><span class="o">=</span><span class="n">parameters_json_file</span>
            <span class="p">)</span>

        <span class="c"># FILES</span>
        <span class="k">if</span> <span class="n">file_urls</span><span class="p">:</span>
            <span class="n">filelist_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PackageFileList</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">file_urls</span><span class="p">:</span>
                <span class="c"># if :: is in file_url, split on it and use 0 as</span>
                <span class="c"># download_seconds</span>
                <span class="k">if</span> <span class="s">&#39;::&#39;</span> <span class="ow">in</span> <span class="n">file_url</span><span class="p">:</span>
                    <span class="n">download_seconds</span><span class="p">,</span> <span class="n">file_url</span> <span class="o">=</span> <span class="n">file_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;::&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">download_seconds</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c"># if || is in file_url, split on it and use 0 as file name</span>
                <span class="c"># else wise get file name from basename of URL</span>
                <span class="k">if</span> <span class="s">&#39;||&#39;</span> <span class="ow">in</span> <span class="n">file_url</span><span class="p">:</span>
                    <span class="n">filename</span><span class="p">,</span> <span class="n">file_url</span> <span class="o">=</span> <span class="n">file_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;||&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
                <span class="n">file_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PackageFile</span><span class="p">()</span>
                <span class="n">file_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="n">file_obj</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">file_url</span>
                <span class="n">file_obj</span><span class="o">.</span><span class="n">download_seconds</span> <span class="o">=</span> <span class="n">download_seconds</span>
                <span class="n">filelist_obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_obj</span><span class="p">)</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">filelist_obj</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a Group object for this package&quot;</span>
        <span class="n">package_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_package_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New package {!r} created with ID {!r}, command: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">package_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">package_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">package_obj</span><span class="o">.</span><span class="n">command</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">package_obj</span>
</div>
<div class="viewcode-block" id="Handler.create_group"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_group">[docs]</a>    <span class="k">def</span> <span class="nf">create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[],</span> <span class="n">filter_options</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a group object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        groupname : str</span>
<span class="sd">            * name of group to create</span>
<span class="sd">        filters : str or list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * each string must describe a filter</span>
<span class="sd">        filter_options : str or list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * each string must describe an option for `filters`</span>
<span class="sd">        filters_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for filters</span>
<span class="sd">            * True: print the help string for filters and exit</span>
<span class="sd">        options_help : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: do not print the help string for options</span>
<span class="sd">            * True: print the help string for options and exit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        group_obj : :class:`taniumpy.object_types.group.Group`</span>
<span class="sd">            * TaniumPy object added to Tanium SOAP Server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filters for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid options for filter_options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">check_for_help</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">filter_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_filters</span><span class="p">(</span><span class="n">question_filters</span><span class="o">=</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">option_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_options</span><span class="p">(</span><span class="n">question_options</span><span class="o">=</span><span class="n">filter_options</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Issue a GetObject to get the full object of specified sensors for inclusion in a &quot;</span>
            <span class="s">&quot;group&quot;</span>
        <span class="p">)</span>
        <span class="n">filter_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">defs</span><span class="o">=</span><span class="n">filter_defs</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">add_group_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_group_obj</span><span class="p">(</span>
            <span class="n">q_filter_defs</span><span class="o">=</span><span class="n">filter_defs</span><span class="p">,</span> <span class="n">q_option_defs</span><span class="o">=</span><span class="n">option_defs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_group_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">groupname</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a Group object&quot;</span>
        <span class="n">group_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_group_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New group {!r} created with ID {!r}, filter text: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">group_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">group_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">group_obj</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">group_obj</span>
</div>
<div class="viewcode-block" id="Handler.create_user"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_user">[docs]</a>    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">rolename</span><span class="o">=</span><span class="p">[],</span> <span class="n">roleid</span><span class="o">=</span><span class="p">[],</span> <span class="n">properties</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a user object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        username : str</span>
<span class="sd">            * name of user to create</span>
<span class="sd">        rolename : str or list of str, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * name(s) of roles to add to user</span>
<span class="sd">        roleid : int or list of int, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * id(s) of roles to add to user</span>
<span class="sd">        properties: list of list of strs, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * each list must be a 2 item list:</span>
<span class="sd">            * list item 1 property name</span>
<span class="sd">            * list item 2 property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        user_obj : :class:`taniumpy.object_types.user.User`</span>
<span class="sd">            * TaniumPy object added to Tanium SOAP Server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">roleid</span> <span class="ow">or</span> <span class="n">rolename</span><span class="p">:</span>
            <span class="n">rolelist_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;userrole&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">roleid</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rolename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rolelist_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">RoleList</span><span class="p">()</span>

        <span class="n">metadatalist_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_metadatalist_obj</span><span class="p">(</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">nameprefix</span><span class="o">=</span><span class="s">&#39;TConsole.User.Property&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_user_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
        <span class="n">add_user_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">username</span>
        <span class="n">add_user_obj</span><span class="o">.</span><span class="n">roles</span> <span class="o">=</span> <span class="n">rolelist_obj</span>
        <span class="n">add_user_obj</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadatalist_obj</span>

        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a User object&quot;</span>
        <span class="n">user_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_user_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New user {!r} created with ID {!r}, roles: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span>
            <span class="n">user_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rolelist_obj</span><span class="p">]</span>
        <span class="p">))</span>
        <span class="k">return</span> <span class="n">user_obj</span>
</div>
<div class="viewcode-block" id="Handler.create_whitelisted_url"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_whitelisted_url">[docs]</a>    <span class="k">def</span> <span class="nf">create_whitelisted_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">download_seconds</span><span class="o">=</span><span class="mi">86400</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[],</span>
                               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a whitelisted url object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        url : str</span>
<span class="sd">            * text of new url</span>
<span class="sd">        regex : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: `url` is not a regex pattern</span>
<span class="sd">            * True: `url` is a regex pattern</span>
<span class="sd">        download_seconds : int, optional</span>
<span class="sd">            * default: 86400</span>
<span class="sd">            * how often to re-download `url`</span>
<span class="sd">        properties: list of list of strs, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * each list must be a 2 item list:</span>
<span class="sd">            * list item 1 property name</span>
<span class="sd">            * list item 2 property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        url_obj : :class:`taniumpy.object_types.white_listed_url.WhiteListedUrl`</span>
<span class="sd">            * TaniumPy object added to Tanium SOAP Server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">regex</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;regex:&#39;</span> <span class="o">+</span> <span class="n">url</span>

        <span class="n">metadatalist_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_metadatalist_obj</span><span class="p">(</span>
            <span class="n">properties</span><span class="o">=</span><span class="n">properties</span><span class="p">,</span> <span class="n">nameprefix</span><span class="o">=</span><span class="s">&#39;TConsole.WhitelistedURL&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">add_url_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">WhiteListedUrl</span><span class="p">()</span>
        <span class="n">add_url_obj</span><span class="o">.</span><span class="n">url_regex</span> <span class="o">=</span> <span class="n">url</span>
        <span class="n">add_url_obj</span><span class="o">.</span><span class="n">download_seconds</span> <span class="o">=</span> <span class="n">download_seconds</span>
        <span class="n">add_url_obj</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadatalist_obj</span>

        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a WhitelistedURL object&quot;</span>
        <span class="n">url_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_url_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New Whitelisted URL {!r} created with ID {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">url_obj</span><span class="o">.</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">url_obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">url_obj</span>
</div>
<div class="viewcode-block" id="Handler.delete"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete an object type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype : string</span>
<span class="sd">            * type of object to delete</span>
<span class="sd">        id/name/hash : int or string, list of int or string</span>
<span class="sd">            * search attributes of object to delete, must supply at least one valid search attr</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict</span>
<span class="sd">            * dict containing deploy action object and results from deploy action</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.GET_OBJ_MAP` : maps objtype to supported &#39;search&#39; keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_map</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_obj_map</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="n">objtype</span><span class="p">)</span>

        <span class="n">delete_ok</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;delete&#39;</span><span class="p">]</span>

        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">delete_ok</span><span class="p">:</span>
            <span class="n">deletable</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GET_OBJ_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="s">&#39;delete&#39;</span><span class="p">]</span>
            <span class="p">])</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;{} is not a deletable object! Deletable objects: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">deletable</span><span class="p">))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find the object to be deleted&quot;</span>
        <span class="n">objs_to_del</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="n">objtype</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">deleted_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj_to_del</span> <span class="ow">in</span> <span class="n">objs_to_del</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find the object to be deleted&quot;</span>
            <span class="n">del_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj_to_del</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="n">deleted_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">del_obj</span><span class="p">)</span>

            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Deleted {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">del_obj</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">deleted_objects</span>
</div>
<div class="viewcode-block" id="Handler.export_obj"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.export_obj">[docs]</a>    <span class="k">def</span> <span class="nf">export_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="o">=</span><span class="s">&#39;csv&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports a python API object to a given export format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * TaniumPy object to export</span>
<span class="sd">        export_format : str, optional</span>
<span class="sd">            * default: &#39;csv&#39;</span>
<span class="sd">            * the format to export `obj` to, one of: {&#39;csv&#39;, &#39;xml&#39;, &#39;json&#39;}</span>
<span class="sd">        header_sort : list of str, bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * for `export_format` csv and `obj` types :class:`taniumpy.object_types.base.BaseType` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * True: sort the headers automatically</span>
<span class="sd">            * False: do not sort the headers at all</span>
<span class="sd">            * list of str: sort the headers returned by priority based on provided list</span>
<span class="sd">        header_add_sensor : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not prefix the headers with the associated sensor name for each column</span>
<span class="sd">            * True: prefix the headers with the associated sensor name for each column</span>
<span class="sd">        header_add_type : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not postfix the headers with the result type for each column</span>
<span class="sd">            * True: postfix the headers with the result type for each column</span>
<span class="sd">        expand_grouped_columns : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not expand multiline row entries into their own rows</span>
<span class="sd">            * True: expand multiline row entries into their own rows</span>
<span class="sd">        explode_json_string_values : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` json or csv and `obj` type :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * False: do not explode JSON strings in object attributes into their own object attributes</span>
<span class="sd">            * True: explode JSON strings in object attributes into their own object attributes</span>
<span class="sd">        minimal : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` xml and `obj` type :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * False: include empty attributes in XML output</span>
<span class="sd">            * True: do not include empty attributes in XML output</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : str</span>
<span class="sd">            * the contents of exporting `export_format`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        When performing a CSV export and importing that CSV into excel, keep in mind that Excel has a per cell character limit of 32,000. Any cell larger than that will be broken up into a whole new row, which can wreak havoc with data in Excel.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.EXPORT_MAPS` : maps the type `obj` to `export_format` and the optional args supported for each</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">objtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objclassname</span> <span class="o">=</span> <span class="n">objtype</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">objclassname</span> <span class="o">=</span> <span class="s">&#39;Unknown&#39;</span>

        <span class="c"># see if supplied obj is a supported object type</span>
        <span class="n">type_match</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">EXPORT_MAPS</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">type_match</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;{} not a supported object to export, must be one of: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>

            <span class="c"># build a list of supported object types</span>
            <span class="n">supp_types</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">EXPORT_MAPS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">supp_types</span><span class="p">))</span>

        <span class="c"># get the export formats for this obj type</span>
        <span class="n">export_formats</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">EXPORT_MAPS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">export_format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">export_formats</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;{!r} not a supported export format for {}, must be one of: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">export_format</span><span class="p">,</span> <span class="n">objclassname</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_formats</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c"># perform validation on optional kwargs, if they exist</span>
        <span class="n">opt_keys</span> <span class="o">=</span> <span class="n">export_formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">export_format</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">for</span> <span class="n">opt_key</span> <span class="ow">in</span> <span class="n">opt_keys</span><span class="p">:</span>
            <span class="n">check_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">opt_key</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">check_dictkey</span><span class="p">(</span><span class="o">**</span><span class="n">check_args</span><span class="p">)</span>

        <span class="c"># filter out the kwargs that are specific to this obj type and format type</span>
        <span class="n">format_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s">&#39;key&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">opt_keys</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c"># run the handler that is specific to this objtype, if it exists</span>
        <span class="n">class_method_str</span> <span class="o">=</span> <span class="s">&#39;_export_class_&#39;</span> <span class="o">+</span> <span class="n">type_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">class_handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_method_str</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">class_handler</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">class_handler</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="o">=</span><span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">format_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} not supported by Handler!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objclassname</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler.create_report_file"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_report_file">[docs]</a>    <span class="k">def</span> <span class="nf">create_report_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">report_file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports a python API object to a file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        contents : str</span>
<span class="sd">            * contents to write to `report_file`</span>
<span class="sd">        report_file : str, optional</span>
<span class="sd">            * filename to save report as</span>
<span class="sd">        report_dir : str, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * directory to save report in, will use current working directory if not supplied</span>
<span class="sd">        prefix : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * prefix to add to `report_file`</span>
<span class="sd">        postfix : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * postfix to add to `report_file`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        report_path : str</span>
<span class="sd">            * the full path to the file created with `contents`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">report_file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">report_file</span> <span class="o">=</span> <span class="s">&#39;pytan_report_{}.txt&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_now</span><span class="p">())</span>

        <span class="c"># try to get report_dir from the report_file</span>
        <span class="n">report_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">report_file</span><span class="p">)</span>

        <span class="c"># try to get report_dir from kwargs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">report_dir</span><span class="p">:</span>
            <span class="n">report_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;report_dir&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># just use current working dir</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">report_dir</span><span class="p">:</span>
            <span class="n">report_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="c"># make report_dir if it doesnt exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">report_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">report_dir</span><span class="p">)</span>

        <span class="c"># remove any path from report_file</span>
        <span class="n">report_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">report_file</span><span class="p">)</span>

        <span class="c"># if prefix/postfix, add to report_file</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prefix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">postfix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;postfix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">report_file</span><span class="p">,</span> <span class="n">report_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">report_file</span><span class="p">)</span>
        <span class="n">report_file</span> <span class="o">=</span> <span class="s">&#39;{}{}{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">report_file</span><span class="p">,</span> <span class="n">postfix</span><span class="p">,</span> <span class="n">report_ext</span><span class="p">)</span>

        <span class="c"># join the report_dir and report_file to come up with report_path</span>
        <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report_dir</span><span class="p">,</span> <span class="n">report_file</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Report file {!r} written with {} bytes&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">report_path</span>
</div>
<div class="viewcode-block" id="Handler.export_to_report_file"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.export_to_report_file">[docs]</a>    <span class="k">def</span> <span class="nf">export_to_report_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="o">=</span><span class="s">&#39;csv&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports a python API object to a file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * TaniumPy object to export</span>
<span class="sd">        export_format : str, optional</span>
<span class="sd">            * default: &#39;csv&#39;</span>
<span class="sd">            * the format to export `obj` to, one of: {&#39;csv&#39;, &#39;xml&#39;, &#39;json&#39;}</span>
<span class="sd">        header_sort : list of str, bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * for `export_format` csv and `obj` types :class:`taniumpy.object_types.base.BaseType` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * True: sort the headers automatically</span>
<span class="sd">            * False: do not sort the headers at all</span>
<span class="sd">            * list of str: sort the headers returned by priority based on provided list</span>
<span class="sd">        header_add_sensor : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not prefix the headers with the associated sensor name for each column</span>
<span class="sd">            * True: prefix the headers with the associated sensor name for each column</span>
<span class="sd">        header_add_type : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not postfix the headers with the result type for each column</span>
<span class="sd">            * True: postfix the headers with the result type for each column</span>
<span class="sd">        expand_grouped_columns : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not expand multiline row entries into their own rows</span>
<span class="sd">            * True: expand multiline row entries into their own rows</span>
<span class="sd">        explode_json_string_values : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` json or csv and `obj` type :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * False: do not explode JSON strings in object attributes into their own object attributes</span>
<span class="sd">            * True: explode JSON strings in object attributes into their own object attributes</span>
<span class="sd">        minimal : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * for `export_format` xml and `obj` type :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * False: include empty attributes in XML output</span>
<span class="sd">            * True: do not include empty attributes in XML output</span>
<span class="sd">        report_file: str, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * filename to save report as, will be automatically generated if not supplied</span>
<span class="sd">        report_dir: str, optional</span>
<span class="sd">            * default: None</span>
<span class="sd">            * directory to save report in, will use current working directory if not supplied</span>
<span class="sd">        prefix: str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * prefix to add to `report_file`</span>
<span class="sd">        postfix: str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * postfix to add to `report_file`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        report_path, result : tuple</span>
<span class="sd">            * report_path : str, the full path to the file created with contents of `result`</span>
<span class="sd">            * result : str, the contents written to report_path</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :func:`pytan.handler.Handler.export_obj` : method that performs the actual work to do the exporting</span>
<span class="sd">        :func:`pytan.handler.Handler.create_report_file` : method that performs the actual work to write the report file</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        When performing a CSV export and importing that CSV into excel, keep in mind that Excel has a per cell character limit of 32,000. Any cell larger than that will be broken up into a whole new row, which can wreak havoc with data in Excel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">report_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;report_file&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">report_file</span><span class="p">:</span>
            <span class="n">report_file</span> <span class="o">=</span> <span class="s">&quot;{}_{}.{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_now</span><span class="p">(),</span> <span class="n">export_format</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;No report file name supplied, generated name: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">report_file</span><span class="p">))</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;export_format&#39;</span><span class="p">,</span> <span class="s">&#39;contents&#39;</span><span class="p">,</span> <span class="s">&#39;report_file&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="c"># get the results of exporting the object</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_obj</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="o">=</span><span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="n">report_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_report_file</span><span class="p">(</span>
            <span class="n">report_file</span><span class="o">=</span><span class="n">report_file</span><span class="p">,</span> <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">report_path</span><span class="p">,</span> <span class="n">contents</span>
</div>
<div class="viewcode-block" id="Handler.get"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an object type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype : string</span>
<span class="sd">            * type of object to get</span>
<span class="sd">        id/name/hash : int or string, list of int or string</span>
<span class="sd">            * search attributes of object to get, must supply at least one valid search attr</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_list : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * The object list of items found for `objtype`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.GET_OBJ_MAP` : maps objtype to supported &#39;search&#39; keys</span>
<span class="sd">        :func:`pytan.handler.Handler._get_multi` : private method used to get multiple items</span>
<span class="sd">        :func:`pytan.handler.Handler._get_single` : private method used to get singular items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find an object&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;objtype&#39;</span><span class="p">,</span> <span class="s">&#39;obj_map&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">obj_map</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_obj_map</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="n">objtype</span><span class="p">)</span>

        <span class="n">manual_search</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;manual&#39;</span><span class="p">]</span>
        <span class="n">api_attrs</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>

        <span class="n">api_kwattrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">api_attrs</span><span class="p">]</span>

        <span class="c"># if the api doesn&#39;t support filtering for this object,</span>
        <span class="c"># or if the user didn&#39;t supply any api_kwattrs and manual_search</span>
        <span class="c"># is true, get all objects of this type and manually filter</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_attrs</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">api_kwattrs</span><span class="p">)</span> <span class="ow">and</span> <span class="n">manual_search</span><span class="p">):</span>
            <span class="n">all_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="n">return_objs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">all_objs</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)()</span>

            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">all_objs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">aobj</span> <span class="ow">in</span> <span class="n">all_objs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">aobj</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">return_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aobj</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">return_objs</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;No results found searching for {} with {}!!&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>

            <span class="k">return</span> <span class="n">return_objs</span>

        <span class="c"># if api supports filtering for this object,</span>
        <span class="c"># but no filters supplied in kwargs, raise</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">api_kwattrs</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;Getting a {} requires at least one filter: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">api_attrs</span><span class="p">))</span>

        <span class="c"># if there is a multi in obj_map, that means we can pass a list</span>
        <span class="c"># type to the taniumpy. the list will have an entry for each api_kw</span>
        <span class="k">if</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;multi&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_multi</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">obj_map</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="c"># if there is a single in obj_map but not multi, that means</span>
        <span class="c"># we have to find each object individually</span>
        <span class="k">elif</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_single</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">obj_map</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;No single or multi search defined for {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objtype</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Handler.get_all"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_all">[docs]</a>    <span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all objects of a type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype : string</span>
<span class="sd">            * type of object to get</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj_list : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * The object list of items found for `objtype`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.GET_OBJ_MAP` : maps objtype to supported &#39;search&#39; keys</span>
<span class="sd">        :func:`pytan.handler.Handler._find` : private method used to find items</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find an object&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;objtype&#39;</span><span class="p">,</span> <span class="s">&#39;obj_map&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">obj_map</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_obj_map</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="n">objtype</span><span class="p">)</span>

        <span class="n">all_type</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">]</span>
        <span class="n">api_obj_all</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_taniumpy_obj</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">all_type</span><span class="p">)()</span>

        <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">api_obj_all</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found</span>

    <span class="c"># BEGIN PRIVATE METHODS</span></div>
<div class="viewcode-block" id="Handler._add"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._add">[docs]</a>    <span class="k">def</span> <span class="nf">_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for interfacing with :func:`taniumpy.session.Session.add`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to add</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        added_obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">           * full object that was added</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="s">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="n">obj</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Adding object {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_str</span><span class="p">))</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;suppress_object_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;suppress_object_list&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;objtype&#39;</span><span class="p">,</span> <span class="s">&#39;obj_map&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add an object&quot;</span>
        <span class="n">clean_kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">added_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;Error while trying to add object {}!!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">search_str</span><span class="p">))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject on the recently added object in order to get the full object&quot;</span>
        <span class="n">clean_kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">added_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;Error while trying to find recently added object {}!!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">search_str</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Added object {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">added_obj</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">added_obj</span>
</div>
<div class="viewcode-block" id="Handler._find"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._find">[docs]</a>    <span class="k">def</span> <span class="nf">_find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for interfacing with :func:`taniumpy.session.Session.find`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to find</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        found : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">           * full object that was found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="s">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="n">obj</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Searching for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_str</span><span class="p">))</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;suppress_object_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;suppress_object_list&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;objtype&#39;</span><span class="p">,</span> <span class="s">&#39;obj_map&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to find an object&quot;</span>
        <span class="n">clean_kwargs</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;No results found searching for {} (error: {})!!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">search_str</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">empty_obj</span><span class="p">(</span><span class="n">found</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;No results found searching for {}!!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">search_str</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Found {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">found</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler._get_multi"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._get_multi">[docs]</a>    <span class="k">def</span> <span class="nf">_get_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find multiple item wrapper using :func:`_find`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj_map : dict</span>
<span class="sd">            * dict containing the map for a given object type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        found : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">           * full object that was found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_attrs</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
        <span class="n">api_kwattrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">api_attrs</span><span class="p">]</span>
        <span class="n">api_kw</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">api_attrs</span><span class="p">,</span> <span class="n">api_kwattrs</span><span class="p">)}</span>

        <span class="n">multi_type</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;multi&#39;</span><span class="p">]</span>
        <span class="n">single_type</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">]</span>

        <span class="c"># create a list object to append our searches to</span>
        <span class="n">api_obj_multi</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_taniumpy_obj</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">multi_type</span><span class="p">)()</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">api_kw</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c"># if we can&#39;t search for k, skip</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c"># if v empty, skip</span>

            <span class="k">if</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">api_obj_single</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_taniumpy_obj</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">single_type</span><span class="p">)()</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">api_obj_multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">api_obj_single</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_taniumpy_obj</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">single_type</span><span class="p">)()</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">api_obj_multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="c"># find the multi list object</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">api_obj_multi</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler._get_single"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._get_single">[docs]</a>    <span class="k">def</span> <span class="nf">_get_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find single item wrapper using :func:`_find`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj_map : dict</span>
<span class="sd">            * dict containing the map for a given object type</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        found : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">           * full object that was found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">api_attrs</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
        <span class="n">api_kwattrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">api_attrs</span><span class="p">]</span>
        <span class="n">api_kw</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">api_attrs</span><span class="p">,</span> <span class="n">api_kwattrs</span><span class="p">)}</span>

        <span class="c"># we create a list object to append our single item searches to</span>
        <span class="k">if</span> <span class="n">obj_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;allfix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="n">all_type</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;allfix&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_type</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">]</span>

        <span class="n">found</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_taniumpy_obj</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">all_type</span><span class="p">)()</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj_map&#39;</span><span class="p">,</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="s">&#39;v&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">api_kw</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c"># if we can&#39;t search for k, skip</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c"># if v empty, skip</span>

            <span class="k">if</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_find</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">obj_map</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">):</span>
                        <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_find</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">obj_map</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">):</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler._single_find"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._single_find">[docs]</a>    <span class="k">def</span> <span class="nf">_single_find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for single item searches interfacing with :func:`taniumpy.session.Session.find`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj_map : dict</span>
<span class="sd">            * dict containing the map for a given object type</span>
<span class="sd">        k : str</span>
<span class="sd">            * attribute name to set to `v`</span>
<span class="sd">        v : str</span>
<span class="sd">            * attribute value to set on `k`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        found : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">           * full object that was found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">single_type</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">]</span>
        <span class="n">api_obj_single</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_taniumpy_obj</span><span class="p">(</span><span class="n">obj_map</span><span class="o">=</span><span class="n">single_type</span><span class="p">)()</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">obj_ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">api_obj_single</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj_ret</span><span class="p">,</span> <span class="s">&#39;_list_properties&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj_ret</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_ret</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler._get_sensor_defs"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._get_sensor_defs">[docs]</a>    <span class="k">def</span> <span class="nf">_get_sensor_defs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uses :func:`get` to update a definition with a sensor object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        defs : list of dict</span>
<span class="sd">            * list of dicts containing sensor definitions</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        defs : list of dict</span>
<span class="sd">           * list of dicts containing sensor definitions with sensor object in &#39;sensor_obj&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s_obj_map</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GET_OBJ_MAP</span><span class="p">[</span><span class="s">&#39;sensor&#39;</span><span class="p">]</span>
        <span class="n">search_keys</span> <span class="o">=</span> <span class="n">s_obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;include_hidden_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;include_hidden_flag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;objtype&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">:</span>
            <span class="n">def_search</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">search_keys</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)}</span>
            <span class="n">def_search</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="c"># get the sensor object</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sensor_obj&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
                <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;Issue a GetObject to get the full object of a sensor for inclusion in a &quot;</span>
                    <span class="s">&quot;question or action&quot;</span>
                <span class="p">)</span>
                <span class="n">def_search</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">def_search</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;sensor_obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;sensor&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">def_search</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">defs</span>
</div>
<div class="viewcode-block" id="Handler._get_package_def"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._get_package_def">[docs]</a>    <span class="k">def</span> <span class="nf">_get_package_def</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uses :func:`get` to update a definition with a package object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        d : dict</span>
<span class="sd">            * dict containing package definition</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        d : dict</span>
<span class="sd">           * dict containing package definitions with package object in &#39;package_obj&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s_obj_map</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">GET_OBJ_MAP</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]</span>
        <span class="n">search_keys</span> <span class="o">=</span> <span class="n">s_obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;include_hidden_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;include_hidden_flag&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;objtype&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">def_search</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">search_keys</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)}</span>
        <span class="n">def_search</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="c"># get the package object</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;package_obj&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Issue a GetObject to get the full object of a package for inclusion in an &quot;</span>
                <span class="s">&quot;action&quot;</span>
            <span class="p">)</span>
            <span class="n">def_search</span><span class="p">[</span><span class="s">&#39;pytan_help&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">def_search</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pytan_help&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;package&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">def_search</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">d</span>
</div>
<div class="viewcode-block" id="Handler._export_class_BaseType"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_class_BaseType">[docs]</a>    <span class="k">def</span> <span class="nf">_export_class_BaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c"># noqa</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting :class:`taniumpy.object_types.base.BaseType`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * taniumpy object to export</span>
<span class="sd">        export_format : str</span>
<span class="sd">            * str of format to perform export in</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : str</span>
<span class="sd">           * results of exporting `obj` into format `export_format`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># run the handler that is specific to this export_format, if it exists</span>
        <span class="n">format_method_str</span> <span class="o">=</span> <span class="s">&#39;_export_format_&#39;</span> <span class="o">+</span> <span class="n">export_format</span>
        <span class="n">format_handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_method_str</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">format_handler</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">format_handler</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} not coded for in Handler!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">export_format</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._export_class_ResultSet"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_class_ResultSet">[docs]</a>    <span class="k">def</span> <span class="nf">_export_class_ResultSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c"># noqa</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting :class:`taniumpy.object_types.result_set.ResultSet`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * taniumpy object to export</span>
<span class="sd">        export_format : str</span>
<span class="sd">            * str of format to perform export in</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : str</span>
<span class="sd">           * results of exporting `obj` into format `export_format`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ensure kwargs[sensors] has all the sensors that correlate</span>
<span class="sd">        to the what_hash of each column, but only if header_add_sensor=True</span>
<span class="sd">        needed for: ResultSet.write_csv(header_add_sensor=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header_add_sensor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;header_add_sensor&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">sensors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sensors&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;sensors&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;objtype&#39;</span><span class="p">,</span> <span class="s">&#39;hash&#39;</span><span class="p">,</span> <span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">header_add_sensor</span> <span class="ow">and</span> <span class="n">export_format</span> <span class="o">==</span> <span class="s">&#39;csv&#39;</span><span class="p">:</span>
            <span class="n">clean_kwargs</span><span class="p">[</span><span class="s">&#39;sensors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensors</span>
            <span class="n">sensor_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">hash</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sensors</span><span class="p">]</span>
            <span class="n">column_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">what_hash</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="n">missing_hashes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">column_hashes</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sensor_hashes</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">missing_hashes</span><span class="p">:</span>
                <span class="n">missing_sensors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="o">=</span><span class="s">&#39;sensor&#39;</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="n">missing_hashes</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
                <span class="n">clean_kwargs</span><span class="p">[</span><span class="s">&#39;sensors&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">missing_sensors</span><span class="p">)</span>

        <span class="c"># run the handler that is specific to this export_format, if it exists</span>
        <span class="n">format_method_str</span> <span class="o">=</span> <span class="s">&#39;_export_format_&#39;</span> <span class="o">+</span> <span class="n">export_format</span>
        <span class="n">format_handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_method_str</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">format_handler</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">format_handler</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} not coded for in Handler!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">export_format</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._export_format_csv"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_format_csv">[docs]</a>    <span class="k">def</span> <span class="nf">_export_format_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting format: CSV</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.result_set.ResultSet` or :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * taniumpy object to export</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : str</span>
<span class="sd">           * results of exporting `obj` into csv format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;write_csv&#39;</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} has no write_csv() method!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;fd&#39;</span><span class="p">,</span> <span class="s">&#39;val&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;_list_properties&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">fd</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">fd</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._export_format_json"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_format_json">[docs]</a>    <span class="k">def</span> <span class="nf">_export_format_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting format: JSON</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.result_set.ResultSet` or :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * taniumpy object to export</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : str</span>
<span class="sd">           * results of exporting `obj` into json format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;to_json&#39;</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} has no to_json() method!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;jsonable&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">jsonable</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._export_format_xml"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_format_xml">[docs]</a>    <span class="k">def</span> <span class="nf">_export_format_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting format: XML</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.result_set.ResultSet` or :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * taniumpy object to export</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : str</span>
<span class="sd">           * results of exporting `obj` into XML format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;toSOAPBody&#39;</span><span class="p">):</span>
            <span class="n">raw_xml</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;_RAW_XML&#39;</span><span class="p">):</span>
            <span class="n">raw_xml</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_RAW_XML</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} has no toSOAPBody() method or _RAW_XML attribute!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">xml_pretty</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">raw_xml</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._deploy_action"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._deploy_action">[docs]</a>    <span class="k">def</span> <span class="nf">_deploy_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">get_results</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deploy an action and get the results back</span>

<span class="sd">        This method requires in-depth knowledge of how filters and options are created in the API, and as such is not meant for human consumption. Use :func:`deploy_action` instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        package_def : dict</span>
<span class="sd">            * definition that describes a package</span>
<span class="sd">        action_filter_defs : str, dict, list of str or dict, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * action filter definitions</span>
<span class="sd">        action_option_defs : dict, list of dict, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * action filter option definitions</span>
<span class="sd">        start_seconds_from_now : int, optional</span>
<span class="sd">            * default: 0</span>
<span class="sd">            * start action N seconds from now</span>
<span class="sd">        expire_seconds : int, optional</span>
<span class="sd">            * default: package.expire_seconds</span>
<span class="sd">            * expire action N seconds from now, will be derived from package if not supplied</span>
<span class="sd">        run : bool, optional</span>
<span class="sd">            * default: False</span>
<span class="sd">            * False: just ask the question that pertains to verify action, export the results to CSV, and raise pytan.exceptions.RunFalse -- does not deploy the action</span>
<span class="sd">            * True: actually deploy the action</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: wait for result completion after deploying action</span>
<span class="sd">            * False: just deploy the action and return the object in `ret`</span>
<span class="sd">        action_name : str, optional</span>
<span class="sd">            * default: prepend package name with &quot;API Deploy &quot;</span>
<span class="sd">            * custom name for action</span>
<span class="sd">        action_comment : str, optional</span>
<span class="sd">            * default:</span>
<span class="sd">            * custom comment for action</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing:</span>
<span class="sd">            * `saved_action_object` : :class:`taniumpy.object_types.saved_action.SavedAction`, the saved_action added for this action (None if 6.2)</span>
<span class="sd">            * `action_object` : :class:`taniumpy.object_types.action.Action`, the action object that tanium created for `saved_action`</span>
<span class="sd">            * `package_object` : :class:`taniumpy.object_types.package_spec.PackageSPec`, the package object used in `saved_action`</span>
<span class="sd">            * `action_info` : :class:`taniumpy.object_types.result_info.ResultInfo`, the initial GetResultInfo call done before getting results</span>
<span class="sd">            * `poller_object` : :class:`pytan.pollers.ActionPoller`, poller object used to wait until all results are in before getting `action_results`</span>
<span class="sd">            * `poller_success` : None if `get_results` == False, elsewise True or False</span>
<span class="sd">            * `action_results` : None if `get_results` == False, elsewise :class:`taniumpy.object_types.result_set.ResultSet`, the results for `action_object`</span>
<span class="sd">            * `action_result_map` : None if `get_results` == False, elsewise progress map for `action_object` in dictionary form</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # example of dict for `package_def`</span>
<span class="sd">        &gt;&gt;&gt; package_def = {&#39;name&#39;: &#39;PackageName1&#39;, &#39;params&#39;:{&#39;param1&#39;: &#39;value1&#39;}}</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `action_filter_defs`</span>
<span class="sd">        &gt;&gt;&gt; action_filter_defs = &#39;Sensor1&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of dict for `action_filter_defs`</span>
<span class="sd">        &gt;&gt;&gt; action_filter_defs = {</span>
<span class="sd">        ... &#39;name&#39;: &#39;Sensor1&#39;,</span>
<span class="sd">        ...     &#39;filter&#39;: {</span>
<span class="sd">        ...         &#39;operator&#39;: &#39;RegexMatch&#39;,</span>
<span class="sd">        ...         &#39;not_flag&#39;: 0,</span>
<span class="sd">        ...         &#39;value&#39;: &#39;.*&#39;</span>
<span class="sd">        ...     },</span>
<span class="sd">        ...     &#39;options&#39;: {&#39;and_flag&#39;: 1}</span>
<span class="sd">        ... }</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filter dictionaries for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid option dictionaries for options</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">            * For 6.2:</span>
<span class="sd">                * We need to add an Action object</span>
<span class="sd">                * The Action object should not be in an ActionList</span>
<span class="sd">                * Action.start_time must be specified, if it is not specified the action shows up as expired immediately. We default to 1 second from current time if start_seconds_from_now is not passed in</span>

<span class="sd">            * For 6.5 / 6.6:</span>
<span class="sd">                * We need to add a SavedAction object, the server creates the Action object for us</span>
<span class="sd">                * To emulate what the console does, the SavedAction should be in a SavedActionList</span>
<span class="sd">                * Action.start_time does not need to be specified</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">check_for_help</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;defs&#39;</span><span class="p">,</span>
            <span class="s">&#39;d&#39;</span><span class="p">,</span>
            <span class="s">&#39;obj&#39;</span><span class="p">,</span>
            <span class="s">&#39;objtype&#39;</span><span class="p">,</span>
            <span class="s">&#39;key&#39;</span><span class="p">,</span>
            <span class="s">&#39;default&#39;</span><span class="p">,</span>
            <span class="s">&#39;defname&#39;</span><span class="p">,</span>
            <span class="s">&#39;deftypes&#39;</span><span class="p">,</span>
            <span class="s">&#39;empty_ok&#39;</span><span class="p">,</span>
            <span class="s">&#39;id&#39;</span><span class="p">,</span>
            <span class="s">&#39;pytan_help&#39;</span><span class="p">,</span>
            <span class="s">&#39;handler&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_is_6_2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">objtype</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">Action</span>
            <span class="n">objlisttype</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">force_start_time</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">objtype</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">SavedAction</span>
            <span class="n">objlisttype</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">SavedActionList</span>
            <span class="n">force_start_time</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">package_def</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;package_def&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>
        <span class="n">action_filter_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;action_filter_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;list()&#39;</span><span class="p">,</span> <span class="s">&#39;str()&#39;</span><span class="p">,</span> <span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">strconv</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">,</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>
        <span class="n">action_option_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;action_option_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">val_package_def</span><span class="p">(</span><span class="n">package_def</span><span class="o">=</span><span class="n">package_def</span><span class="p">)</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">val_sensor_defs</span><span class="p">(</span><span class="n">sensor_defs</span><span class="o">=</span><span class="n">action_filter_defs</span><span class="p">)</span>

        <span class="n">package_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_package_def</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="n">package_def</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Issue a GetObject to get the full object of a sensor for inclusion in a &quot;</span>
            <span class="s">&quot;Group for an Action&quot;</span>
        <span class="p">)</span>
        <span class="n">action_filter_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span>
            <span class="n">defs</span><span class="o">=</span><span class="n">action_filter_defs</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="n">start_seconds_from_now</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_kwargs_int</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s">&#39;start_seconds_from_now&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="n">expire_seconds</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_kwargs_int</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s">&#39;expire_seconds&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">action_name_default</span> <span class="o">=</span> <span class="s">&quot;API Deploy {0.name}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">])</span>
        <span class="n">action_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action_name&#39;</span><span class="p">,</span> <span class="n">action_name_default</span><span class="p">)</span>

        <span class="n">action_comment_default</span> <span class="o">=</span> <span class="s">&#39;Created by PyTan v{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pytan</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
        <span class="n">action_comment</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action_comment&#39;</span><span class="p">,</span> <span class="n">action_comment_default</span><span class="p">)</span>

        <span class="n">issue_seconds_default</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">issue_seconds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;issue_seconds&#39;</span><span class="p">,</span> <span class="n">issue_seconds_default</span><span class="p">)</span>

        <span class="n">distribute_seconds_default</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">distribute_seconds</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;distribute_seconds&#39;</span><span class="p">,</span> <span class="n">distribute_seconds_default</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ask the question that pertains to the action filter, save the result as CSV,</span>
<span class="sd">        and raise a RunFalse exception</span>

<span class="sd">        this will be used to get a count for how many servers should be seen</span>
<span class="sd">        in the deploy action resultdata as &#39;completed&#39;</span>

<span class="sd">        We supply Computer Name and Online = True as the sensors if run is</span>
<span class="sd">        False, then exit out after asking the question to allow the user</span>
<span class="sd">        to verify the results by looking at the CSV file</span>

<span class="sd">        The action filter for the deploy action is used as the question</span>
<span class="sd">        filter</span>

<span class="sd">        note from jwk: passed_count == the number of machines that pass the filter and</span>
<span class="sd">        therefore the number that should take the action</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">pre_action_sensors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Computer Name&#39;</span><span class="p">,</span> <span class="s">&#39;Online, that =:True&#39;</span><span class="p">]</span>
            <span class="n">pre_action_sensor_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_sensors</span><span class="p">(</span><span class="n">sensors</span><span class="o">=</span><span class="n">pre_action_sensors</span><span class="p">)</span>

            <span class="n">q_clean_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">&#39;sensor_defs&#39;</span><span class="p">,</span>
                <span class="s">&#39;question_filter_defs&#39;</span><span class="p">,</span>
                <span class="s">&#39;question_option_defs&#39;</span><span class="p">,</span>
                <span class="s">&#39;hide_no_results_flag&#39;</span><span class="p">,</span>
                <span class="s">&#39;pytan_help&#39;</span><span class="p">,</span>
                <span class="s">&#39;get_results&#39;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">q_clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">q_clean_keys</span><span class="p">)</span>

            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Ask a question to determine the number of systems this action would affect if it &quot;</span>
                <span class="s">&quot;was actually run&quot;</span>
            <span class="p">)</span>
            <span class="n">q_clean_kwargs</span><span class="p">[</span><span class="s">&#39;sensor_defs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre_action_sensor_defs</span>
            <span class="n">q_clean_kwargs</span><span class="p">[</span><span class="s">&#39;question_filter_defs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_filter_defs</span>
            <span class="n">q_clean_kwargs</span><span class="p">[</span><span class="s">&#39;question_option_defs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_option_defs</span>
            <span class="n">q_clean_kwargs</span><span class="p">[</span><span class="s">&#39;hide_no_results_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">pre_action_question</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ask_manual</span><span class="p">(</span><span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">q_clean_kwargs</span><span class="p">)</span>

            <span class="n">passed_count</span> <span class="o">=</span> <span class="n">pre_action_question</span><span class="p">[</span><span class="s">&#39;question_results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">passed</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Number of systems that match action filter (passed_count): {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">passed_count</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">passed_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Number of systems that match the action filters provided is zero!&quot;</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="n">default_format</span> <span class="o">=</span> <span class="s">&#39;csv&#39;</span>
            <span class="n">export_format</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;export_format&#39;</span><span class="p">,</span> <span class="n">default_format</span><span class="p">)</span>

            <span class="n">default_prefix</span> <span class="o">=</span> <span class="s">&#39;VERIFY_BEFORE_DEPLOY_ACTION_&#39;</span>
            <span class="n">export_prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prefix&#39;</span><span class="p">,</span> <span class="n">default_prefix</span><span class="p">)</span>

            <span class="n">e_clean_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s">&#39;obj&#39;</span><span class="p">,</span>
                <span class="s">&#39;export_format&#39;</span><span class="p">,</span>
                <span class="s">&#39;prefix&#39;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">e_clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">e_clean_keys</span><span class="p">)</span>
            <span class="n">e_clean_kwargs</span><span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre_action_question</span><span class="p">[</span><span class="s">&#39;question_results&#39;</span><span class="p">]</span>
            <span class="n">e_clean_kwargs</span><span class="p">[</span><span class="s">&#39;export_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_format</span>
            <span class="n">e_clean_kwargs</span><span class="p">[</span><span class="s">&#39;prefix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">export_prefix</span>
            <span class="n">report_path</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_to_report_file</span><span class="p">(</span><span class="o">**</span><span class="n">e_clean_kwargs</span><span class="p">)</span>

            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;&#39;Run&#39; is not True!!</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;View and verify the contents of {} (length: {} bytes)</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;Re-run this deploy action with run=True after verifying&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RunFalse</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="c"># BUILD THE PACKAGE OBJECT TO BE ADDED TO THE ACTION</span>
        <span class="n">add_package_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">copy_package_obj_for_action</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">])</span>

        <span class="c"># if source_id is specified, a new package will be created with the parameters</span>
        <span class="c"># for this action embedded into it - specifying hidden = 1 will ensure the new package</span>
        <span class="c"># is hidden</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">hidden_flag</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">param_objlist</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_param_objlist</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">=</span><span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">],</span>
            <span class="n">user_params</span><span class="o">=</span><span class="n">package_def</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">],</span>
            <span class="n">delim</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">derive_def</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">param_objlist</span><span class="p">:</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">source_id</span> <span class="o">=</span> <span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">param_objlist</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">source_id</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;DEPLOY_ACTION objtype: {}, objlisttype: {}, force_start_time: {}, version: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">objlisttype</span><span class="p">,</span> <span class="n">force_start_time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">))</span>

        <span class="c"># BUILD THE ACTION OBJECT TO BE ADDED</span>
        <span class="n">add_obj</span> <span class="o">=</span> <span class="n">objtype</span><span class="p">()</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">package_spec</span> <span class="o">=</span> <span class="n">add_package_obj</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">action_name</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">issue_seconds</span> <span class="o">=</span> <span class="n">issue_seconds</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">distribute_seconds</span> <span class="o">=</span> <span class="n">distribute_seconds</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">action_comment</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">public_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">policy_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">approved_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">add_obj</span><span class="o">.</span><span class="n">issue_count</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">action_filter_defs</span> <span class="ow">or</span> <span class="n">action_option_defs</span><span class="p">:</span>
            <span class="n">targetgroup_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_group_obj</span><span class="p">(</span>
                <span class="n">q_filter_defs</span><span class="o">=</span><span class="n">action_filter_defs</span><span class="p">,</span> <span class="n">q_option_defs</span><span class="o">=</span><span class="n">action_option_defs</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">add_obj</span><span class="o">.</span><span class="n">target_group</span> <span class="o">=</span> <span class="n">targetgroup_obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">targetgroup_obj</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">start_seconds_from_now</span><span class="p">:</span>
            <span class="n">add_obj</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">seconds_from_now</span><span class="p">(</span><span class="n">secs</span><span class="o">=</span><span class="n">start_seconds_from_now</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">force_start_time</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">add_obj</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">start_seconds_from_now</span><span class="p">:</span>
                <span class="n">start_seconds_from_now</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">add_obj</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">seconds_from_now</span><span class="p">(</span><span class="n">secs</span><span class="o">=</span><span class="n">start_seconds_from_now</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expire_seconds</span><span class="p">:</span>
            <span class="n">add_obj</span><span class="o">.</span><span class="n">expire_seconds</span> <span class="o">=</span> <span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">expire_seconds</span>

        <span class="k">if</span> <span class="n">expire_seconds</span><span class="p">:</span>
            <span class="n">add_obj</span><span class="o">.</span><span class="n">expire_seconds</span> <span class="o">=</span> <span class="n">expire_seconds</span>

        <span class="k">if</span> <span class="n">objlisttype</span><span class="p">:</span>
            <span class="n">add_objs</span> <span class="o">=</span> <span class="n">objlisttype</span><span class="p">()</span>
            <span class="n">add_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add_obj</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a list of SavedActions (6.5 logic)&quot;</span>
            <span class="n">added_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_objs</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
            <span class="n">added_obj</span> <span class="o">=</span> <span class="n">added_objs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;DEPLOY_ACTION ADDED: {}, ID: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">added_obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">added_obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

            <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to get the last action created for a SavedAction&quot;</span>
            <span class="n">action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="o">.</span><span class="n">last_action</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">added_obj</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a single Action (6.2 logic)&quot;</span>
            <span class="n">action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue a GetObject to get the package for an Action&quot;</span>
        <span class="n">action_package</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="o">.</span><span class="n">package_spec</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;DEPLOY_ACTION ADDED: {}, ID: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_package</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">action_package</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;DEPLOY_ACTION ADDED: {}, ID: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">action_obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Issue a GetResultInfo on an Action to have the Server create a question that &quot;</span>
            <span class="s">&quot;tracks the results for a Deployed Action&quot;</span>
        <span class="p">)</span>
        <span class="n">action_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_info</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">action_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;DEPLOY_ACTION ADDED: Question for Action Results, ID: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_info</span><span class="o">.</span><span class="n">question_id</span><span class="p">))</span>

        <span class="n">poller</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">pollers</span><span class="o">.</span><span class="n">ActionPoller</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">action_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;saved_action_object&#39;</span><span class="p">:</span> <span class="n">added_obj</span><span class="p">,</span>
            <span class="s">&#39;action_object&#39;</span><span class="p">:</span> <span class="n">action_obj</span><span class="p">,</span>
            <span class="s">&#39;package_object&#39;</span><span class="p">:</span> <span class="n">action_package</span><span class="p">,</span>
            <span class="s">&#39;group_object&#39;</span><span class="p">:</span> <span class="n">targetgroup_obj</span><span class="p">,</span>
            <span class="s">&#39;action_info&#39;</span><span class="p">:</span> <span class="n">action_info</span><span class="p">,</span>
            <span class="s">&#39;poller_object&#39;</span><span class="p">:</span> <span class="n">poller</span><span class="p">,</span>
            <span class="s">&#39;action_results&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;action_result_map&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;poller_success&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">get_results</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;poller_success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s">&#39;poller_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;action_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s">&#39;poller_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">result_data</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;action_result_map&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s">&#39;poller_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">result_map</span>

        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler._ask_manual"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._ask_manual">[docs]</a>    <span class="k">def</span> <span class="nf">_ask_manual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_results</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a manual question using definitions and get the results back</span>

<span class="sd">        This method requires in-depth knowledge of how filters and options are created in the API,</span>
<span class="sd">        and as such is not meant for human consumption. Use :func:`ask_manual` instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sensor_defs : str, dict, list of str or dict</span>
<span class="sd">            * default: []</span>
<span class="sd">            * sensor definitions</span>
<span class="sd">        question_filter_defs : dict, list of dict, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * question filter definitions</span>
<span class="sd">        question_option_defs : dict, list of dict, optional</span>
<span class="sd">            * default: []</span>
<span class="sd">            * question option definitions</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: wait for result completion after asking question</span>
<span class="sd">            * False: just ask the question and return it in `ret`</span>
<span class="sd">        sse : bool, optional</span>
<span class="sd">            * default: True</span>
<span class="sd">            * True: perform a server side export when getting result data</span>
<span class="sd">            * False: perform a normal get result data (default for 6.2)</span>
<span class="sd">        sse_format : str, optional</span>
<span class="sd">            * default: &#39;xml_obj&#39;</span>
<span class="sd">            * format to have server side export report in, one of: {&#39;csv&#39;, &#39;xml&#39;, &#39;xml_obj&#39;, &#39;cef&#39;, 0, 1, 2}</span>
<span class="sd">        leading : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * used for sse_format &#39;cef&#39; only, the string to prepend to each row</span>
<span class="sd">        trailing : str, optional</span>
<span class="sd">            * default: &#39;&#39;</span>
<span class="sd">            * used for sse_format &#39;cef&#39; only, the string to append to each row</span>
<span class="sd">        polling_secs : int, optional</span>
<span class="sd">            * default: 5</span>
<span class="sd">            * Number of seconds to wait in between GetResultInfo loops</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        complete_pct : int/float, optional</span>
<span class="sd">            * default: 99</span>
<span class="sd">            * Percentage of mr_tested out of estimated_total to consider the question &quot;done&quot;</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        override_timeout_secs : int, optional</span>
<span class="sd">            * default: 0</span>
<span class="sd">            * If supplied and not 0, timeout in seconds instead of when object expires</span>
<span class="sd">            * This is passed through to :class:`pytan.pollers.QuestionPoller`</span>
<span class="sd">        callbacks : dict, optional</span>
<span class="sd">            * default: {}</span>
<span class="sd">            * can be a dict of functions to be run with the key names being the various state changes: &#39;ProgressChanged&#39;, &#39;AnswersChanged&#39;, &#39;AnswersComplete&#39;</span>
<span class="sd">            * This is passed through to :func:`pytan.pollers.QuestionPoller.run`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing:</span>
<span class="sd">            * `question_object` : :class:`taniumpy.object_types.question.Question`, the actual question created and added by PyTan</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`, the Result Set for `question_object` if `get_results` == True</span>
<span class="sd">            * `poller_object` : :class:`pytan.pollers.QuestionPoller`, poller object used to wait until all results are in before getting `question_results`</span>
<span class="sd">            * `poller_success` : None if `get_results` == True, elsewise True or False</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # example of str for sensor_defs</span>
<span class="sd">        &gt;&gt;&gt; sensor_defs = &#39;Sensor1&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of dict for sensor_defs</span>
<span class="sd">        &gt;&gt;&gt; sensor_defs = {</span>
<span class="sd">        ... &#39;name&#39;: &#39;Sensor1&#39;,</span>
<span class="sd">        ...     &#39;filter&#39;: {</span>
<span class="sd">        ...         &#39;operator&#39;: &#39;RegexMatch&#39;,</span>
<span class="sd">        ...         &#39;not_flag&#39;: 0,</span>
<span class="sd">        ...         &#39;value&#39;: &#39;.*&#39;</span>
<span class="sd">        ...     },</span>
<span class="sd">        ...     &#39;params&#39;: {&#39;key&#39;: &#39;value&#39;},</span>
<span class="sd">        ...     &#39;options&#39;: {&#39;and_flag&#39;: 1}</span>
<span class="sd">        ... }</span>

<span class="sd">        &gt;&gt;&gt; # example of dict for question_filter_defs</span>
<span class="sd">        &gt;&gt;&gt; question_filter_defs = {</span>
<span class="sd">        ...     &#39;operator&#39;: &#39;RegexMatch&#39;,</span>
<span class="sd">        ...     &#39;not_flag&#39;: 0,</span>
<span class="sd">        ...     &#39;value&#39;: &#39;.*&#39;</span>
<span class="sd">        ... }</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filter dictionaries for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid option dictionaries for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">check_for_help</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s">&#39;defs&#39;</span><span class="p">,</span>
            <span class="s">&#39;d&#39;</span><span class="p">,</span>
            <span class="s">&#39;obj&#39;</span><span class="p">,</span>
            <span class="s">&#39;objtype&#39;</span><span class="p">,</span>
            <span class="s">&#39;key&#39;</span><span class="p">,</span>
            <span class="s">&#39;default&#39;</span><span class="p">,</span>
            <span class="s">&#39;defname&#39;</span><span class="p">,</span>
            <span class="s">&#39;deftypes&#39;</span><span class="p">,</span>
            <span class="s">&#39;empty_ok&#39;</span><span class="p">,</span>
            <span class="s">&#39;id&#39;</span><span class="p">,</span>
            <span class="s">&#39;pytan_help&#39;</span><span class="p">,</span>
            <span class="s">&#39;handler&#39;</span><span class="p">,</span>
            <span class="s">&#39;sse&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="c"># get our defs from kwargs and churn them into what we want</span>
        <span class="n">sensor_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;sensor_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;list()&#39;</span><span class="p">,</span> <span class="s">&#39;str()&#39;</span><span class="p">,</span> <span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">strconv</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">,</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="n">q_filter_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;question_filter_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;list()&#39;</span><span class="p">,</span> <span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="n">q_option_defs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;question_option_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="n">sse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sse&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">clean_kwargs</span><span class="p">[</span><span class="s">&#39;sse_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sse_format&#39;</span><span class="p">,</span> <span class="s">&#39;xml_obj&#39;</span><span class="p">)</span>

        <span class="n">max_age_seconds</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_kwargs_int</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="s">&#39;max_age_seconds&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="c"># do basic validation of our defs</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">val_sensor_defs</span><span class="p">(</span><span class="n">sensor_defs</span><span class="o">=</span><span class="n">sensor_defs</span><span class="p">)</span>
        <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">val_q_filter_defs</span><span class="p">(</span><span class="n">q_filter_defs</span><span class="o">=</span><span class="n">q_filter_defs</span><span class="p">)</span>

        <span class="c"># get the sensor objects that are in our defs and add them as d[&#39;sensor_obj&#39;]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Issue a GetObject to get the full object of a sensor for inclusion in a &quot;</span>
            <span class="s">&quot;Select for a Question&quot;</span>
        <span class="p">)</span>
        <span class="n">sensor_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">defs</span><span class="o">=</span><span class="n">sensor_defs</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Issue a GetObject to get the full object of a sensor for inclusion in a &quot;</span>
            <span class="s">&quot;Group for a Question&quot;</span>
        <span class="p">)</span>
        <span class="n">q_filter_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">defs</span><span class="o">=</span><span class="n">q_filter_defs</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="c"># build a SelectList object from our sensor_defs</span>
        <span class="n">selectlist_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_selectlist_obj</span><span class="p">(</span><span class="n">sensor_defs</span><span class="o">=</span><span class="n">sensor_defs</span><span class="p">)</span>

        <span class="c"># build a Group object from our question filters/options</span>
        <span class="n">group_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_group_obj</span><span class="p">(</span>
            <span class="n">q_filter_defs</span><span class="o">=</span><span class="n">q_filter_defs</span><span class="p">,</span> <span class="n">q_option_defs</span><span class="o">=</span><span class="n">q_option_defs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c"># build a Question object from selectlist_obj and group_obj</span>
        <span class="n">add_obj</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">build_manual_q</span><span class="p">(</span><span class="n">selectlist_obj</span><span class="o">=</span><span class="n">selectlist_obj</span><span class="p">,</span> <span class="n">group_obj</span><span class="o">=</span><span class="n">group_obj</span><span class="p">)</span>

        <span class="n">add_obj</span><span class="o">.</span><span class="n">max_age_seconds</span> <span class="o">=</span> <span class="n">max_age_seconds</span>

        <span class="c"># add our Question and get a Question ID back</span>
        <span class="n">h</span> <span class="o">=</span> <span class="s">&quot;Issue an AddObject to add a Question object&quot;</span>
        <span class="n">added_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">add_obj</span><span class="p">,</span> <span class="n">pytan_help</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Question Added, ID: {}, query text: {!r}, expires: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">added_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">added_obj</span><span class="o">.</span><span class="n">query_text</span><span class="p">,</span> <span class="n">added_obj</span><span class="o">.</span><span class="n">expiration</span><span class="p">))</span>

        <span class="n">poller</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">pollers</span><span class="o">.</span><span class="n">QuestionPoller</span><span class="p">(</span><span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;question_object&#39;</span><span class="p">:</span> <span class="n">added_obj</span><span class="p">,</span>
            <span class="s">&#39;poller_object&#39;</span><span class="p">:</span> <span class="n">poller</span><span class="p">,</span>
            <span class="s">&#39;question_results&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;poller_success&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">get_results</span><span class="p">:</span>
            <span class="c"># poll the Question ID returned above to wait for results</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;poller_success&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="s">&#39;poller_object&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="c"># get the results</span>
            <span class="k">if</span> <span class="n">sse</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_is_6_2</span><span class="p">():</span>
                <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data_sse</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">added_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">object_types</span><span class="o">.</span><span class="n">result_set</span><span class="o">.</span><span class="n">ResultSet</span><span class="p">):</span>
                <span class="c"># add the sensors from this question to the ResultSet object for reporting</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;sensor_obj&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sensor_defs</span><span class="p">]</span>

            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;question_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler._parse_versioning"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._parse_versioning">[docs]</a>    <span class="k">def</span> <span class="nf">_parse_versioning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parses self.server_version into a dictionary</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict, containing major, minor, revision, and build of tanium server version</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If pytan has not yet fetched info.json, then server_version will == &quot;Not yet determined&quot;</span>
<span class="sd">        force a call to self.session.get_server_version() to attempt to get info.json and parse</span>
<span class="sd">        the version from that and update self.server_version with that value</span>

<span class="sd">        If pytan is unable to fetch info.json properly for some reason,</span>
<span class="sd">        then server_version will == &quot;Unable to determine&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">server_version_bad_states</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Not yet determined&quot;</span><span class="p">,</span> <span class="s">&quot;Unable to determine&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="ow">in</span> <span class="n">server_version_bad_states</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_server_version</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">v_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;major&#39;</span><span class="p">,</span> <span class="s">&#39;minor&#39;</span><span class="p">,</span> <span class="s">&#39;revision&#39;</span><span class="p">,</span> <span class="s">&#39;build&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span> <span class="ow">in</span> <span class="n">server_version_bad_states</span><span class="p">:</span>
            <span class="n">v_ints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">v_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v_keys</span><span class="p">,</span> <span class="n">v_ints</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v_parts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">v_ints</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v_parts</span><span class="p">]</span>
                <span class="n">v_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">v_keys</span><span class="p">,</span> <span class="n">v_ints</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;Unable to parse major, minor, revision, and build from server &quot;</span>
                    <span class="s">&quot;version string: {}&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">VersionParseError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">v_dict</span>
</div>
<div class="viewcode-block" id="Handler._platform_is_6_2"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._platform_is_6_2">[docs]</a>    <span class="k">def</span> <span class="nf">_platform_is_6_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check to see if self.server_version_dict matches 6.2.xxx.xxx</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            * True if self.server_version_dict major == 6 and minor == 2</span>
<span class="sd">            * False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;server_version_dict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_server_version</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">is6_2</span> <span class="o">=</span> <span class="p">(</span>
            <span class="c"># see if version is 6.2.xxx.xxx</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version_dict</span><span class="p">[</span><span class="s">&#39;major&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_dict</span><span class="p">[</span><span class="s">&#39;minor&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c"># we will assume 6.2 if server_version is &quot;Unable to determine&quot;</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">is6_2</span>
</div>
<div class="viewcode-block" id="Handler._version_support_check"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._version_support_check">[docs]</a>    <span class="k">def</span> <span class="nf">_version_support_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v_maps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks that each of the version maps in v_maps is greater than or equal to</span>
<span class="sd">        the current servers version</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        v_maps : list of dict</span>
<span class="sd">            * each dict can have major, minor, build, revision as keys, the corresponding values will be checked against self.server_version_dict to see if they are greater or equal to those values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            * True if all values in all v_maps are greater than or equal to all values in self.server_version_dict</span>
<span class="sd">            * False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;server_version_dict&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_server_version</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">v_map</span> <span class="ow">in</span> <span class="n">v_maps</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v_map</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Handler._check_sse_format_support"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._check_sse_format_support">[docs]</a>    <span class="k">def</span> <span class="nf">_check_sse_format_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sse_format</span><span class="p">,</span> <span class="n">sse_format_int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determines if the export format integer is supported in the server version</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sse_format : str or int</span>
<span class="sd">            * user supplied export format</span>
<span class="sd">        sse_format_int : int</span>
<span class="sd">            * `sse_format` parsed into an int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sse_format_int</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">SSE_RESTRICT_MAP</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">restrict_maps</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">SSE_RESTRICT_MAP</span><span class="p">[</span><span class="n">sse_format_int</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_support_check</span><span class="p">(</span><span class="n">v_maps</span><span class="o">=</span><span class="n">restrict_maps</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">restrict_maps_txt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">restrict_maps</span><span class="p">])</span>

            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Server version {} does not support export format {!r}, &quot;</span>
                <span class="s">&quot;server version must be equal to or greater than one of:</span><span class="se">\n</span><span class="s">{}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>

            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">,</span> <span class="n">sse_format</span><span class="p">,</span> <span class="n">restrict_maps_txt</span><span class="p">)</span>

            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">UnsupportedVersionError</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Handler._resolve_sse_format"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._resolve_sse_format">[docs]</a>    <span class="k">def</span> <span class="nf">_resolve_sse_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sse_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resolves the server side export format the user supplied to an integer for the API</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sse_format : str or int</span>
<span class="sd">            * user supplied export format</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sse_format_int : int</span>
<span class="sd">            * `sse_format` parsed into an int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sse_format_int</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">SSE_FORMAT_MAP</span> <span class="k">if</span> <span class="n">sse_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sse_format_int</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Unsupport export format {!r}, must be one of:</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">ef_map_txt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;{!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">])</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">SSE_FORMAT_MAP</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">sse_format</span><span class="p">,</span> <span class="n">ef_map_txt</span><span class="p">))</span>

        <span class="n">sse_format_int</span> <span class="o">=</span> <span class="n">sse_format_int</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;&#39;sse_format resolved from &#39;{}&#39; to &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">sse_format</span><span class="p">,</span> <span class="n">sse_format_int</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sse_format_support</span><span class="p">(</span>
            <span class="n">sse_format</span><span class="o">=</span><span class="n">sse_format</span><span class="p">,</span> <span class="n">sse_format_int</span><span class="o">=</span><span class="n">sse_format_int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">sse_format_int</span>
</div>
<div class="viewcode-block" id="Handler._check_sse_version"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._check_sse_version">[docs]</a>    <span class="k">def</span> <span class="nf">_check_sse_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validates that the server version supports server side export&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_platform_is_6_2</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Server side export not supported in version: {} / {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_dict</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">UnsupportedVersionError</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Handler._check_sse_crash_prevention"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._check_sse_crash_prevention">[docs]</a>    <span class="k">def</span> <span class="nf">_check_sse_crash_prevention</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs a number of methods used to prevent crashing the platform server when performing server side exports</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to pass to self._check_sse_empty_rs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;v_maps&#39;</span><span class="p">,</span> <span class="s">&#39;ok_version&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="n">ok_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_version_support_check</span><span class="p">(</span>
            <span class="n">v_maps</span><span class="o">=</span><span class="n">pytan</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">SSE_CRASH_MAP</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sse_timing</span><span class="p">(</span><span class="n">ok_version</span><span class="o">=</span><span class="n">ok_version</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_sse_empty_rs</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">ok_version</span><span class="o">=</span><span class="n">ok_version</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Handler._check_sse_timing"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._check_sse_timing">[docs]</a>    <span class="k">def</span> <span class="nf">_check_sse_timing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ok_version</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks that the last server side export was at least 1 second ago if server version is less than any versions in pytan.constants.SSE_CRASH_MAP</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ok_version : bool</span>
<span class="sd">            * if the version currently running is an &quot;ok&quot; version</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last_get_rd_sse</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;last_get_rd_sse&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">last_get_rd_sse</span><span class="p">:</span>
            <span class="n">last_elapsed</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_get_rd_sse</span>
            <span class="k">if</span> <span class="n">last_elapsed</span><span class="o">.</span><span class="n">seconds</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ok_version</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;You must wait at least one second between server side export requests!&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ServerSideExportError</span><span class="p">(</span><span class="n">m</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_get_rd_sse</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Handler._check_sse_empty_rs"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._check_sse_empty_rs">[docs]</a>    <span class="k">def</span> <span class="nf">_check_sse_empty_rs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">ok_version</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the server version is less than any versions in pytan.constants.SSE_CRASH_MAP, if so verifies that the result set is not empty</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * object to get result info for to ensure non-empty answers</span>
<span class="sd">        ok_version : bool</span>
<span class="sd">            * if the version currently running is an &quot;ok&quot; version</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clean_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;obj&#39;</span><span class="p">]</span>
        <span class="n">clean_kwargs</span> <span class="o">=</span> <span class="n">pytan</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">clean_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="n">clean_keys</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok_version</span><span class="p">:</span>
            <span class="n">ri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_info</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">clean_kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ri</span><span class="o">.</span><span class="n">row_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;No rows available to perform a server side export with, result info: {}&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">pytan</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ServerSideExportError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">ri</span><span class="p">))</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Tanium.
      Last updated on Aug 31, 2015.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>