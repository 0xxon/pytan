

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pytan.handler &mdash; PyTan 1.0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="PyTan 1.0.1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../index.html" class="fa fa-home"> PyTan</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../description.html">1. Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../description.html#why-it-was-created">2. Why it was created</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../description.html#requirements">3. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../description.html#installation">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../description.html#usage">5. Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../description.html#directory-layout">6. Directory Layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pytan.html">7. pytan package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/pytan_examples.html">7.1. pytan API examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.handler.html">7.2. pytan.handler module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.constants.html">7.3. pytan.constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.utils.html">7.4. pytan.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.unittest.html">7.5. pytan Unit Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pytan.functest.html">7.6. pytan Functional Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../taniumpy.html">taniumpy package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../taniumpy.session.html">1. taniumpy.session module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../taniumpy.question_asker.html">2. taniumpy.question_asker module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../taniumpy.object_types.html">3. taniumpy.object_types package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../xmltodict.html">8. xmltodict module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ddt.html">9. ddt module</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../threaded_http.html">10. threaded_http module</a><ul class="simple">
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">PyTan</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Module code</a> &raquo;</li>
      
    <li>pytan.handler</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for pytan.handler</h1><div class="highlight"><pre>
<span class="c"># -*- mode: Python; tab-width: 4; indent-tabs-mode: nil; -*-</span>
<span class="c"># ex: set tabstop=4</span>
<span class="c"># Please do not change the two lines above. See PEP 8, PEP 263.</span>
<span class="sd">&quot;&quot;&quot;The main :mod:`pytan` module that provides methods for programmatic use.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c"># disable python from creating .pyc files everywhere</span>
<span class="n">sys</span><span class="o">.</span><span class="n">dont_write_bytecode</span> <span class="o">=</span> <span class="bp">True</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">my_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">my_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">my_file</span><span class="p">)</span>
<span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">my_dir</span><span class="p">)</span>
<span class="n">path_adds</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent_dir</span><span class="p">]</span>

<span class="k">for</span> <span class="n">aa</span> <span class="ow">in</span> <span class="n">path_adds</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">aa</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">taniumpy</span>
<span class="kn">from</span> <span class="nn">pytan</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">pytan</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="kn">from</span> <span class="nn">pytan.utils</span> <span class="kn">import</span> <span class="n">HandlerError</span>
<span class="kn">from</span> <span class="nn">pytan.utils</span> <span class="kn">import</span> <span class="n">RunFalse</span>
<span class="kn">from</span> <span class="nn">pytan.utils</span> <span class="kn">import</span> <span class="n">PytanHelp</span>

<span class="n">mylog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;handler&quot;</span><span class="p">)</span>
<span class="n">actionlog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;action_progress&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Handler"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler">[docs]</a><span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a connection to a Tanium SOAP Server on host:port</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    username : str</span>
<span class="sd">        `username` to connect to `host` with</span>
<span class="sd">    password : str</span>
<span class="sd">        `password` to connect to `host` with</span>
<span class="sd">    host : str</span>
<span class="sd">        hostname or ip of Tanium SOAP Server</span>
<span class="sd">    port : int, optional</span>
<span class="sd">        port of Tanium SOAP Server on `host`</span>
<span class="sd">    loglevel : int, optional</span>
<span class="sd">        0 should not print anything, 1 and higher will print more</span>
<span class="sd">    debugformat : bool, optional</span>
<span class="sd">        False use one line logformat, True use two lines</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">      * port 444 is the default SOAP port</span>
<span class="sd">      * port 443 forwards /soap/ URLs to the SOAP port</span>
<span class="sd">      * Use port 444 if you have direct access to it</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    :data:`pytan.constants.LOG_LEVEL_MAPS` : maps a given `loglevel` to respective logger names and their logger levels</span>
<span class="sd">    :data:`pytan.constants.INFO_FORMAT` : debugformat=False</span>
<span class="sd">    :data:`pytan.constants.DEBUG_FORMAT` : debugformat=True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s">&quot;444&quot;</span><span class="p">,</span> <span class="n">loglevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">debugformat</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Handler</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="c"># setup the console logging handler</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">setup_console_logging</span><span class="p">()</span>
        <span class="c"># create all the loggers and set their levels based on loglevel</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">set_log_levels</span><span class="p">(</span><span class="n">loglevel</span><span class="p">)</span>
        <span class="c"># change the format of console logging handler if need be</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">change_console_format</span><span class="p">(</span><span class="n">debugformat</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loglevel</span> <span class="o">=</span> <span class="n">loglevel</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;Must supply username!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;Must supply password!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;Must supply host!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">port</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;Must supply port!&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="s">&quot;port must be an integer!&quot;</span><span class="p">)</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">test_app_port</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">str_tpl</span> <span class="o">=</span> <span class="s">&quot;Handler for {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">str_tpl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

<div class="viewcode-block" id="Handler.ask"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.ask">[docs]</a>    <span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a type of question and get the results back</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        qtype : str</span>
<span class="sd">            type of question to ask: saved_question, manual, or manual_human</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : dict, containing:</span>
<span class="sd">            * `question_object` : one of the following depending on `qtype`: :class:`taniumpy.object_types.question.Question` or :class:`taniumpy.object_types.saved_question.SavedQuestion`</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.Q_OBJ_MAP` : maps qtype to a method in Handler()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qtype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;qtype&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">qtype</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Must supply question type as &#39;qtype&#39;! Valid choices: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">Q_OBJ_MAP</span><span class="p">)))</span>
        <span class="n">q_obj_map</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_q_obj_map</span><span class="p">(</span><span class="n">qtype</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;qtype&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q_obj_map</span><span class="p">[</span><span class="s">&#39;handler&#39;</span><span class="p">])(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler.ask_saved"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.ask_saved">[docs]</a>    <span class="k">def</span> <span class="nf">ask_saved</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a saved question and get the results back</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int, list of int, optional</span>
<span class="sd">            id of saved question to ask</span>
<span class="sd">        name : str, list of str</span>
<span class="sd">            name of saved question</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing</span>
<span class="sd">            * `question_object` : :class:`taniumpy.object_types.saved_question.SavedQuestion`</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        id or name must be supplied</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.ASK_KWARGS`: list of kwargs that can be passed to :class:`taniumpy.question_asker.QuestionAsker`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get the saved_question object the user passed in</span>
        <span class="n">q_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;saved_question&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">q_objs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Multiple saved questions returned, can only ask one &quot;</span>
                <span class="s">&quot;saved question!</span><span class="se">\n</span><span class="s">Args: {}</span><span class="se">\n</span><span class="s">Returned saved questions:</span><span class="se">\n\t</span><span class="s">{}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="n">q_obj_str</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">q_objs</span><span class="p">])</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">q_obj_str</span><span class="p">))</span>

        <span class="n">q_obj</span> <span class="o">=</span> <span class="n">q_objs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># poll the Saved Question ID returned above to wait for results</span>
        <span class="n">ask_kwargs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_ask_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">asker</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">QuestionAsker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">q_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">ask_kwargs</span><span class="p">)</span>
        <span class="n">asker</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s">&#39;ProgressChanged&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">question_progress</span><span class="p">})</span>

        <span class="c"># get the results</span>
        <span class="n">req_kwargs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_req_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">getResultData</span><span class="p">(</span><span class="n">q_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">req_kwargs</span><span class="p">)</span>

        <span class="c"># add the sensors from this question to the ResultSet object</span>
        <span class="c"># for reporting</span>
        <span class="n">result</span><span class="o">.</span><span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">sensor</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">q_obj</span><span class="o">.</span><span class="n">question</span><span class="o">.</span><span class="n">selects</span><span class="p">]</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;question_object&#39;</span><span class="p">:</span> <span class="n">q_obj</span><span class="p">,</span>
            <span class="s">&#39;question_results&#39;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler.ask_manual"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.ask_manual">[docs]</a>    <span class="k">def</span> <span class="nf">ask_manual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">get_results</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a manual question using definitions and get the results back</span>

<span class="sd">        This method requires in-depth knowledge of how filters and options are created in the API,</span>
<span class="sd">        and as such is not meant for human consumption. Use :func:`ask_manual_human` instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sensor_defs : str, dict, list of str or dict</span>
<span class="sd">            sensor definitions</span>
<span class="sd">        question_filter_defs : dict, list of dict, optional</span>
<span class="sd">            question filter definitions</span>
<span class="sd">        question_option_defs : dict, list of dict, optional</span>
<span class="sd">            question option definitions</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * True: wait for result completion after asking question</span>
<span class="sd">            * False: just ask the question and return it in `ret`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing:</span>
<span class="sd">            * `question_object` : :class:`taniumpy.object_types.question.Question`</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # example of str for sensor_defs</span>
<span class="sd">        &gt;&gt;&gt; sensor_defs = &#39;Sensor1&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of dict for sensor_defs</span>
<span class="sd">        &gt;&gt;&gt; sensor_defs = {</span>
<span class="sd">        ... &#39;name&#39;: &#39;Sensor1&#39;,</span>
<span class="sd">        ...     &#39;filter&#39;: {</span>
<span class="sd">        ...         &#39;operator&#39;: &#39;RegexMatch&#39;,</span>
<span class="sd">        ...         &#39;not_flag&#39;: 0,</span>
<span class="sd">        ...         &#39;value&#39;: &#39;.*&#39;</span>
<span class="sd">        ...     },</span>
<span class="sd">        ...     &#39;params&#39;: {&#39;key&#39;: &#39;value&#39;},</span>
<span class="sd">        ...     &#39;options&#39;: {&#39;and_flag&#39;: 1}</span>
<span class="sd">        ... }</span>

<span class="sd">        &gt;&gt;&gt; # example of dict for question_filter_defs</span>
<span class="sd">        &gt;&gt;&gt; question_filter_defs = {</span>
<span class="sd">        ...     &#39;operator&#39;: &#39;RegexMatch&#39;,</span>
<span class="sd">        ...     &#39;not_flag&#39;: 0,</span>
<span class="sd">        ...     &#39;value&#39;: &#39;.*&#39;</span>
<span class="sd">        ... }</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filter dictionaries for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid option dictionaries for options</span>
<span class="sd">        :data:`pytan.constants.ASK_KWARGS` : list of kwargs that can be passed to :class:`taniumpy.question_asker.QuestionAsker`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># get our defs from kwargs and churn them into what we want</span>
        <span class="n">sensor_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;sensor_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;list()&#39;</span><span class="p">,</span> <span class="s">&#39;str()&#39;</span><span class="p">,</span> <span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">strconv</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">,</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">q_filter_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;question_filter_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;list()&#39;</span><span class="p">,</span> <span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">q_option_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;question_option_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="c"># do basic validation of our defs</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">val_sensor_defs</span><span class="p">(</span><span class="n">sensor_defs</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">val_q_filter_defs</span><span class="p">(</span><span class="n">q_filter_defs</span><span class="p">)</span>

        <span class="c"># get the sensor objects that are in our defs and add them as</span>
        <span class="c"># d[&#39;sensor_obj&#39;]</span>
        <span class="n">sensor_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">sensor_defs</span><span class="p">)</span>
        <span class="n">q_filter_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">q_filter_defs</span><span class="p">)</span>

        <span class="c"># build a SelectList object from our sensor_defs</span>
        <span class="n">selectlist_obj</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_selectlist_obj</span><span class="p">(</span><span class="n">sensor_defs</span><span class="p">)</span>

        <span class="c"># build a Group object from our question filters/options</span>
        <span class="n">group_obj</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_group_obj</span><span class="p">(</span><span class="n">q_filter_defs</span><span class="p">,</span> <span class="n">q_option_defs</span><span class="p">)</span>

        <span class="c"># build a Question object from selectlist_obj and group_obj</span>
        <span class="n">add_q_obj</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_manual_q</span><span class="p">(</span><span class="n">selectlist_obj</span><span class="p">,</span> <span class="n">group_obj</span><span class="p">)</span>

        <span class="c"># add our Question and get a Question ID back</span>
        <span class="n">q_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">add_q_obj</span><span class="p">)</span>

        <span class="c"># refetch the full object of the question so that we have access</span>
        <span class="c"># to everything (especially query_text)</span>
        <span class="n">q_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;question&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">q_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;question_object&#39;</span><span class="p">:</span> <span class="n">q_obj</span><span class="p">,</span>
            <span class="s">&#39;question_results&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">get_results</span><span class="p">:</span>
            <span class="c"># poll the Question ID returned above to wait for results</span>
            <span class="n">ask_kwargs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_ask_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">asker</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">QuestionAsker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">q_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">ask_kwargs</span><span class="p">)</span>
            <span class="n">asker</span><span class="o">.</span><span class="n">run</span><span class="p">({</span><span class="s">&#39;ProgressChanged&#39;</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">question_progress</span><span class="p">})</span>

            <span class="c"># get the results</span>
            <span class="n">req_kwargs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_req_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">getResultData</span><span class="p">(</span><span class="n">q_obj</span><span class="p">,</span> <span class="o">**</span><span class="n">req_kwargs</span><span class="p">)</span>

            <span class="c"># add the sensors from this question to the ResultSet object</span>
            <span class="c"># for reporting</span>
            <span class="n">result</span><span class="o">.</span><span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;sensor_obj&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sensor_defs</span><span class="p">]</span>
            <span class="n">ret</span><span class="p">[</span><span class="s">&#39;question_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler.ask_manual_human"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.ask_manual_human">[docs]</a>    <span class="k">def</span> <span class="nf">ask_manual_human</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ask a manual question using human strings and get the results back</span>

<span class="sd">        This method takes a string or list of strings and parses them into</span>
<span class="sd">        their corresponding definitions needed by :func:`ask_manual`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sensors : str, list of str</span>
<span class="sd">            sensors (columns) to include in question</span>
<span class="sd">        question_filters : str, list of str, optional</span>
<span class="sd">            filters that apply to the whole question</span>
<span class="sd">        question_options : str, list of str, optional</span>
<span class="sd">            options that apply to the whole question</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * True: wait for result completion after asking question</span>
<span class="sd">            * False: just ask the question and return it in result</span>
<span class="sd">        sensors_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for sensors</span>
<span class="sd">            * True: print the help string for sensors and exit</span>
<span class="sd">        filters_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for filters</span>
<span class="sd">            * True: print the help string for filters and exit</span>
<span class="sd">        options_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for options</span>
<span class="sd">            * True: print the help string for options and exit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : dict, containing:</span>
<span class="sd">            * `question_object` : :class:`taniumpy.object_types.question.Question`</span>
<span class="sd">            * `question_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # example of str for `sensors`</span>
<span class="sd">        &gt;&gt;&gt; sensors = &#39;Sensor1&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `sensors` with params</span>
<span class="sd">        &gt;&gt;&gt; sensors = &#39;Sensor1{key:value}&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `sensors` with params and filter</span>
<span class="sd">        &gt;&gt;&gt; sensors = &#39;Sensor1{key:value}, that contains:example text&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `sensors` with params and filter and options</span>
<span class="sd">        &gt;&gt;&gt; sensors = (</span>
<span class="sd">        ...     &#39;Sensor1{key:value}, that contains:example text,&#39;</span>
<span class="sd">        ...     &#39;opt:ignore_case, opt:max_data_age:60&#39;</span>
<span class="sd">        ... )</span>

<span class="sd">        &gt;&gt;&gt; # example of str for question_filters</span>
<span class="sd">        &gt;&gt;&gt; question_filters = &#39;Sensor2, that contains:example test&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of list of str for question_options</span>
<span class="sd">        &gt;&gt;&gt; question_options = [&#39;max_data_age:3600&#39;, &#39;and&#39;]</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filter dictionaries for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid option dictionaries for options</span>
<span class="sd">        :data:`pytan.constants.ASK_KWARGS` : list of kwargs that can be passed to :class:`taniumpy.question_asker.QuestionAsker`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sensors_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_sensors</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;filters_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_filters</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;options_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_options</span><span class="p">())</span>

        <span class="k">if</span> <span class="s">&#39;sensors&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">sensors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;sensors&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sensors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s">&#39;question_filters&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">q_filters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;question_filters&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q_filters</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="s">&#39;question_options&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">q_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;question_options&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q_options</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">sensor_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_sensors</span><span class="p">(</span><span class="n">sensors</span><span class="p">)</span>
        <span class="n">q_filter_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_filters</span><span class="p">(</span><span class="n">q_filters</span><span class="p">)</span>
        <span class="n">q_option_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_options</span><span class="p">(</span><span class="n">q_options</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask_manual</span><span class="p">(</span>
            <span class="n">sensor_defs</span><span class="o">=</span><span class="n">sensor_defs</span><span class="p">,</span>
            <span class="n">question_filter_defs</span><span class="o">=</span><span class="n">q_filter_defs</span><span class="p">,</span>
            <span class="n">question_option_defs</span><span class="o">=</span><span class="n">q_option_defs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler.load_taniumpy_from_json"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.load_taniumpy_from_json">[docs]</a>    <span class="k">def</span> <span class="nf">load_taniumpy_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">json_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Opens a json file and parses it into an taniumpy object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        json_file : str</span>
<span class="sd">            path to JSON file that describes an API object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            TaniumPy object converted from json file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Unable to open json_file {!r}, {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>

        <span class="n">howto_m</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Use get_${OBJECT_TYPE}.py with --include-type and &quot;</span>
            <span class="s">&quot;--no-explode-json to export a valid JSON file that can be used &quot;</span>
            <span class="s">&quot;for importing&quot;</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">json_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Unable to parse json_file {!r}, {}</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">howto_m</span><span class="p">))</span>

        <span class="k">if</span> <span class="s">&#39;_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Missing &#39;_type&#39; key in JSON loaded dictionary!</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">howto_m</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">BaseType</span><span class="o">.</span><span class="n">from_jsonable</span><span class="p">(</span><span class="n">json_dict</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;Unable to parse json_file {!r} into an API {} object</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;Exception from API.from_jsonable(): {}</span><span class="se">\n</span><span class="s">{}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="n">json_dict</span><span class="p">[</span><span class="s">&#39;_type&#39;</span><span class="p">],</span> <span class="n">e</span><span class="p">,</span> <span class="n">howto_m</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">obj</span>
</div>
<div class="viewcode-block" id="Handler.create_from_json"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_from_json">[docs]</a>    <span class="k">def</span> <span class="nf">create_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="n">json_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new object using the SOAP api from a json file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype : str</span>
<span class="sd">            Type of object described in `json_file`</span>
<span class="sd">        json_file : str</span>
<span class="sd">            path to JSON file that describes an API object</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            TaniumPy object added to Tanium SOAP Server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.GET_OBJ_MAP` : maps objtype to supported &#39;create_json&#39; types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_map</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_obj_map</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
        <span class="n">create_json_ok</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;create_json&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">create_json_ok</span><span class="p">:</span>
            <span class="n">json_createable</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">GET_OBJ_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="s">&#39;create_json&#39;</span><span class="p">]</span>
            <span class="p">])</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;{} is not a json createable object! Supported objects: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">json_createable</span><span class="p">))</span>

        <span class="n">add_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_taniumpy_from_json</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">add_obj</span><span class="p">,</span> <span class="s">&#39;_list_properties&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="n">obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">add_obj</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">add_obj</span><span class="p">]</span>

        <span class="n">del_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;hash&#39;</span><span class="p">]</span>
        <span class="p">[</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">obj_list</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">del_keys</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">obj_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;allfix&#39;</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;allfix&#39;</span><span class="p">])()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">])()</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">list_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;Failure while importing {}: {}</span><span class="se">\n</span><span class="s">JSON Dump of object: {}&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

            <span class="n">list_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">list_obj</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New {} (ID: {}) created successfully!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">list_obj</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">list_obj</span><span class="p">,</span> <span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;Unknown&#39;</span><span class="p">)))</span>

            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler.create_sensor"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">create_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a sensor object</span>

<span class="sd">        Warnings</span>
<span class="sd">        --------</span>
<span class="sd">        Not currently supported, too complicated to add.</span>
<span class="sd">        Use :func:`create_from_json` instead for this object type!</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        HandlerError : :exc:`pytan.utils.HandlerError`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Sensor creation not supported via PyTan as of yet, too complex</span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="s">&quot;Use create_sensor_from_json() instead!&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Handler.create_package"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_package">[docs]</a>    <span class="k">def</span> <span class="nf">create_package</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">,</span>
            <span class="n">command</span><span class="p">,</span>
            <span class="n">display_name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">file_urls</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">command_timeout_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">expire_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">parameters_json_file</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">verify_filters</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">verify_filter_options</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">verify_expire_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a package object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            name of package to create</span>
<span class="sd">        command : str</span>
<span class="sd">            command to execute</span>
<span class="sd">        display_name : str, optional</span>
<span class="sd">            display name of package</span>
<span class="sd">        file_urls : list of strings, optional</span>
<span class="sd">            * URL of file to add to package</span>
<span class="sd">            * can optionally define download_seconds by using SECONDS::URL</span>
<span class="sd">            * can optionally define file name by using FILENAME||URL</span>
<span class="sd">            * can combine optionals by using SECONDS::FILENAME||URL</span>
<span class="sd">            * FILENAME will be extracted from basename of URL if not provided</span>
<span class="sd">        command_timeout_seconds : int, optional</span>
<span class="sd">            timeout for command execution in seconds</span>
<span class="sd">        parameters_json_file : str, optional</span>
<span class="sd">            path to json file describing parameters for package</span>
<span class="sd">        expire_seconds : int, optional</span>
<span class="sd">            timeout for action expiry in seconds</span>
<span class="sd">        verify_filters : str or list of str, optional</span>
<span class="sd">            each string must describe a filter to be used to verify the package</span>
<span class="sd">        verify_filter_options : str or list of str, optional</span>
<span class="sd">            each string must describe an option for `verify_filters`</span>
<span class="sd">        verify_expire_seconds : int, optional</span>
<span class="sd">            timeout for verify action expiry in seconds</span>
<span class="sd">        filters_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for filters</span>
<span class="sd">            * True: print the help string for filters and exit</span>
<span class="sd">        options_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for options</span>
<span class="sd">            * True: print the help string for options and exit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        package_obj : :class:`taniumpy.object_types.package_spec.PackageSpec`</span>
<span class="sd">            TaniumPy object added to Tanium SOAP Server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filters for verify_filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid options for verify_filter_options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;filters_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_filters</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;options_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_options</span><span class="p">())</span>

        <span class="c"># bare minimum arguments for new package: name, command</span>
        <span class="n">add_package_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PackageSpec</span><span class="p">()</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">display_name</span><span class="p">:</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">display_name</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="n">command</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">command_timeout</span> <span class="o">=</span> <span class="n">command_timeout_seconds</span>
        <span class="n">add_package_obj</span><span class="o">.</span><span class="n">expire_seconds</span> <span class="o">=</span> <span class="n">expire_seconds</span>

        <span class="c"># VERIFY FILTERS</span>
        <span class="k">if</span> <span class="n">verify_filters</span><span class="p">:</span>
            <span class="n">verify_filter_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_filters</span><span class="p">(</span>
                <span class="n">verify_filters</span>
            <span class="p">)</span>
            <span class="n">verify_option_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_options</span><span class="p">(</span>
                <span class="n">verify_filter_options</span>
            <span class="p">)</span>
            <span class="n">verify_filter_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">verify_filter_defs</span><span class="p">)</span>
            <span class="n">add_verify_group</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_group_obj</span><span class="p">(</span>
                <span class="n">verify_filter_defs</span><span class="p">,</span> <span class="n">verify_option_defs</span>
            <span class="p">)</span>
            <span class="n">verify_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">add_verify_group</span><span class="p">)</span>
            <span class="c"># this didn&#39;t work:</span>
            <span class="c"># add_package_obj.verify_group = verify_group</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">verify_group_id</span> <span class="o">=</span> <span class="n">verify_group</span><span class="o">.</span><span class="n">id</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">verify_expire_seconds</span> <span class="o">=</span> <span class="n">verify_expire_seconds</span>

        <span class="c"># PARAMETERS</span>
        <span class="k">if</span> <span class="n">parameters_json_file</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pd</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">parameters_json_file</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;Failed to load JSON parameter file {!r}, error {!r}!!</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="s">&quot;Refer to doc/example_of_all_package_parameters.json &quot;</span>
                    <span class="s">&quot;file for examples of each parameter type&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">parameters_json_file</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pd_params</span> <span class="o">=</span> <span class="n">pd</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;JSON parameter file {!r} is missing a &#39;parameters&#39; &quot;</span>
                    <span class="s">&quot;list!!</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="s">&quot;Refer to doc/example_of_all_package_parameters.json &quot;</span>
                    <span class="s">&quot;file for examples of each parameter type&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">parameters_json_file</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">pd_param</span> <span class="ow">in</span> <span class="n">pd_params</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pd_key</span> <span class="o">=</span> <span class="n">pd_param</span><span class="p">[</span><span class="s">&#39;key&#39;</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s">&quot;JSON parameter file {!r} is missing a &#39;key&#39; &quot;</span>
                        <span class="s">&quot;in the parameter {!r}!!</span><span class="se">\n</span><span class="s">&quot;</span>
                        <span class="s">&quot;Refer to doc/example_of_all_package_parameters.json &quot;</span>
                        <span class="s">&quot;file for examples of each parameter type&quot;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                    <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">parameters_json_file</span><span class="p">,</span> <span class="n">pd_param</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">pd_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">command</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s">&quot;command {!r} is missing the parameter key &#39;{}&#39; &quot;</span>
                        <span class="s">&quot;referenced in the JSON parameter file {!r}!!</span><span class="se">\n</span><span class="s">&quot;</span>
                        <span class="s">&quot;Ensure all parameters are referenced in the command&quot;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                    <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span>
                        <span class="n">command</span><span class="p">,</span> <span class="n">pd_key</span><span class="p">,</span> <span class="n">parameters_json_file</span>
                    <span class="p">))</span>

            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">parameter_definition</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span>

        <span class="c"># FILES</span>
        <span class="k">if</span> <span class="n">file_urls</span><span class="p">:</span>
            <span class="n">filelist_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PackageFileList</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">file_url</span> <span class="ow">in</span> <span class="n">file_urls</span><span class="p">:</span>
                <span class="c"># if :: is in file_url, split on it and use 0 as</span>
                <span class="c"># download_seconds</span>
                <span class="k">if</span> <span class="s">&#39;::&#39;</span> <span class="ow">in</span> <span class="n">file_url</span><span class="p">:</span>
                    <span class="n">download_seconds</span><span class="p">,</span> <span class="n">file_url</span> <span class="o">=</span> <span class="n">file_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;::&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">download_seconds</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c"># if || is in file_url, split on it and use 0 as file name</span>
                <span class="c"># else wise get file name from basename of URL</span>
                <span class="k">if</span> <span class="s">&#39;||&#39;</span> <span class="ow">in</span> <span class="n">file_url</span><span class="p">:</span>
                    <span class="n">filename</span><span class="p">,</span> <span class="n">file_url</span> <span class="o">=</span> <span class="n">file_url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;||&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_url</span><span class="p">)</span>
                <span class="n">file_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PackageFile</span><span class="p">()</span>
                <span class="n">file_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filename</span>
                <span class="n">file_obj</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">file_url</span>
                <span class="n">file_obj</span><span class="o">.</span><span class="n">download_seconds</span> <span class="o">=</span> <span class="n">download_seconds</span>
                <span class="n">filelist_obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_obj</span><span class="p">)</span>
            <span class="n">add_package_obj</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">filelist_obj</span>

        <span class="n">package_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">add_package_obj</span><span class="p">)</span>
        <span class="n">package_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">package_obj</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New package {!r} created with ID {!r}, command: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">package_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">package_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">package_obj</span><span class="o">.</span><span class="n">command</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">package_obj</span>
</div>
<div class="viewcode-block" id="Handler.create_group"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_group">[docs]</a>    <span class="k">def</span> <span class="nf">create_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupname</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[],</span> <span class="n">filter_options</span><span class="o">=</span><span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a group object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        groupname : str</span>
<span class="sd">            name of group to create</span>
<span class="sd">        filters : str or list of str, optional</span>
<span class="sd">            each string must describe a filter</span>
<span class="sd">        filter_options : str or list of str, optional</span>
<span class="sd">            each string must describe an option for `filters`</span>
<span class="sd">        filters_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for filters</span>
<span class="sd">            * True: print the help string for filters and exit</span>
<span class="sd">        options_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for options</span>
<span class="sd">            * True: print the help string for options and exit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        group_obj : :class:`taniumpy.object_types.group.Group`</span>
<span class="sd">            TaniumPy object added to Tanium SOAP Server</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filters for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid options for filter_options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;filters_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_filters</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;options_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_options</span><span class="p">())</span>

        <span class="n">filter_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">filter_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">filter_defs</span><span class="p">)</span>
        <span class="n">option_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_options</span><span class="p">(</span><span class="n">filter_options</span><span class="p">)</span>
        <span class="n">add_group_obj</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_group_obj</span><span class="p">(</span><span class="n">filter_defs</span><span class="p">,</span> <span class="n">option_defs</span><span class="p">)</span>
        <span class="n">add_group_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">groupname</span>
        <span class="n">group_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">add_group_obj</span><span class="p">)</span>
        <span class="n">group_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">group_obj</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New group {!r} created with ID {!r}, filter text: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">group_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">group_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">group_obj</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">group_obj</span>
</div>
<div class="viewcode-block" id="Handler.create_user"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_user">[docs]</a>    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">rolename</span><span class="o">=</span><span class="p">[],</span> <span class="n">roleid</span><span class="o">=</span><span class="p">[],</span> <span class="n">properties</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Create a user object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        username : str</span>
<span class="sd">            name of user to create</span>
<span class="sd">        rolename : str or list of str, optional</span>
<span class="sd">            name(s) of roles to add to user</span>
<span class="sd">        roleid : int or list of int, optional</span>
<span class="sd">            id(s) of roles to add to user</span>
<span class="sd">        properties: list of list of strs, optional</span>
<span class="sd">            * each list must be a 2 item list:</span>
<span class="sd">            * list item 1 property name</span>
<span class="sd">            * list item 2 property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        user_obj : :class:`taniumpy.object_types.user.User`</span>
<span class="sd">            TaniumPy object added to Tanium SOAP Server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">roleid</span> <span class="ow">or</span> <span class="n">rolename</span><span class="p">:</span>
            <span class="n">rolelist_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;userrole&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">roleid</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rolename</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rolelist_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">RoleList</span><span class="p">()</span>
        <span class="n">metadatalist_obj</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_metadatalist_obj</span><span class="p">(</span>
            <span class="n">properties</span><span class="p">,</span> <span class="s">&#39;TConsole.User.Property&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_user_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
        <span class="n">add_user_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">username</span>
        <span class="n">add_user_obj</span><span class="o">.</span><span class="n">roles</span> <span class="o">=</span> <span class="n">rolelist_obj</span>
        <span class="n">add_user_obj</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadatalist_obj</span>
        <span class="n">user_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">add_user_obj</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New user {!r} created with ID {!r}, roles: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span>
            <span class="n">user_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">user_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rolelist_obj</span><span class="p">]</span>
        <span class="p">))</span>
        <span class="k">return</span> <span class="n">user_obj</span>
</div>
<div class="viewcode-block" id="Handler.create_whitelisted_url"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.create_whitelisted_url">[docs]</a>    <span class="k">def</span> <span class="nf">create_whitelisted_url</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">download_seconds</span><span class="o">=</span><span class="mi">86400</span><span class="p">,</span>
            <span class="n">properties</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;Create a whitelisted url object</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        url : str</span>
<span class="sd">            text of new url</span>
<span class="sd">        regex : bool, optional</span>
<span class="sd">            * True: `url` is a regex pattern</span>
<span class="sd">            * False: `url` is not a regex pattern</span>
<span class="sd">        download_seconds : int, optional</span>
<span class="sd">            how often to re-download `url`</span>
<span class="sd">        properties: list of list of strs, optional</span>
<span class="sd">            * each list must be a 2 item list:</span>
<span class="sd">            * list item 1 property name</span>
<span class="sd">            * list item 2 property value</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        url_obj : :class:`taniumpy.object_types.white_listed_url.WhiteListedUrl`</span>
<span class="sd">            TaniumPy object added to Tanium SOAP Server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">regex</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;regex:&#39;</span> <span class="o">+</span> <span class="n">url</span>

        <span class="n">metadatalist_obj</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_metadatalist_obj</span><span class="p">(</span>
            <span class="n">properties</span><span class="p">,</span> <span class="s">&#39;TConsole.WhitelistedURL&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_url_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">WhiteListedUrl</span><span class="p">()</span>
        <span class="n">add_url_obj</span><span class="o">.</span><span class="n">url_regex</span> <span class="o">=</span> <span class="n">url</span>
        <span class="n">add_url_obj</span><span class="o">.</span><span class="n">download_seconds</span> <span class="o">=</span> <span class="n">download_seconds</span>
        <span class="n">add_url_obj</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metadatalist_obj</span>
        <span class="n">url_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">add_url_obj</span><span class="p">)</span>
        <span class="n">url_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">url_obj</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;New Whitelisted URL {!r} created with ID {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">url_obj</span><span class="o">.</span><span class="n">url_regex</span><span class="p">,</span> <span class="n">url_obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">url_obj</span>
</div>
<div class="viewcode-block" id="Handler.delete"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete an object type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype : string</span>
<span class="sd">            type of object to delete</span>
<span class="sd">        id/name/hash : int or string, list of int or string</span>
<span class="sd">            search attributes of object to delete, must supply at least one valid search attr</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict</span>
<span class="sd">            dict containing deploy action object and results from deploy action</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.GET_OBJ_MAP` : maps objtype to supported &#39;search&#39; keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_map</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_obj_map</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
        <span class="n">delete_ok</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;delete&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">delete_ok</span><span class="p">:</span>
            <span class="n">deletable</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">constants</span><span class="o">.</span><span class="n">GET_OBJ_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="s">&#39;delete&#39;</span><span class="p">]</span>
            <span class="p">])</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;{} is not a deletable object! Deletable objects: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">deletable</span><span class="p">))</span>
        <span class="n">objs_to_del</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">deleted_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obj_to_del</span> <span class="ow">in</span> <span class="n">objs_to_del</span><span class="p">:</span>
            <span class="n">del_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">obj_to_del</span><span class="p">)</span>
            <span class="n">deleted_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">del_obj</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Deleted {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">del_obj</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">deleted_objects</span>
</div>
<div class="viewcode-block" id="Handler.deploy_action"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.deploy_action">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">get_results</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deploy an action and get the results back</span>

<span class="sd">        This method requires in-depth knowledge of how filters and options are created in the API, and as such is not meant for human consumption. Use :func:`deploy_action_human` instead.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        package_def : dict</span>
<span class="sd">            definition that describes a package</span>
<span class="sd">        action_filter_defs : str, dict, list of str or dict, optional</span>
<span class="sd">            action filter definitions</span>
<span class="sd">        action_option_defs : dict, list of dict, optional</span>
<span class="sd">            action filter option definitions</span>
<span class="sd">        start_seconds_from_now : int, optional</span>
<span class="sd">            start action N seconds from now</span>
<span class="sd">        expire_seconds : int, optional</span>
<span class="sd">            expire action N seconds from now, will be derived from package if not supplied</span>
<span class="sd">        run : bool, optional</span>
<span class="sd">            * False: just ask the question that pertains to verify action, export the results to CSV, and raise RunFalse -- does not deploy the action</span>
<span class="sd">            * True: actually deploy the action</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * True: wait for result completion after deploying action</span>
<span class="sd">            * False: just deploy the action and return the object in `ret`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing:</span>
<span class="sd">            * `action_object` : :class:`taniumpy.object_types.action.Action`</span>
<span class="sd">            * `action_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * `action_progress_human` : str, progress map in human form</span>
<span class="sd">            * `action_progress_map` : dict, progress map in dictionary form</span>
<span class="sd">            * `pre_action_question_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # example of dict for `package_def`</span>
<span class="sd">        &gt;&gt;&gt; package_def = {&#39;name&#39;: &#39;PackageName1&#39;, &#39;params&#39;:{&#39;param1&#39;: &#39;value1&#39;}}</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `action_filter_defs`</span>
<span class="sd">        &gt;&gt;&gt; action_filter_defs = &#39;Sensor1&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of dict for `action_filter_defs`</span>
<span class="sd">        &gt;&gt;&gt; action_filter_defs = {</span>
<span class="sd">        ... &#39;name&#39;: &#39;Sensor1&#39;,</span>
<span class="sd">        ...     &#39;filter&#39;: {</span>
<span class="sd">        ...         &#39;operator&#39;: &#39;RegexMatch&#39;,</span>
<span class="sd">        ...         &#39;not_flag&#39;: 0,</span>
<span class="sd">        ...         &#39;value&#39;: &#39;.*&#39;</span>
<span class="sd">        ...     },</span>
<span class="sd">        ...     &#39;options&#39;: {&#39;and_flag&#39;: 1}</span>
<span class="sd">        ... }</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filter dictionaries for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid option dictionaries for options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># get our defs from kwargs and churn them into what we want</span>
        <span class="n">action_filter_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;action_filter_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;list()&#39;</span><span class="p">,</span> <span class="s">&#39;str()&#39;</span><span class="p">,</span> <span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">strconv</span><span class="o">=</span><span class="s">&#39;name&#39;</span><span class="p">,</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">action_option_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;action_option_defs&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">package_def</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">parse_defs</span><span class="p">(</span>
            <span class="n">defname</span><span class="o">=</span><span class="s">&#39;package_def&#39;</span><span class="p">,</span>
            <span class="n">deftypes</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;dict()&#39;</span><span class="p">],</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">start_seconds_from_now</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_kwargs_int</span><span class="p">(</span>
            <span class="s">&#39;start_seconds_from_now&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">expire_seconds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_kwargs_int</span><span class="p">(</span><span class="s">&#39;expire_seconds&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># do basic validation of our defs</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">val_sensor_defs</span><span class="p">(</span><span class="n">action_filter_defs</span><span class="p">)</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">val_package_def</span><span class="p">(</span><span class="n">package_def</span><span class="p">)</span>

        <span class="c"># get the objects that are in our defs and add them as</span>
        <span class="c"># d[&#39;sensor_obj&#39;] / d[&#39;package_obj&#39;]</span>
        <span class="n">action_filter_defs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sensor_defs</span><span class="p">(</span><span class="n">action_filter_defs</span><span class="p">)</span>
        <span class="n">package_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_package_def</span><span class="p">(</span><span class="n">package_def</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ask the question that pertains to the action filter</span>
<span class="sd">        this will be used to get a count for how many servers should be seen</span>
<span class="sd">        in the deploy action resultdata as &#39;completed&#39;</span>

<span class="sd">        We supply Computer Name and Online = True as the sensors if run is</span>
<span class="sd">        False, then exit out after asking the question to allow the user</span>
<span class="sd">        to verify the contents</span>

<span class="sd">        If run is True we just use Online = True for the sensor</span>

<span class="sd">        The action filter for the deploy action is used as the question</span>
<span class="sd">        filter in both cases</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">pre_action_sensors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Computer Name&#39;</span><span class="p">,</span> <span class="s">&#39;Online, that =:True&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pre_action_sensors</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Online, that =:True&#39;</span><span class="p">]</span>

        <span class="n">pre_action_sensor_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_sensors</span><span class="p">(</span><span class="n">pre_action_sensors</span><span class="p">)</span>
        <span class="n">pre_action_result_ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask_manual</span><span class="p">(</span>
            <span class="n">sensor_defs</span><span class="o">=</span><span class="n">pre_action_sensor_defs</span><span class="p">,</span>
            <span class="n">question_filter_defs</span><span class="o">=</span><span class="n">action_filter_defs</span><span class="p">,</span>
            <span class="n">question_option_defs</span><span class="o">=</span><span class="n">action_option_defs</span><span class="p">,</span>
            <span class="n">hide_no_results_flag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pre_action_result</span> <span class="o">=</span> <span class="n">pre_action_result_ret</span><span class="p">[</span><span class="s">&#39;question_results&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">run</span><span class="p">:</span>
            <span class="n">report_path</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_to_report_file</span><span class="p">(</span>
                <span class="n">pre_action_result</span><span class="p">,</span> <span class="s">&#39;csv&#39;</span><span class="p">,</span>
                <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;VERIFY_BEFORE_DEPLOY_ACTION_&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;&#39;Run&#39; is not True!!</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;View and verify the contents of {} (length: {} bytes)</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;Re-run this deploy action with run=True after verifying&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">RunFalse</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>

        <span class="sd">&quot;&quot;&quot; note from jwk:</span>
<span class="sd">        passed_count == the number of machines that pass the filter and</span>
<span class="sd">        therefore the number that should take the action</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">passed_count</span> <span class="o">=</span> <span class="n">pre_action_result</span><span class="o">.</span><span class="n">passed</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;Number of systems that match action filter (passed_count): {}&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">format</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">passed_count</span><span class="p">))</span>

        <span class="n">targetgroup_obj</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_group_obj</span><span class="p">(</span>
            <span class="n">action_filter_defs</span><span class="p">,</span> <span class="n">action_option_defs</span>
        <span class="p">)</span>

        <span class="n">package_obj</span> <span class="o">=</span> <span class="n">package_def</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">]</span>
        <span class="n">user_params</span> <span class="o">=</span> <span class="n">package_def</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">]</span>
        <span class="n">param_objlist</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">build_param_objlist</span><span class="p">(</span>
            <span class="n">obj</span><span class="o">=</span><span class="n">package_obj</span><span class="p">,</span>
            <span class="n">user_params</span><span class="o">=</span><span class="n">user_params</span><span class="p">,</span>
            <span class="n">delim</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">derive_def</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">empty_ok</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">a_package_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">PackageSpec</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">param_objlist</span><span class="p">:</span>
            <span class="n">a_package_obj</span><span class="o">.</span><span class="n">source_id</span> <span class="o">=</span> <span class="n">package_obj</span><span class="o">.</span><span class="n">id</span>
            <span class="n">a_package_obj</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">param_objlist</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_package_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">package_obj</span><span class="o">.</span><span class="n">name</span>

        <span class="n">add_action_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">Action</span><span class="p">()</span>
        <span class="n">add_action_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;API Deploy {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">package_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">add_action_obj</span><span class="o">.</span><span class="n">package_spec</span> <span class="o">=</span> <span class="n">a_package_obj</span>
        <span class="n">add_action_obj</span><span class="o">.</span><span class="n">target_group</span> <span class="o">=</span> <span class="n">targetgroup_obj</span>
        <span class="n">add_action_obj</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">seconds_from_now</span><span class="p">(</span>
            <span class="n">start_seconds_from_now</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">expire_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">add_action_obj</span><span class="o">.</span><span class="n">expire_seconds</span> <span class="o">=</span> <span class="n">expire_seconds</span>

        <span class="n">action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">add_action_obj</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Deploy Action Added, ID: {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="n">action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">action_obj</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;action_object&#39;</span><span class="p">:</span> <span class="n">action_obj</span><span class="p">,</span>
            <span class="s">&#39;action_results&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;action_progress_human&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;action_progress_map&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="s">&#39;pre_action_question_results&#39;</span><span class="p">:</span> <span class="n">pre_action_result_ret</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">get_results</span><span class="p">:</span>
            <span class="n">deploy_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_action_asker</span><span class="p">(</span>
                <span class="n">action_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">passed_count</span>
            <span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">deploy_results</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Deploy Action Completed {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">seconds_from_now</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler.deploy_action_human"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.deploy_action_human">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_action_human</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deploy an action and get the results back</span>

<span class="sd">        This method takes a string or list of strings and parses them into</span>
<span class="sd">        their corresponding definitions needed by :func:`deploy_action`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        package : str</span>
<span class="sd">            each string must describe a package</span>
<span class="sd">        action_filters : str, list of str, optional</span>
<span class="sd">            each string must describe a sensor and a filter which limits which computers the action will deploy `package` to</span>
<span class="sd">        action_options : str, list of str, optional</span>
<span class="sd">            options to apply to `action_filters`</span>
<span class="sd">        start_seconds_from_now : int, optional</span>
<span class="sd">            start action N seconds from now</span>
<span class="sd">        expire_seconds : int, optional</span>
<span class="sd">            expire action N seconds from now, will be derived from package if not supplied</span>
<span class="sd">        run : bool, optional</span>
<span class="sd">            * False: just ask the question that pertains to verify action, export the results to CSV, and raise RunFalse -- does not deploy the action</span>
<span class="sd">            * True: actually deploy the action</span>
<span class="sd">        get_results : bool, optional</span>
<span class="sd">            * True: wait for result completion after deploying action</span>
<span class="sd">            * False: just deploy the action and return the object in `ret`</span>
<span class="sd">        package_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for package</span>
<span class="sd">            * True: print the help string for package and exit</span>
<span class="sd">        filters_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for filters</span>
<span class="sd">            * True: print the help string for filters and exit</span>
<span class="sd">        options_help : bool, optional</span>
<span class="sd">            * False: do not print the help string for options</span>
<span class="sd">            * True: print the help string for options and exit</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing:</span>
<span class="sd">            * `action_object` : :class:`taniumpy.object_types.action.Action`</span>
<span class="sd">            * `action_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * `action_progress_human` : str, progress map in human form</span>
<span class="sd">            * `action_progress_map` : dict, progress map in dictionary form</span>
<span class="sd">            * `pre_action_question_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # example of str for `package`</span>
<span class="sd">        &gt;&gt;&gt; package = &#39;Package1&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `package` with params</span>
<span class="sd">        &gt;&gt;&gt; package = &#39;Package1{key:value}&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of str for `action_filters` with params and filter for sensors</span>
<span class="sd">        &gt;&gt;&gt; action_filters = &#39;Sensor1{key:value}, that contains:example text&#39;</span>

<span class="sd">        &gt;&gt;&gt; # example of list of str for `action_options`</span>
<span class="sd">        &gt;&gt;&gt; action_options = [&#39;max_data_age:3600&#39;, &#39;and&#39;]</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.FILTER_MAPS` : valid filter dictionaries for filters</span>
<span class="sd">        :data:`pytan.constants.OPTION_MAPS` : valid option dictionaries for options</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;package_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_package</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;filters_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_filters</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;options_help&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PytanHelp</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">help_options</span><span class="p">())</span>

        <span class="c"># the human string describing the sensors/filter that user wants</span>
        <span class="c"># to deploy the action against</span>
        <span class="k">if</span> <span class="s">&#39;action_filters&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">action_filters</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;action_filters&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action_filters</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># the question options to use on the pre-action question and on the</span>
        <span class="c"># group for the action filters</span>
        <span class="k">if</span> <span class="s">&#39;action_options&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">action_options</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;action_options&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action_options</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># name of package to deploy with params as {key=value1,key2=value2}</span>
        <span class="k">if</span> <span class="s">&#39;package&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">package</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;package&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">package</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="n">action_filter_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_sensors</span><span class="p">(</span><span class="n">action_filters</span><span class="p">,</span> <span class="s">&#39;action_filters&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="n">action_option_defs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_question_options</span><span class="p">(</span><span class="n">action_options</span><span class="p">)</span>
        <span class="n">package_def</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">dehumanize_package</span><span class="p">(</span><span class="n">package</span><span class="p">)</span>

        <span class="n">deploy_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_action</span><span class="p">(</span>
            <span class="n">action_filter_defs</span><span class="o">=</span><span class="n">action_filter_defs</span><span class="p">,</span>
            <span class="n">action_option_defs</span><span class="o">=</span><span class="n">action_option_defs</span><span class="p">,</span>
            <span class="n">package_def</span><span class="o">=</span><span class="n">package_def</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">deploy_result</span>
</div>
<div class="viewcode-block" id="Handler.deploy_action_asker"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.deploy_action_asker">[docs]</a>    <span class="k">def</span> <span class="nf">deploy_action_asker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_id</span><span class="p">,</span> <span class="n">passed_count</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks the results of a deploy action job and waits for completion</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        action_id : int</span>
<span class="sd">            id of deploy action to get results for and wait on completion</span>
<span class="sd">        passed_count : int, optional</span>
<span class="sd">            the number of servers that must equate &quot;completed&quot; in order for deploy action to be recognized as completed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ret : dict, containing:</span>
<span class="sd">            * `action_object` : :class:`taniumpy.object_types.action.Action`</span>
<span class="sd">            * `action_results` : :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * `action_progress_human` : str, progress map in human form</span>
<span class="sd">            * `action_progress_map` : dict, progress map in dictionary form</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.ACTION_RESULT_STATUS` : maps the values in *Action Statuses* columns to success/completed/failed/etc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">action_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="n">action_obj</span><span class="o">.</span><span class="n">package_spec</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A package_spec has to have a verify_group defined on it in order</span>
<span class="sd">        for deploy action verification to trigger. That can be only done</span>
<span class="sd">        at package_spec create or update time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ps</span><span class="o">.</span><span class="n">verify_group</span> <span class="ow">or</span> <span class="n">ps</span><span class="o">.</span><span class="n">verify_group_id</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Setting up &#39;finished&#39; for verify&quot;</span>
            <span class="n">finished_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;done&#39;</span><span class="p">,</span> <span class="s">&#39;verify_done&#39;</span><span class="p">]</span>
            <span class="n">success_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;verify_done&#39;</span><span class="p">]</span>
            <span class="n">running_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;running&#39;</span><span class="p">,</span> <span class="s">&#39;verify_running&#39;</span><span class="p">]</span>
            <span class="n">failed_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;failed&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Setting up &#39;finished&#39; for no_verify&quot;</span>
            <span class="n">finished_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;done&#39;</span><span class="p">,</span> <span class="s">&#39;no_verify_done&#39;</span><span class="p">]</span>
            <span class="n">success_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;no_verify_done&#39;</span><span class="p">]</span>
            <span class="n">running_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;running&#39;</span><span class="p">]</span>
            <span class="n">failed_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;failed&#39;</span><span class="p">]</span>

        <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">ARS</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">ACTION_RESULT_STATUS</span>
        <span class="n">finished_keys</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_items</span><span class="p">(</span><span class="n">ARS</span><span class="p">,</span> <span class="n">finished_keys</span><span class="p">)</span>
        <span class="n">success_keys</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_items</span><span class="p">(</span><span class="n">ARS</span><span class="p">,</span> <span class="n">success_keys</span><span class="p">)</span>
        <span class="n">running_keys</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_items</span><span class="p">(</span><span class="n">ARS</span><span class="p">,</span> <span class="n">running_keys</span><span class="p">)</span>
        <span class="n">failed_keys</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_items</span><span class="p">(</span><span class="n">ARS</span><span class="p">,</span> <span class="n">failed_keys</span><span class="p">)</span>

        <span class="n">passed_count_reached</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">finished</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">passed_count_reached</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">finished</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Deploy Action Asker loop for {!r}: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">seconds_from_now</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">passed_count_reached</span><span class="p">:</span>
                <span class="c"># get the aggregate resultdata</span>
                <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data</span><span class="p">(</span><span class="n">action_obj</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

                <span class="n">current_passed</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;Count&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rd</span><span class="o">.</span><span class="n">rows</span><span class="p">])</span>
                <span class="n">passed_pct</span> <span class="o">=</span> <span class="n">current_passed</span> <span class="o">*</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">passed_count</span><span class="p">))</span>

                <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s">&quot;Deploy Action {} Current Passed: {}, Expected Passed: {}&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span>
                <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">current_passed</span><span class="p">,</span> <span class="n">passed_count</span><span class="p">))</span>

                <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Action Results Passed: {1:.0f}% ({0})&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="n">actionlog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">passed_pct</span><span class="p">))</span>

                <span class="c"># if current_passed matches passed_count, then set</span>
                <span class="c"># passed_count_reached = True</span>
                <span class="k">if</span> <span class="n">current_passed</span> <span class="o">&gt;=</span> <span class="n">passed_count</span><span class="p">:</span>
                    <span class="n">passed_count_reached</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">passed_count_reached</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">continue</span>

            <span class="c"># if passed_count was reached (the sum of Count from all rows from</span>
            <span class="c"># the aggregate getresultdata is the same or greater as the number</span>
            <span class="c"># of servers that matched the pre-action question), determine</span>
            <span class="c"># if all servers have &quot;finished&quot;</span>

            <span class="c"># get the full resultdata</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_result_data</span><span class="p">(</span><span class="n">action_obj</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

            <span class="c"># create a dictionary to hold action statuses and the</span>
            <span class="c"># computer names for each action status</span>
            <span class="n">as_map</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rd</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
                <span class="n">computer_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;Computer Name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">action_status</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;Action Statuses&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">action_status</span> <span class="o">=</span> <span class="n">action_status</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">action_status</span> <span class="ow">in</span> <span class="n">as_map</span><span class="p">:</span>
                    <span class="n">as_map</span><span class="p">[</span><span class="n">action_status</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">as_map</span><span class="p">[</span><span class="n">action_status</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">computer_name</span><span class="p">)</span>

            <span class="n">total_count</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_len</span><span class="p">(</span><span class="n">as_map</span><span class="p">)</span>
            <span class="n">finished_count</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_len</span><span class="p">(</span><span class="n">as_map</span><span class="p">,</span> <span class="n">finished_keys</span><span class="p">)</span>
            <span class="n">success_count</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_len</span><span class="p">(</span><span class="n">as_map</span><span class="p">,</span> <span class="n">success_keys</span><span class="p">)</span>
            <span class="n">running_count</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_len</span><span class="p">(</span><span class="n">as_map</span><span class="p">,</span> <span class="n">running_keys</span><span class="p">)</span>
            <span class="n">failed_count</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_len</span><span class="p">(</span><span class="n">as_map</span><span class="p">,</span> <span class="n">failed_keys</span><span class="p">)</span>
            <span class="n">unknown_count</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_dict_list_len</span><span class="p">(</span><span class="n">as_map</span><span class="p">,</span> <span class="n">ARS</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

            <span class="n">finished_pct</span> <span class="o">=</span> <span class="n">finished_count</span> <span class="o">*</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">passed_count</span><span class="p">))</span>

            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Action Results Completed: {1:.0f}% ({0})&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">actionlog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">finished_pct</span><span class="p">))</span>

            <span class="n">progress</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;{} Result Counts:</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;</span><span class="se">\t</span><span class="s">Running Count: {}</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;</span><span class="se">\t</span><span class="s">Success Count: {}</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;</span><span class="se">\t</span><span class="s">Failed Count: {}</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;</span><span class="se">\t</span><span class="s">Unknown Count: {}</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;</span><span class="se">\t</span><span class="s">Finished Count: {}</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;</span><span class="se">\t</span><span class="s">Total Count: {}</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="s">&quot;</span><span class="se">\t</span><span class="s">Finished Count must equal: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">action_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">running_count</span><span class="p">,</span>
                <span class="n">success_count</span><span class="p">,</span>
                <span class="n">failed_count</span><span class="p">,</span>
                <span class="n">unknown_count</span><span class="p">,</span>
                <span class="n">finished_count</span><span class="p">,</span>
                <span class="n">total_count</span><span class="p">,</span>
                <span class="n">passed_count</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">finished_count</span> <span class="o">&gt;=</span> <span class="n">passed_count</span><span class="p">:</span>
                <span class="n">actionlog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>
                <span class="n">finished</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">break</span>

            <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;action_object&#39;</span><span class="p">:</span> <span class="n">action_obj</span><span class="p">,</span>
            <span class="s">&#39;action_results&#39;</span><span class="p">:</span> <span class="n">rd</span><span class="p">,</span>
            <span class="s">&#39;action_progress_human&#39;</span><span class="p">:</span> <span class="n">progress</span><span class="p">,</span>
            <span class="s">&#39;action_progress_map&#39;</span><span class="p">:</span> <span class="n">as_map</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Handler.export_obj"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.export_obj">[docs]</a>    <span class="k">def</span> <span class="nf">export_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports a python API object to a given export format</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            TaniumPy object to export</span>
<span class="sd">        export_format : str</span>
<span class="sd">            the number of servers that must equate &quot;completed&quot; in order for deploy action to be recognized as completed</span>
<span class="sd">        header_sort : list of str, bool, optional</span>
<span class="sd">            * for `export_format` csv and `obj` types :class:`taniumpy.object_types.base.BaseType` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * True: sort the headers automatically</span>
<span class="sd">            * False: do not sort the headers at all</span>
<span class="sd">            * list of str: sort the headers returned by priority based on provided list</span>
<span class="sd">        header_add_sensor : bool, optional</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not prefix the headers with the associated sensor name for each column</span>
<span class="sd">            * True: prefix the headers with the associated sensor name for each column</span>
<span class="sd">        header_add_type : bool, optional</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not postfix the headers with the result type for each column</span>
<span class="sd">            * True: postfix the headers with the result type for each column</span>
<span class="sd">        expand_grouped_columns : bool, optional</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not expand multiline row entries into their own rows</span>
<span class="sd">            * True: expand multiline row entries into their own rows</span>
<span class="sd">        explode_json_string_values : bool, optional</span>
<span class="sd">            * for `export_format` json or csv and `obj` type :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * False: do not explode JSON strings in object attributes into their own object attributes</span>
<span class="sd">            * True: explode JSON strings in object attributes into their own object attributes</span>
<span class="sd">        minimal : bool, optional</span>
<span class="sd">            * for `export_format` xml and `obj` type :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * False: include empty attributes in XML output</span>
<span class="sd">            * True: do not include empty attributes in XML output</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : str</span>
<span class="sd">            the contents of exporting `export_format`</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.EXPORT_MAPS` : maps the type `obj` to `export_format` and the optional args supported for each</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">objtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">objclassname</span> <span class="o">=</span> <span class="n">objtype</span><span class="o">.</span><span class="n">__name__</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">objclassname</span> <span class="o">=</span> <span class="s">&#39;Unknown&#39;</span>

        <span class="n">export_maps</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">EXPORT_MAPS</span>

        <span class="c"># build a list of supported object types</span>
        <span class="n">supp_types</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_maps</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c"># see if supplied obj is a supported object type</span>
        <span class="n">type_match</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">export_maps</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">type_match</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;{} not a supported object to export, must be one of: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">supp_types</span><span class="p">))</span>

        <span class="c"># get the export formats for this obj type</span>
        <span class="n">export_formats</span> <span class="o">=</span> <span class="n">export_maps</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">export_format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">export_formats</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s">&quot;{!r} not a supported export format for {}, must be one of: {}&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">export_format</span><span class="p">,</span> <span class="n">objclassname</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">export_formats</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>

        <span class="c"># perform validation on optional kwargs, if they exist</span>
        <span class="n">opt_keys</span> <span class="o">=</span> <span class="n">export_formats</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">export_format</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">opt_key</span> <span class="ow">in</span> <span class="n">opt_keys</span><span class="p">:</span>
            <span class="n">check_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">opt_key</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="p">{</span><span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">check_dictkey</span><span class="p">(</span><span class="o">**</span><span class="n">check_args</span><span class="p">)</span>

        <span class="c"># filter out the kwargs that are specific to this obj type and</span>
        <span class="c"># format type</span>
        <span class="n">format_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="s">&#39;key&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">opt_keys</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c"># run the handler that is specific to this objtype, if it exists</span>
        <span class="n">class_method_str</span> <span class="o">=</span> <span class="s">&#39;_export_class_&#39;</span> <span class="o">+</span> <span class="n">type_match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">class_handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_method_str</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">class_handler</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">class_handler</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">format_kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} not supported by Handler!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objclassname</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler.export_to_report_file"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.export_to_report_file">[docs]</a>    <span class="k">def</span> <span class="nf">export_to_report_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports a python API object to a file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            TaniumPy object to export</span>
<span class="sd">        export_format : str</span>
<span class="sd">            the number of servers that must equate &quot;completed&quot; in order for deploy action to be recognized as completed</span>
<span class="sd">        header_sort : list of str, bool, optional</span>
<span class="sd">            * for `export_format` csv and `obj` types :class:`taniumpy.object_types.base.BaseType` or :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * True: sort the headers automatically</span>
<span class="sd">            * False: do not sort the headers at all</span>
<span class="sd">            * list of str: sort the headers returned by priority based on provided list</span>
<span class="sd">        header_add_sensor : bool, optional</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not prefix the headers with the associated sensor name for each column</span>
<span class="sd">            * True: prefix the headers with the associated sensor name for each column</span>
<span class="sd">        header_add_type : bool, optional</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not postfix the headers with the result type for each column</span>
<span class="sd">            * True: postfix the headers with the result type for each column</span>
<span class="sd">        expand_grouped_columns : bool, optional</span>
<span class="sd">            * for `export_format` csv and `obj` type :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            * False: do not expand multiline row entries into their own rows</span>
<span class="sd">            * True: expand multiline row entries into their own rows</span>
<span class="sd">        explode_json_string_values : bool, optional</span>
<span class="sd">            * for `export_format` json or csv and `obj` type :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * False: do not explode JSON strings in object attributes into their own object attributes</span>
<span class="sd">            * True: explode JSON strings in object attributes into their own object attributes</span>
<span class="sd">        minimal : bool, optional</span>
<span class="sd">            * for `export_format` xml and `obj` type :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            * False: include empty attributes in XML output</span>
<span class="sd">            * True: do not include empty attributes in XML output</span>
<span class="sd">        report_file: str, optional</span>
<span class="sd">            filename to save report as, will be automatically generated if not supplied</span>
<span class="sd">        report_dir: str, optional</span>
<span class="sd">            directory to save report in, if not supplied, will be extracted from `report_file`. if no directory in `report_file` or `report_file` not specified, will use current working directory.</span>
<span class="sd">        prefix: str, optional</span>
<span class="sd">            prefix to add to `report_file`</span>
<span class="sd">        postfix: str, optional</span>
<span class="sd">            postfix to add to `report_file`</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        report_path : str</span>
<span class="sd">            the full path to the file created with contents of `result`</span>
<span class="sd">        result : str</span>
<span class="sd">            the str of `export_format`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">report_file</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;report_file&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">report_file</span><span class="p">:</span>
            <span class="n">report_file</span> <span class="o">=</span> <span class="s">&quot;{}_{}.{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_now</span><span class="p">(),</span> <span class="n">export_format</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;No report file name supplied, generated name: {!r}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">report_file</span><span class="p">))</span>

        <span class="c"># try to get report_dir from the report_file</span>
        <span class="n">report_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">report_file</span><span class="p">)</span>

        <span class="c"># try to get report_dir from kwargs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">report_dir</span><span class="p">:</span>
            <span class="n">report_dir</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;report_dir&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="c"># just use current working dir</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">report_dir</span><span class="p">:</span>
            <span class="n">report_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

        <span class="c"># make report_dir if it doesnt exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">report_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">report_dir</span><span class="p">)</span>

        <span class="c"># remove any path from report_file</span>
        <span class="n">report_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">report_file</span><span class="p">)</span>

        <span class="c"># if prefix/postfix, add to report_file</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prefix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">postfix</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;postfix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">report_file</span><span class="p">,</span> <span class="n">report_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">report_file</span><span class="p">)</span>
        <span class="n">report_file</span> <span class="o">=</span> <span class="s">&#39;{}{}{}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">report_file</span><span class="p">,</span> <span class="n">postfix</span><span class="p">,</span> <span class="n">report_ext</span>
        <span class="p">)</span>

        <span class="c"># join the report_dir and report_file to come up with report_path</span>
        <span class="n">report_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">report_dir</span><span class="p">,</span> <span class="n">report_file</span><span class="p">)</span>

        <span class="c"># get the results of exporting the object</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">export_obj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="s">&quot;Report file {!r} written with {} bytes&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">report_path</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">report_path</span><span class="p">,</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler.get"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get an object type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype : string</span>
<span class="sd">            type of object to get</span>
<span class="sd">        id/name/hash : int or string, list of int or string</span>
<span class="sd">            search attributes of object to get, must supply at least one valid search attr</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.GET_OBJ_MAP` : maps objtype to supported &#39;search&#39; keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_map</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_obj_map</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
        <span class="n">manual_search</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;manual&#39;</span><span class="p">]</span>
        <span class="n">api_attrs</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
        <span class="n">api_kwattrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">api_attrs</span><span class="p">]</span>

        <span class="c"># if the api doesn&#39;t support filtering for this object,</span>
        <span class="c"># or if the user didn&#39;t supply any api_kwattrs and manual_search</span>
        <span class="c"># is true, get all objects of this type and manually filter</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_attrs</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">api_kwattrs</span><span class="p">)</span> <span class="ow">and</span> <span class="n">manual_search</span><span class="p">):</span>
            <span class="n">all_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">return_objs</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">all_objs</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)()</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">all_objs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">aobj</span> <span class="ow">in</span> <span class="n">all_objs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">aobj</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">return_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aobj</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">return_objs</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;No results found searching for {} with {}!!&quot;</span><span class="o">.</span><span class="n">format</span>
                <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">return_objs</span>

        <span class="c"># if api supports filtering for this object,</span>
        <span class="c"># but no filters supplied in kwargs, raise</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">api_kwattrs</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;Getting a {} requires at least one filter: {}&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span> <span class="n">api_attrs</span><span class="p">))</span>

        <span class="c"># if there is a multi in obj_map, that means we can pass a list</span>
        <span class="c"># type to the taniumpy. the list will have an entry for each api_kw</span>
        <span class="k">if</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;multi&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_multi</span><span class="p">(</span><span class="n">obj_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># if there is a single in obj_map but not multi, that means</span>
        <span class="c"># we have to find each object individually</span>
        <span class="k">elif</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_single</span><span class="p">(</span><span class="n">obj_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;No single or multi search defined for {}&quot;</span><span class="o">.</span><span class="n">format</span>
        <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">objtype</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Handler.get_all"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_all">[docs]</a>    <span class="k">def</span> <span class="nf">get_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all objects of a type</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        objtype : string</span>
<span class="sd">            type of object to get</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        :data:`pytan.constants.GET_OBJ_MAP` : maps objtype to supported &#39;search&#39; keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj_map</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_obj_map</span><span class="p">(</span><span class="n">objtype</span><span class="p">)</span>
        <span class="n">api_obj_all</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">])()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">api_obj_all</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler.get_result_data"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_result_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_result_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the result data for a python API object</span>

<span class="sd">        This method issues a GetResultData command to the SOAP api for `obj`. GetResultData returns the columns and rows that are currently available for `obj`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            object to get result data for</span>
<span class="sd">        aggregate : bool, optional</span>
<span class="sd">            * False: get all the data</span>
<span class="sd">            * True: get just the aggregate data (row counts of matches)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rd : :class:`taniumpy.object_types.result_set.ResultSet`</span>
<span class="sd">            The return of GetResultData for `obj`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># do a getresultinfo to ensure fresh data is available for</span>
        <span class="c"># getresultdata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_result_info</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="sd">&quot;&quot;&quot; note #1 from jwk:</span>
<span class="sd">        For Action GetResultData:</span>

<span class="sd">        You have to make a ResultInfo request at least once every 2 minutes.</span>
<span class="sd">        The server gathers the result data by asking a saved question.</span>
<span class="sd">        It won&#39;t re-issue the saved question unless you make a GetResultInfo</span>
<span class="sd">        request. When you make a GetResultInfo request, if there is no</span>
<span class="sd">        question that is less than 2 minutes old, the server will automatically</span>
<span class="sd">        reissue a new question instance to make sure fresh data is available.</span>

<span class="sd">        note #2 from jwk:</span>
<span class="sd">         To get the aggregate data (without computer names),</span>
<span class="sd">         set row_counts_only_flag = 1. To get the computer names,</span>
<span class="sd">         use row_counts_only_flag = 0 (default).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># do a getresultdata</span>
        <span class="k">if</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">getResultData</span><span class="p">(</span>
                <span class="n">obj</span><span class="p">,</span> <span class="n">row_counts_only_flag</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">getResultData</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rd</span>
</div>
<div class="viewcode-block" id="Handler.get_result_info"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.get_result_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_result_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the result info for a python API object</span>

<span class="sd">        This method issues a GetResultInfo command to the SOAP api for `obj`. GetResultInfo returns information about how many servers have passed the `obj`, total number of servers, and so on.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : :class:`taniumpy.object_types.base.BaseType`</span>
<span class="sd">            object to get result data for</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ri : :class:`taniumpy.object_types.result_info.ResultInfo`</span>
<span class="sd">            The return of GetResultData for `obj`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">getResultInfo</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ri</span>
</div>
<div class="viewcode-block" id="Handler.stop_action"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler.stop_action">[docs]</a>    <span class="k">def</span> <span class="nf">stop_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop an action</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        id : int</span>
<span class="sd">            id of action to stop</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        action_stop_obj : :class:`taniumpy.object_types.action_stop.ActionStop`</span>
<span class="sd">            The object containing the ID of the action stop job</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;action&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">add_action_stop_obj</span> <span class="o">=</span> <span class="n">taniumpy</span><span class="o">.</span><span class="n">ActionStop</span><span class="p">()</span>
        <span class="n">add_action_stop_obj</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action_obj</span>
        <span class="n">action_stop_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">add_action_stop_obj</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&#39;Action stopped successfully, ID of action stop: {}&#39;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">format</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">(</span><span class="n">action_stop_obj</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">action_stop_obj</span>

    <span class="c"># BEGIN PRIVATE METHODS</span></div>
<div class="viewcode-block" id="Handler._find"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._find">[docs]</a>    <span class="k">def</span> <span class="nf">_find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for interfacing with :func:`taniumpy.session.Session.find`&quot;&quot;&quot;</span>
        <span class="n">req_kwargs</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_req_kwargs</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="s">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">api_object</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">search_str</span> <span class="o">=</span> <span class="n">api_object</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Searching for {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">search_str</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">api_object</span><span class="p">,</span> <span class="o">**</span><span class="n">req_kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;No results found searching for {}!!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">search_str</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">empty_obj</span><span class="p">(</span><span class="n">found</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;No results found searching for {}!!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">search_str</span><span class="p">))</span>

        <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Found {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">found</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler._get_multi"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._get_multi">[docs]</a>    <span class="k">def</span> <span class="nf">_get_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find multiple item wrapper using :func:`_find`&quot;&quot;&quot;</span>
        <span class="n">api_attrs</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
        <span class="n">api_kwattrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">api_attrs</span><span class="p">]</span>
        <span class="n">api_kw</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">api_attrs</span><span class="p">,</span> <span class="n">api_kwattrs</span><span class="p">)}</span>

        <span class="c"># create a list object to append our searches to</span>
        <span class="n">api_obj_multi</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;multi&#39;</span><span class="p">])()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">api_kw</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c"># if we can&#39;t search for k, skip</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c"># if v empty, skip</span>

            <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="n">api_obj_single</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">])()</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">api_obj_multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">api_obj_single</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">])()</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">api_obj_multi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">)</span>

        <span class="c"># find the multi list object</span>
        <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">api_obj_multi</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler._get_single"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._get_single">[docs]</a>    <span class="k">def</span> <span class="nf">_get_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find single item wrapper using :func:`_find`&quot;&quot;&quot;</span>
        <span class="n">api_attrs</span> <span class="o">=</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>
        <span class="n">api_kwattrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">api_attrs</span><span class="p">]</span>
        <span class="n">api_kw</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">api_attrs</span><span class="p">,</span> <span class="n">api_kwattrs</span><span class="p">)}</span>

        <span class="c"># we create a list object to append our single item searches to</span>
        <span class="k">if</span> <span class="n">obj_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;allfix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="n">found</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;allfix&#39;</span><span class="p">])()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;all&#39;</span><span class="p">])()</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">api_kw</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>  <span class="c"># if we can&#39;t search for k, skip</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                <span class="k">continue</span>  <span class="c"># if v empty, skip</span>

            <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_list</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_find</span><span class="p">(</span><span class="n">obj_map</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                        <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single_find</span><span class="p">(</span><span class="n">obj_map</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                    <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler._single_find"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._single_find">[docs]</a>    <span class="k">def</span> <span class="nf">_single_find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wrapper for single item searches interfacing with :func:`taniumpy.session.Session.find`&quot;&quot;&quot;</span>
        <span class="n">found</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">api_obj_single</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">taniumpy</span><span class="p">,</span> <span class="n">obj_map</span><span class="p">[</span><span class="s">&#39;single&#39;</span><span class="p">])()</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">obj_ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find</span><span class="p">(</span><span class="n">api_obj_single</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj_ret</span><span class="p">,</span> <span class="s">&#39;_list_properties&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj_ret</span><span class="p">:</span>
                <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">found</span>
</div>
<div class="viewcode-block" id="Handler._get_sensor_defs"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._get_sensor_defs">[docs]</a>    <span class="k">def</span> <span class="nf">_get_sensor_defs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uses :func:`get` to update a definition with a sensor object&quot;&quot;&quot;</span>
        <span class="n">s_obj_map</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">GET_OBJ_MAP</span><span class="p">[</span><span class="s">&#39;sensor&#39;</span><span class="p">]</span>
        <span class="n">search_keys</span> <span class="o">=</span> <span class="n">s_obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">defs</span><span class="p">:</span>
            <span class="n">def_search</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">search_keys</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)}</span>

            <span class="c"># get the sensor object</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;sensor_obj&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="s">&#39;sensor_obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sensor&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">def_search</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">defs</span>
</div>
<div class="viewcode-block" id="Handler._get_package_def"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._get_package_def">[docs]</a>    <span class="k">def</span> <span class="nf">_get_package_def</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Uses :func:`get` to update a definition with a package object&quot;&quot;&quot;</span>
        <span class="n">s_obj_map</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">GET_OBJ_MAP</span><span class="p">[</span><span class="s">&#39;package&#39;</span><span class="p">]</span>
        <span class="n">search_keys</span> <span class="o">=</span> <span class="n">s_obj_map</span><span class="p">[</span><span class="s">&#39;search&#39;</span><span class="p">]</span>

        <span class="n">def_search</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">search_keys</span> <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)}</span>

        <span class="c"># get the package object</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;package_obj&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s">&#39;package_obj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;package&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">def_search</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">d</span>
</div>
<div class="viewcode-block" id="Handler._export_class_BaseType"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_class_BaseType">[docs]</a>    <span class="k">def</span> <span class="nf">_export_class_BaseType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting :class:`taniumpy.object_types.base.BaseType`&quot;&quot;&quot;</span>
        <span class="c"># run the handler that is specific to this export_format, if it exists</span>
        <span class="n">format_method_str</span> <span class="o">=</span> <span class="s">&#39;_export_format_&#39;</span> <span class="o">+</span> <span class="n">export_format</span>
        <span class="n">format_handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_method_str</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">format_handler</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">format_handler</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} not coded for in Handler!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">export_format</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._export_class_ResultSet"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_class_ResultSet">[docs]</a>    <span class="k">def</span> <span class="nf">_export_class_ResultSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">export_format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting :class:`taniumpy.object_types.result_set.ResultSet`&quot;&quot;&quot;</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ensure kwargs[sensors] has all the sensors that correlate</span>
<span class="sd">        to the what_hash of each column, but only if header_add_sensor=True</span>
<span class="sd">        needed for: ResultSet.write_csv(header_add_sensor=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">header_add_sensor</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;header_add_sensor&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="n">sensors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sensors&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;sensors&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="k">if</span> <span class="n">header_add_sensor</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;sensors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensors</span>
            <span class="n">sensor_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">hash</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sensors</span><span class="p">]</span>
            <span class="n">column_hashes</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">what_hash</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
            <span class="n">missing_hashes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">column_hashes</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sensor_hashes</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">missing_hashes</span><span class="p">:</span>
                <span class="n">missing_sensors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sensor&#39;</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="n">missing_hashes</span><span class="p">)</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;sensors&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">missing_sensors</span><span class="p">)</span>

        <span class="c"># run the handler that is specific to this export_format, if it exists</span>
        <span class="n">format_method_str</span> <span class="o">=</span> <span class="s">&#39;_export_format_&#39;</span> <span class="o">+</span> <span class="n">export_format</span>
        <span class="n">format_handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_method_str</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">format_handler</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">format_handler</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} not coded for in Handler!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">export_format</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._export_format_csv"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_format_csv">[docs]</a>    <span class="k">def</span> <span class="nf">_export_format_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting format: CSV&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;write_csv&#39;</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} has no write_csv() method!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;_list_properties&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">write_csv</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._export_format_json"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_format_json">[docs]</a>    <span class="k">def</span> <span class="nf">_export_format_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting format: JSON&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;to_json&#39;</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} has no to_json() method!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">jsonable</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Handler._export_format_xml"><a class="viewcode-back" href="../../pytan.handler.html#pytan.handler.Handler._export_format_xml">[docs]</a>    <span class="k">def</span> <span class="nf">_export_format_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handles exporting format: XML&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;toSOAPBody&#39;</span><span class="p">):</span>
            <span class="n">err</span> <span class="o">=</span> <span class="s">&quot;{!r} has no toSOAPBody() method!&quot;</span><span class="o">.</span><span class="n">format</span>
            <span class="k">raise</span> <span class="n">HandlerError</span><span class="p">(</span><span class="n">err</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">toSOAPBody</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Tanium.
      Last updated on Dec 08, 2014.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>